(function(_){var filename = ((function(){var _documentCurrentScript = typeof document !== "undefined" ? document.currentScript : null;return typeof document === "undefined" ? require("url").pathToFileURL(__filename).href : _documentCurrentScript && _documentCurrentScript.src || new URL("index_eafd.js", document.baseURI).href})());for(var r in _){_[r].__farm_resource_pot__=filename;window['f1d71b9dd14324d7340d3311efaf8136'].__farm_module_system__.register(r,_[r])}})({"21929cc9":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var r=a("9aaf3498"),u=a("9aaf3498"),n=a("1f6a8afd"),f=a("0e70da6a"),d=a("f247f526");t.default=r.defineComponent({__name:"DebugPanel",setup(e){var t=d.useSceneStore(),a=f.storeToRefs(t),l=a.collisionEnabled,r=a.showCollisionBoxes,c=a.rendererInfo;return(e,a)=>(u.openBlock(),u.createBlock(u.unref(n.NSpace),{vertical:"",size:"large"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[u.createTextVNode("渲染后端："+u.toDisplayString(u.unref(c)),1)]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...a[3]||(a[3]=[u.createTextVNode("碰撞",-1)])]),_:1}),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(l),"onUpdate:value":a[0]||(a[0]=e=>u.isRef(l)?l.value=e:null)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[4]||(a[4]=[u.createTextVNode("启用碰撞",-1)])]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace)),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(r),"onUpdate:value":a[1]||(a[1]=e=>u.isRef(r)?r.value=e:null)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[5]||(a[5]=[u.createTextVNode("显示碰撞箱",-1)])]),_:1})]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...a[6]||(a[6]=[u.createTextVNode("性能统计",-1)])]),_:1}),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(t).statsVisible,"onUpdate:value":a[2]||(a[2]=e=>u.unref(t).statsVisible=e)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[7]||(a[7]=[u.createTextVNode("显示 Stats",-1)])]),_:1})]),_:1})]),_:1})]),_:1}));}});},"23b6b720":function t(t,e,i,s){t._m(e),t.o(e,"ThirdPersonCamera",()=>o);var h=i("09efd1d2"),a=t.w(i("3b16918b"));class o{setTarget(t){this.target=t,this.syncWithCamera();}setCollider(t){this.collider=t;}syncWithCamera(){if(this.target){var t=new a.Vector3().subVectors(this.camera.position,this.target.position);this.radius=t.length(),this.currentRadius=this.radius,this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(a.MathUtils.clamp(t.y/this.radius,-1,1)),this.targetTheta=this.theta,this.targetPhi=this.phi;}}onMouseMove(t){this.isLocked&&(this.targetTheta-=t.movementX*this.sensitivity,this.targetPhi-=t.movementY*this.sensitivity,this.targetPhi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.targetPhi)));}onMouseWheel(t){this.isLocked&&(this.radius+=.005*t.deltaY,this.radius=Math.max(2,Math.min(20,this.radius)));}update(t){if(this.target){var e=1-Math.exp(-25*t),i=this.targetTheta-this.theta;this.theta+=i*e,this.phi+=(this.targetPhi-this.phi)*e;var s=this.target.position.clone().add(this.targetOffset),h=this.radius;if(this.collider){var o=new a.Vector3(0);o.setFromSphericalCoords(1,this.phi,this.theta).normalize();var r=new a.Raycaster(s,o);r.far=this.radius,r.firstHitOnly=!0;var n=r.intersectObject(this.collider,!0);n.length>0&&(h=Math.max(.2,n[0].distance-.2));}var d=-100*(this.currentRadius-h)-20*this.radiusVelocity;this.radiusVelocity+=d*t,this.currentRadius+=this.radiusVelocity*t,this.camera.position.setFromSphericalCoords(this.currentRadius,this.phi,this.theta).add(s),this.camera.lookAt(s);}}setDomElement(t){this.domElement=t;}setLocked(t){this.isLocked=t;}onPointerLockChange(){this.isLocked=document.pointerLockElement===this.domElement;}dispose(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("pointerlockchange",this.onPointerLockChange),document.removeEventListener("wheel",this.onMouseWheel);}constructor(t,e){h._(this,"camera",void 0),h._(this,"domElement",void 0),h._(this,"target",null),h._(this,"theta",0),h._(this,"phi",Math.PI/2),h._(this,"radius",3),h._(this,"currentRadius",3),h._(this,"radiusVelocity",0),h._(this,"collider",null),h._(this,"targetTheta",0),h._(this,"targetPhi",Math.PI/2),h._(this,"minPolarAngle",.1),h._(this,"maxPolarAngle",Math.PI-.1),h._(this,"targetOffset",new a.Vector3(0,1.5,0)),h._(this,"isLocked",!1),h._(this,"sensitivity",.002),this.camera=t,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("pointerlockchange",this.onPointerLockChange),document.addEventListener("wheel",this.onMouseWheel);}}},"4735cb57":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var u=a("9aaf3498"),n=a("9aaf3498"),r=a("1f6a8afd"),f=a("0e70da6a"),d=a("f247f526");t.default=u.defineComponent({__name:"PostProcessPanel",setup(e){var t=d.useSceneStore(),a=f.storeToRefs(t),l=a.gtaoEnabled,u=a.gtaoSamples,i=a.gtaoDistanceExponent,o=a.gtaoDistanceFallOff,s=a.gtaoRadius,N=a.gtaoScale,c=a.gtaoThickness,x=a.gtaoAoOnly;return(e,t)=>(n.openBlock(),n.createBlock(n.unref(r.NSpace),{vertical:"",size:"large"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"2",style:{"font-size":"12px"}},{default:n.withCtx(()=>[...t[8]||(t[8]=[n.createTextVNode("GTAO",-1)])]),_:1}),n.createVNode(n.unref(r.NSpace),{align:"center"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSwitch),{value:n.unref(l),"onUpdate:value":t[0]||(t[0]=e=>n.isRef(l)?l.value=e:null)},null,8,["value"]),n.createVNode(n.unref(r.NText),null,{default:n.withCtx(()=>[...t[9]||(t[9]=[n.createTextVNode("启用 GTAO",-1)])]),_:1})]),_:1}),n.createVNode(n.unref(r.NSpace),{align:"center"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSwitch),{value:n.unref(x),"onUpdate:value":t[1]||(t[1]=e=>n.isRef(x)?x.value=e:null),disabled:!n.unref(l)},null,8,["value","disabled"]),n.createVNode(n.unref(r.NText),null,{default:n.withCtx(()=>[...t[10]||(t[10]=[n.createTextVNode("仅显示 AO",-1)])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGrid),{cols:2,"x-gap":8,"y-gap":8},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[11]||(t[11]=[n.createTextVNode("Samples",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(u),"onUpdate:value":t[2]||(t[2]=e=>n.isRef(u)?u.value=e:null),size:"small",min:4,max:32,step:1,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[12]||(t[12]=[n.createTextVNode("Radius",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(s),"onUpdate:value":t[3]||(t[3]=e=>n.isRef(s)?s.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[13]||(t[13]=[n.createTextVNode("Distance Exp",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(i),"onUpdate:value":t[4]||(t[4]=e=>n.isRef(i)?i.value=e:null),size:"small",min:1,max:4,step:.1,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[14]||(t[14]=[n.createTextVNode("Distance Falloff",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(o),"onUpdate:value":t[5]||(t[5]=e=>n.isRef(o)?o.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[15]||(t[15]=[n.createTextVNode("Scale",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(N),"onUpdate:value":t[6]||(t[6]=e=>n.isRef(N)?N.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[16]||(t[16]=[n.createTextVNode("Thickness",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(c),"onUpdate:value":t[7]||(t[7]=e=>n.isRef(c)?c.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}));}});},"61fbd776":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70"),a("db38ec0f");var u=a("9aaf3498"),r=a("9aaf3498"),n=a("1f6a8afd"),i=a("0e70da6a"),d=a("f247f526"),f=e.i(a("c879eb01"));t.default=u.defineComponent({__name:"LightingPanel",setup(t){var a=d.useSceneStore(),l=i.storeToRefs(a),u=l.skyboxEnabled,o=l.sunEnabled,c=l.sunColor,N=l.sunIntensity,s=l.sunPosition,x=l.ambientEnabled,v=l.ambientColor,p=l.ambientIntensity,h=l.environmentEnabled,V=l.environmentIntensity,w=l.spotEnabled,C=l.spotColor,_=l.spotIntensity,S=l.spotAngle,m=l.spotPenumbra,T=l.spotDecay,z=l.spotDistance;return(t,a)=>(r.openBlock(),r.createBlock(r.unref(n.NSpace),{vertical:"",size:"large"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(u),"onUpdate:value":a[0]||(a[0]=e=>r.isRef(u)?u.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[17]||(a[17]=[r.createTextVNode("天空盒",-1)])]),_:1})]),_:1})]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(o),"onUpdate:value":a[1]||(a[1]=e=>r.isRef(o)?o.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[18]||(a[18]=[r.createTextVNode("太阳光",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[19]||(a[19]=[r.createTextVNode("颜色",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(c),"onUpdate:value":a[2]||(a[2]=e=>r.isRef(c)?c.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("亮度 "+r.toDisplayString(r.unref(N).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(N),"onUpdate:value":a[3]||(a[3]=e=>r.isRef(N)?N.value=e:null),min:0,max:10,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(o)]]),r.withDirectives(r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[20]||(a[20]=[r.createTextVNode("光源位置",-1)])]),_:1}),r.createVNode(e.f(f),{value:r.unref(s),"onUpdate:value":a[4]||(a[4]=e=>r.isRef(s)?s.value=e:null)},null,8,["value"])]),_:1},512),[[r.vShow,r.unref(o)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(x),"onUpdate:value":a[5]||(a[5]=e=>r.isRef(x)?x.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[21]||(a[21]=[r.createTextVNode("全局环境光",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[22]||(a[22]=[r.createTextVNode("颜色",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(v),"onUpdate:value":a[6]||(a[6]=e=>r.isRef(v)?v.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("亮度 "+r.toDisplayString(r.unref(p).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(p),"onUpdate:value":a[7]||(a[7]=e=>r.isRef(p)?p.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(x)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(h),"onUpdate:value":a[8]||(a[8]=e=>r.isRef(h)?h.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[23]||(a[23]=[r.createTextVNode("环境光照 (RoomEnvironment)",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("强度 "+r.toDisplayString(r.unref(V).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(V),"onUpdate:value":a[9]||(a[9]=e=>r.isRef(V)?V.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1},512),[[r.vShow,r.unref(h)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(w),"onUpdate:value":a[10]||(a[10]=e=>r.isRef(w)?w.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[24]||(a[24]=[r.createTextVNode("摄像机聚光灯",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[25]||(a[25]=[r.createTextVNode("颜色",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(C),"onUpdate:value":a[11]||(a[11]=e=>r.isRef(C)?C.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("亮度 "+r.toDisplayString(r.unref(_).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(_),"onUpdate:value":a[12]||(a[12]=e=>r.isRef(_)?_.value=e:null),min:0,max:100,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(w)]]),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("锥形角度 "+r.toDisplayString(r.unref(S))+"°",1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(S),"onUpdate:value":a[13]||(a[13]=e=>r.isRef(S)?S.value=e:null),min:5,max:90,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("半影 "+r.toDisplayString(r.unref(m).toFixed(2)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(m),"onUpdate:value":a[14]||(a[14]=e=>r.isRef(m)?m.value=e:null),min:0,max:1,step:.01},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(w)]]),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("衰减 "+r.toDisplayString(r.unref(T).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(T),"onUpdate:value":a[15]||(a[15]=e=>r.isRef(T)?T.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("距离 "+r.toDisplayString(r.unref(z)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(z),"onUpdate:value":a[16]||(a[16]=e=>r.isRef(z)?z.value=e:null),min:0,max:5e3,step:10},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(w)]])]),_:1})]),_:1}));}});},"67dbd159":function e(e,t,r,n){e._m(t),e.o(t,"Engine",()=>x);var s=r("09efd1d2");r("92de075b"),r("850e6c49"),r("40616381"),r("b25dd2f8"),r("7bccf4aa"),r("2d08c2e5"),r("a3876e70");var o=e.w(r("3b16918b")),a=r("7f2264c7"),i=r("03f4e36a"),h=r("47a20e72"),d=r("69939ce5"),l=r("e9ef43b1"),c=r("e0c628a7"),m=r("3eec3e47"),u=r("7475699d"),p=r("8f363abd"),f=r("ae64a1a9"),g=r("e00be090"),v=r("f4cd7510"),b=r("c2079dd8"),M=r("96554b2f"),C=r("99602713"),w=e.i(r("26d7988f")),y=r("f247f526"),E=r("6519cad4");o.BufferGeometry.prototype.computeBoundsTree=E.computeBoundsTree,o.BufferGeometry.prototype.disposeBoundsTree=E.disposeBoundsTree,o.Mesh.prototype.raycast=E.acceleratedRaycast;class x{async init(){var t=y.useSceneStore();await e.f(w).init(),e.f(w).onRendererChange(this.handleRendererChange.bind(this));var r=e.f(w).renderer;t.rendererInfo=r.backend.constructor.name.replace("Backend",""),this.setupEnvironment(e.f(w).renderer),this.postProcessing=new u.PostProcessing(e.f(w).renderer,this.scene,e.f(w).camera);var n=new o.CubeTextureLoader;n.setPath("cubeMap/");var s=n.load(C.ASSETS.textures.skybox);this.setSkybox(s);var a=new v.InfiniteGrid;this.scene.add(a),this.scene.add(e.f(w).camera),this.lightManager=new p.LightManager(this.scene,e.f(w).camera),this.heatmapManager=new f.HeatmapManager(e.f(w).renderer),this.heatmapManager.createDisplayMesh(this.scene),this.modelLoader=new g.ModelLoader(e.f(w).renderer);var i=async()=>{var e=new c.Character;try{this.modelLoader&&(await e.load(this.modelLoader,C.ASSETS.models.char,e=>{e.lengthComputable&&(t.loadingProgress=50+Math.round(e.loaded/e.total*50));}),this.setCharacter(e),t.movementMode="thirdPerson",t.isLoading=!1);}catch(e){console.error("Character loading failed:",e),t.isLoading=!1;}};this.modelLoader.loadGLTF(C.ASSETS.models.home,e=>{e.lengthComputable&&(t.loadingProgress=Math.round(e.loaded/e.total*50));}).then(e=>{if(e.scene.position.set(0,.1,0),this.scene.add(e.scene),t.setModelRoot(e.scene),e.scene.updateMatrixWorld(!0),this.heatmapManager){var r=new o.Box3().setFromObject(e.scene);this.heatmapManager.setXZBoundsFromBox3(r);}var n=new o.AnimationMixer(e.scene);this.addMixer(n),e.scene.traverse(e=>{e.isMesh&&(e.receiveShadow=!0,e.castShadow=!0,e.name.endsWith("Glass")&&(e.castShadow=!1));});var s=e.scene.getObjectByName("Door");s&&s.children.forEach(t=>{M.doorManager.addDoor(t,e.animations,n);}),b.colliderManager.generateCollider(e.scene,this.scene,e=>{this.setEnvironmentCollider(e);}),b.colliderManager.setVisibility(t.showCollisionBoxes),i();}).catch(e=>{console.error("模型加载失败:",e),t.isLoading=!1;}),this.currentController.enter(),e.f(w).renderer.setAnimationLoop(this.animate);}handleRendererChange(t){Object.values(this.controllers).forEach(e=>{e.setDomElement(t.domElement);}),this.postProcessing=new u.PostProcessing(t,this.scene,e.f(w).camera),this.heatmapManager&&this.heatmapManager.setRenderer(t),this.modelLoader&&this.modelLoader.updateRenderer(t),this.setupEnvironment(t),t.setAnimationLoop(this.animate);}setupEnvironment(e){var t=new o.PMREMGenerator(e);this.environmentTexture=t.fromScene(new a.RoomEnvironment,.04).texture,this.scene.environment=this.environmentTexture;}addMixer(e){this.mixers.push(e);}setCharacter(e){this.character=e,e.mesh&&(this.scene.add(e.mesh),this.controllers.thirdPerson.setCharacter(e));}async updateGTAO(t){this.gtaoEnabled!==t.enabled&&(this.gtaoEnabled=t.enabled,await e.f(w).recreateRenderer(!t.enabled)),this.postProcessing&&this.postProcessing.update(t);}lockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!0):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!0);}unlockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!1):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!1);}setMovementMode(e){if(this.movementMode!==e){this.currentController.leave(),this.movementMode=e,this.currentController=this.controllers[e],this.currentController.enter(),"topView"!==e&&this.setHeatmapVisible(!1);var t=y.useSceneStore();this.setHeatmapVisible(t.showHeatmap);}}setCameraPosition(t){e.f(w).camera.position.copy(t);}setCameraDirection(t){"orbit"!==this.movementMode&&0!==t.lengthSq()&&e.f(w).camera.lookAt(t.add(e.f(w).camera.position));}getCameraDirection(){var t=new o.Vector3;return e.f(w).camera.getWorldDirection(t),t;}onUpdate(e){return this.updateListeners.add(e),()=>this.updateListeners.delete(e);}dispose(){e.f(w).renderer.setAnimationLoop(null),Object.values(this.controllers).forEach(e=>e.dispose()),e.f(w).dispose();}setEnvironmentEnabled(e){this.scene.environment=e?this.environmentTexture:null;}setEnvironmentIntensity(e){this.scene.environmentIntensity=e;}setEnvironmentCollider(e){this.controllers.thirdPerson.setCollider(e);}setSkybox(e){this.skyboxTexture=e,this.scene.background=e;}setSkyboxEnabled(e){this.scene.background=e?this.skyboxTexture:null;}setHeatmapVisible(e){var t,r;"topView"===this.movementMode?null===(t=this.heatmapManager)||void 0===t||t.setVisible(e):null===(r=this.heatmapManager)||void 0===r||r.setVisible(!1);}constructor(){s._(this,"scene",void 0),s._(this,"postProcessing",null),s._(this,"gtaoEnabled",!0),s._(this,"controllers",void 0),s._(this,"currentController",void 0),s._(this,"movementMode","fly"),s._(this,"clock",new o.Clock),s._(this,"environmentTexture",null),s._(this,"mixers",[]),s._(this,"skyboxTexture",null),s._(this,"character",null),s._(this,"lightManager",null),s._(this,"heatmapManager",null),s._(this,"modelLoader",null),s._(this,"updateListeners",new Set),s._(this,"animate",()=>{var t,r=this.clock.getDelta();this.mixers.forEach(e=>e.update(r)),null===(t=this.character)||void 0===t||t.update(r),this.character&&this.character.mesh&&this.heatmapManager&&this.character.velocity.lengthSq()>1&&"thirdPerson"===this.movementMode&&this.heatmapManager.update(this.character.mesh.position),this.currentController.update(r),this.updateListeners.forEach(e=>e(r)),e.f(w).stats.update(),this.postProcessing&&this.gtaoEnabled?this.postProcessing.render():e.f(w).renderer.render(this.scene,e.f(w).camera),m.InputManager.getInstance().update();}),this.scene=new o.Scene,this.controllers={fly:new i.FlyController(e.f(w).camera,e.f(w).renderer.domElement),orbit:new h.OrbitController(e.f(w).camera,e.f(w).renderer.domElement),thirdPerson:new d.ThirdPersonController(e.f(w).camera,e.f(w).renderer.domElement),topView:new l.TopViewController(e.f(w).camera,e.f(w).renderer.domElement)},this.currentController=this.controllers.fly;}}var P=new x;t.default=P;},"69939ce5":function e(e,t,i,s){e._m(t),e.o(t,"ThirdPersonController",()=>m);var r=i("09efd1d2"),o=e.w(i("3b16918b")),a=i("23b6b720"),n=i("f247f526"),l=i("0e70da6a"),h=i("9aaf3498"),c=i("96554b2f"),d=i("3eec3e47");class m{setDomElement(e){this.isActive&&this.domElement.removeEventListener("click",this.onClick),this.domElement=e,this.thirdPersonCamera.setDomElement(e),this.isActive&&this.domElement.addEventListener("click",this.onClick);}setCharacter(e){e.mesh&&this.setPlayerMesh(e.mesh),this.playerVelocity=e.velocity;}setPlayerMesh(e){this.playerMesh=e,this.thirdPersonCamera.setTarget(e);}setCollider(e){this.collider=e,this.thirdPersonCamera.setCollider(e);}enter(){this.isActive=!0,this.domElement.addEventListener("click",this.onClick),this.playerMesh&&this.thirdPersonCamera.syncWithCamera();var e=l.storeToRefs(n.useSceneStore()),t=e.moveSpeed,i=e.collisionEnabled;this.moveSpeed=t,this.collisionEnabled=i;}leave(){this.isActive=!1,this.domElement.removeEventListener("click",this.onClick),this.thirdPersonCamera.setLocked(!1),document.pointerLockElement===this.domElement&&document.exitPointerLock();}update(e){this.handleInput(e),this.updatePlayer(e),this.thirdPersonCamera.update(e),this.playerMesh&&c.doorManager.update(this.playerMesh.position);}dispose(){this.thirdPersonCamera.dispose();}onClick(){document.pointerLockElement||(this.domElement.requestPointerLock(),this.thirdPersonCamera.setLocked(!0));}handleInput(e){if(this.playerMesh){var t=d.InputManager.getInstance(),i=t.getMovementInput();if(t.isKeyDown("KeyF")&&c.doorManager.interact(),this.camera.getWorldDirection(this.tempForward),this.tempForward.y=0,this.tempForward.normalize(),this.tempRight.crossVectors(this.tempForward,this.camera.up).normalize(),this.playerDirection.set(0,0,0),this.playerDirection.addScaledVector(this.tempForward,i.z),this.playerDirection.addScaledVector(this.tempRight,i.x),this.playerDirection.lengthSq()>0){this.playerDirection.normalize(),this.playerVelocity.add(this.playerDirection.multiplyScalar(this.moveSpeed.value*e));var s=Math.atan2(this.playerDirection.x,this.playerDirection.z),r=new o.Quaternion;r.setFromAxisAngle(new o.Vector3(0,1,0),s),this.playerMesh.quaternion.slerp(r,.2);}}}updatePlayer(e){if(this.playerMesh){var t=Math.exp(-4*e)-1;this.playerVelocity.addScaledVector(this.playerVelocity,t);var i=this.playerVelocity.clone().multiplyScalar(e);this.collider&&this.collisionEnabled.value&&(this.resolveCollisions(i),c.doorManager.checkCollision(this.playerMesh.position,.15,i)),this.playerMesh.position.add(i);}}resolveCollisions(e){if(this.playerMesh&&this.collider){var t=new o.Vector3(0,.2,0),i=this.playerMesh.position.clone().add(t).add(e),s=this.collider.geometry.boundsTree;if(s){for(var r=new o.Vector3,a=0;a<5;a++)s.shapecast({intersectsBounds:e=>.15>e.distanceToPoint(i),intersectsTriangle:e=>{var t=e.closestPointToPoint(i,r).distanceTo(i);if(t<.15){var s=.15-t,o=i.clone().sub(r).normalize();o.y=0,i.addScaledVector(o,s);}}});var n=i.clone().sub(t);e.copy(n).sub(this.playerMesh.position);}}}setLocked(e){this.thirdPersonCamera.setLocked(e),e?this.domElement.requestPointerLock():document.pointerLockElement===this.domElement&&document.exitPointerLock();}constructor(e,t){r._(this,"camera",void 0),r._(this,"domElement",void 0),r._(this,"thirdPersonCamera",void 0),r._(this,"playerMesh",null),r._(this,"playerVelocity",new o.Vector3),r._(this,"playerDirection",new o.Vector3),r._(this,"tempForward",new o.Vector3),r._(this,"tempRight",new o.Vector3),r._(this,"collider",null),r._(this,"moveSpeed",h.ref(0)),r._(this,"collisionEnabled",h.ref(!0)),r._(this,"isActive",!1),this.camera=e,this.domElement=t,this.thirdPersonCamera=new a.ThirdPersonCamera(e,t),this.onClick=this.onClick.bind(this);}}},"71200ed9":function e(e,a,t,n){e._m(a),e.o(a,"useViewerSync",()=>r);var i=t("15edfc35"),o=t("9aaf3498"),l=t("0e70da6a"),s=t("f247f526"),u=e.i(t("26d7988f")),c=e.i(t("67dbd159")),v=e.w(t("3b16918b")),f=t("c2079dd8");function r(){var a=s.useSceneStore(),t=l.storeToRefs(a),n=t.cameraPosition,r=t.cameraDirection,d=t.isEditingPosition,h=t.isEditingDirection,m=t.movementMode,E=t.skyboxEnabled,p=t.showHeatmap,g=t.showCollisionBoxes,b=t.statsVisible,w=t.playerPosition,y=t.isEditingPlayerPosition,P=t.environmentEnabled,S=t.environmentIntensity,C=t.gtaoEnabled,D=t.gtaoSamples,x=t.gtaoDistanceExponent,M=t.gtaoDistanceFallOff,V=t.gtaoRadius,I=t.gtaoScale,O=t.gtaoThickness,k=t.gtaoAoOnly,A=t.sunEnabled,z=t.sunColor,L=t.sunIntensity,T=t.sunPosition,F=t.ambientEnabled,H=t.ambientColor,R=t.ambientIntensity,U=t.spotEnabled,_=t.spotColor,q=t.spotIntensity,B=t.spotAngle,G=t.spotPenumbra,j=t.spotDecay,J=t.spotDistance;o.watchEffect(()=>{if(d.value){var a=n.value,t=a.x,i=a.y,o=a.z;e.f(c).setCameraPosition(new v.Vector3(t,i,o));}}),o.watchEffect(()=>{if(h.value){var a=r.value,t=a.x,n=a.y,i=a.z,o=new v.Vector3(t,n,i);o.lengthSq()>0&&e.f(c).setCameraDirection(o);}}),o.watchEffect(()=>{var a;if(y.value&&(null===(a=e.f(c).character)||void 0===a?void 0:a.mesh)){var t=w.value,n=t.x,i=t.y,o=t.z;e.f(c).character.mesh.position.set(n,i,o);}}),o.watchEffect(()=>{e.f(c).setMovementMode(m.value);}),o.watchEffect(()=>{e.f(c).setSkyboxEnabled(E.value);}),o.watchEffect(()=>{e.f(c).setHeatmapVisible(p.value);}),o.watchEffect(()=>{f.colliderManager.setVisibility(g.value);}),o.watchEffect(()=>{e.f(u).setStatsVisible(b.value);}),o.watchEffect(()=>{e.f(c).setEnvironmentEnabled(P.value);}),o.watchEffect(()=>{e.f(c).setEnvironmentIntensity(S.value);}),o.watchEffect(()=>{e.f(c).updateGTAO({enabled:C.value,samples:D.value,distanceExponent:x.value,distanceFallOff:M.value,radius:V.value,scale:I.value,thickness:O.value,aoOnly:k.value});}),o.watchEffect(()=>{var a;null===(a=e.f(c).lightManager)||void 0===a||a.updateSunLight(A.value,z.value,L.value,i._({},T.value));}),o.watchEffect(()=>{var a;null===(a=e.f(c).lightManager)||void 0===a||a.updateAmbientLight(F.value,H.value,R.value);}),o.watchEffect(()=>{var a;null===(a=e.f(c).lightManager)||void 0===a||a.updateSpotLight(U.value,_.value,q.value,B.value,G.value,j.value,J.value);});var K=e.f(c).onUpdate(()=>{var t;d.value||a.updateCameraPosition(e.f(u).camera.position),h.value||a.updateCameraDirection(e.f(c).getCameraDirection()),"thirdPerson"===m.value&&!y.value&&(null===(t=e.f(c).character)||void 0===t?void 0:t.mesh)&&a.updatePlayerPosition(e.f(c).character.mesh.position);});o.onUnmounted(()=>{K();});}},"7c3ee4ab":function e(e,t,a,l){e._m(t);var n=a("b5537c77");a("c550eeaa"),a("2d08c2e5"),a("a3876e70"),a("2554870f"),a("c98af605");var r=a("9aaf3498"),c=a("9aaf3498"),o=a("9aaf3498"),i=a("1f6a8afd"),u=a("0e70da6a"),d=a("f247f526"),v={class:"scene-tree-container"};t.default=r.defineComponent({__name:"SceneTreePanel",setup(e){var t=d.useSceneStore(),a=u.storeToRefs(t),l=a.modelRoot,r=a.movementMode,f=o.ref([]),h=o.ref([]),s=o.ref(4),p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=t?"".concat(t,"-").concat(e.id):"".concat(e.id),n={key:l,label:e.name||"".concat(e.type," #").concat(e.id),object3D:e};return e.children.length>0&&a<s.value&&(n.children=e.children.map(e=>p(e,l,a+1))),n;},y=e=>{var t=[],a=e=>{var l=!0,n=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(l=(c=o.next()).done);l=!0){var i=c.value;t.push(i.key),i.children&&a(i.children);}}catch(e){n=!0,r=e;}finally{try{l||null==o.return||o.return();}finally{if(n)throw r;}}};return a(e),t;},m=()=>{if(l.value){var e=p(l.value);f.value=[e],h.value=y(f.value);}},x=(e,t,a)=>{var l=a.node;l&&(l.object3D.visible="check"===a.action),h.value=e;};return o.watch(l,e=>{e&&m();},{immediate:!0}),o.watch(s,()=>{m();}),o.watch(r,e=>{var t="topView"===e,a=function(e){var t=f.value,a=!0,l=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(a=(c=o.next()).done);a=!0){var i=function(){var a=c.value,l=t.find(e=>e.object3D.name===a);return l?a===e[e.length-1]?{v:l}:void(t=l.children||[]):{v:null};}();if("object"===n._(i))return i.v;}}catch(e){l=!0,r=e;}finally{try{a||null==o.return||o.return();}finally{if(l)throw r;}}return null;}(["Scene","Scene_Collection","Ceiling"]);a&&(a.object3D.visible=!t,t?h.value=h.value.filter(e=>e!==a.key):h.value.includes(a.key)||h.value.push(a.key));}),(e,t)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createVNode(c.unref(i.NText),{depth:"3"},{default:c.withCtx(()=>[...t[1]||(t[1]=[c.createTextVNode("勾选/取消勾选以显示/隐藏模型层级中的对象。",-1)])]),_:1}),c.createVNode(c.unref(i.NSpace),{vertical:"",size:"small",style:{"margin-top":"12px","margin-bottom":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NSpace),{justify:"space-between",style:{width:"100%"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NText),{depth:"2",style:{"font-size":"12px"}},{default:c.withCtx(()=>[...t[2]||(t[2]=[c.createTextVNode("显示深度",-1)])]),_:1}),c.createVNode(c.unref(i.NText),null,{default:c.withCtx(()=>[c.createTextVNode(c.toDisplayString(s.value)+" 层",1)]),_:1})]),_:1}),c.createVNode(c.unref(i.NSlider),{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),min:1,max:10,step:1},null,8,["value"])]),_:1}),c.createElementVNode("div",v,[c.createVNode(c.unref(i.NTree),{data:f.value,"checked-keys":h.value,"onUpdate:checkedKeys":x,checkable:"",selectable:"","block-line":"","expand-on-click":"","default-expand-all":"",style:{"font-size":"12px"}},null,8,["data","checked-keys"])])],64));}});},"96554b2f":function t(t,i,o,n){t._m(i),t.o(i,"Door",()=>s),t.o(i,"DoorManager",()=>c),t.o(i,"doorManager",()=>h);var e=o("09efd1d2");o("c550eeaa"),o("2d08c2e5"),o("a3876e70");var a=t.w(o("3b16918b")),r=o("f247f526");class s{get isAnimating(){return!!this.action&&this.action.isRunning();}interact(){this.action&&(this.isOpen=!this.isOpen,this.action.paused=!1,this.isOpen?this.action.timeScale=1:this.action.timeScale=-1,this.action.play());}getDistance(t){return this.object.getWorldPosition(this.worldPosition),this.worldPosition.distanceTo(t);}constructor(t,i,o){e._(this,"object",void 0),e._(this,"isOpen",!1),e._(this,"mixer",void 0),e._(this,"action",null),e._(this,"box",void 0),e._(this,"worldPosition",new a.Vector3),this.object=t,this.box=new a.Box3().setFromObject(t),this.mixer=o;var n=t.name+"Open",r=i.find(t=>t.name===n);r?(this.action=this.mixer.clipAction(r),this.action.loop=a.LoopOnce,this.action.clampWhenFinished=!0):console.warn("Animation ".concat(n," not found for door ").concat(t.name));}}class c{addDoor(t,i,o){if(!this.doors.find(i=>i.object===t)){var n=new s(t,i,o);this.doors.push(n);}}update(t){var i=null,o=1/0,n=!0,e=!1,a=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value,l=h.getDistance(t);l<this.interactionDistance&&l<o&&(o=l,i=h);}}catch(t){e=!0,a=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw a;}}var x=r.useSceneStore();i?(this.activeDoor=i,x.showInteractionPrompt=!0,x.interactionText=i.isOpen?"按 F 关门":"按 F 开门"):(this.activeDoor=null,x.showInteractionPrompt=!1);}interact(){this.activeDoor&&this.activeDoor.interact();}checkCollision(t,i,o){var n=!0,e=!1,r=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value;if(!h.isOpen&&!h.isAnimating){h.box.setFromObject(h.object);var l=new a.Box3,x=t.clone().add(o);if(l.min.set(x.x-i,x.y,x.z-i),l.max.set(x.x+i,x.y+2,x.z+i),h.box.intersectsBox(l)){var d=h.box.clone().intersect(l),m=d.max.x-d.min.x,v=d.max.z-d.min.z;m<v?x.x<h.box.min.x+(h.box.max.x-h.box.min.x)/2?o.x-=m:o.x+=m:x.z<h.box.min.z+(h.box.max.z-h.box.min.z)/2?o.z-=v:o.z+=v;}}}}catch(t){e=!0,r=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw r;}}}constructor(){e._(this,"doors",[]),e._(this,"interactionDistance",2),e._(this,"activeDoor",null);}}var h=new c;},"ae64a1a9":function s(s,i,t,e){s._m(i),s.o(i,"HeatmapManager",()=>h);var a=t("09efd1d2"),o=s.w(t("3b16918b")),r=t("16fd0772");class h{createDisplayMesh(s){var i=new o.PlaneGeometry(1,1);i.rotateX(-Math.PI/2),this.showTexture2Uniform=r.uniform(0);var t=this.params.flipV?r.uv().flipY():r.uv(),e=r.texture(this.storageTexture1).sample(t).r,a=r.texture(this.storageTexture2).sample(t).r,h=r.mix(e,a,this.showTexture2Uniform),n=r.float(this.params.displayGamma),m=r.pow(h.max(0),n),u=r.float(this.params.redBias),d=r.float(.05),l=r.smoothstep(u.sub(d),u.add(d),m),p=r.vec3(0,0,1),f=r.vec3(0,1,0),x=r.vec3(1,0,0),c=r.mix(p,f,m.mul(2).min(1)),v=r.mix(f,x,m.mul(2).sub(1).max(0)),y=r.mix(c,v,l),M=r.smoothstep(.02,.12,m).mul(.6),b=new o.MeshBasicNodeMaterial;b.colorNode=y,b.opacityNode=M,b.transparent=!0,b.side=o.DoubleSide,b.depthWrite=!1,b.polygonOffset=!0,b.polygonOffsetFactor=-1,this.displayMesh=new o.Mesh(i,b),this.displayMesh.position.y=.5,this.updateDisplayMeshTransform(),this.displayMesh.visible=!1,s.add(this.displayMesh);}update(s){this.characterPosUniform.value.copy(s),this.pingPong?(this.renderer.compute(this.computeNode2),this.showTexture2Uniform.value=0,this.pingPong=!1):(this.renderer.compute(this.computeNode1),this.showTexture2Uniform.value=1,this.pingPong=!0);}setVisible(s){this.displayMesh&&(this.displayMesh.visible=s);}setRenderer(s){this.renderer=s;}setXZBoundsFromBox3(s){var i=s.min,t=s.max;this.boundsMinUniform.value.set(i.x,i.z),this.boundsMaxUniform.value.set(t.x,t.z),this.updateDisplayMeshTransform();}updateDisplayMeshTransform(){if(this.displayMesh){var s=this.boundsMinUniform.value,i=this.boundsMaxUniform.value,t=i.x-s.x,e=i.y-s.y,a=(s.x+i.x)*.5,o=(s.y+i.y)*.5;this.displayMesh.scale.set(t,1,e),this.displayMesh.position.x=a,this.displayMesh.position.z=o;}}constructor(s){a._(this,"displayMesh",null),a._(this,"renderer",void 0),a._(this,"storageTexture1",void 0),a._(this,"storageTexture2",void 0),a._(this,"computeNode1",void 0),a._(this,"computeNode2",void 0),a._(this,"characterPosUniform",void 0),a._(this,"boundsMinUniform",void 0),a._(this,"boundsMaxUniform",void 0),a._(this,"pingPong",!1),a._(this,"showTexture2Uniform",void 0),a._(this,"params",{size:100,resolution:1024,brushRadius:1.5,intensity:.05,decay:1e-4,flipV:!0,displayGamma:2.2,redBias:.75}),this.renderer=s;var i=()=>{var s=new o.StorageTexture(this.params.resolution,this.params.resolution);return s.type=o.FloatType,s.format=o.RedFormat,s.minFilter=o.LinearFilter,s.magFilter=o.LinearFilter,s;};this.storageTexture1=i(),this.storageTexture2=i(),this.characterPosUniform=r.uniform(r.vec3(0)),this.boundsMinUniform=r.uniform(r.vec2(-this.params.size/2,-this.params.size/2)),this.boundsMaxUniform=r.uniform(r.vec2(this.params.size/2,this.params.size/2));var t=(s,i)=>r.Fn(()=>{var t=r.float(this.params.resolution),e=r.float(this.params.resolution),a=r.instanceIndex.mod(this.params.resolution),o=r.instanceIndex.div(this.params.resolution),h=r.uvec2(a,o),n=r.texture(s).load(h).r,m=a.toVar().toFloat().add(.5).div(t),u=o.toVar().toFloat().add(.5).div(e),d=r.mix(this.boundsMinUniform.x,this.boundsMaxUniform.x,m),l=r.mix(this.boundsMinUniform.y,this.boundsMaxUniform.y,u),p=r.vec2(d,l).distance(r.vec2(this.characterPosUniform.x,this.characterPosUniform.z)),f=r.float(this.params.decay),x=n.mul(r.float(1).sub(f)).toVar(),c=p.div(this.params.brushRadius),v=r.float(1).sub(c).max(0),y=v.mul(v).mul(r.float(3).sub(v.mul(2)));x.addAssign(y.mul(this.params.intensity));var M=x.min(1);r.textureStore(i,h,r.vec4(M,0,0,0));})().compute(this.params.resolution*this.params.resolution);this.computeNode1=t(this.storageTexture1,this.storageTexture2),this.computeNode2=t(this.storageTexture2,this.storageTexture1);}}},"b7044e63":function e(e,t,u,a){e._m(t);var l=u("15edfc35"),n=u("94a74ea6");u("2d08c2e5"),u("a3876e70");var r=u("9aaf3498"),o=u("9aaf3498"),d=u("9aaf3498"),i=u("1f6a8afd");t.default=r.defineComponent({__name:"Vector3Input",props:{value:{required:!0},valueModifiers:{},editing:{type:Boolean},editingModifiers:{}},emits:["update:value","update:editing"],setup(e){var t=r.useModel(e,"value"),u=r.useModel(e,"editing"),a=()=>u.value=!0,f=()=>u.value=!1,s=e=>d.computed({get:()=>t.value[e],set:u=>{null!==u&&(t.value=n._(l._({},t.value),{[e]:u}));}}),c=s("x"),N=s("y"),v=s("z");return(e,t)=>(o.openBlock(),o.createBlock(o.unref(i.NGrid),{cols:3,"x-gap":8},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[3]||(t[3]=[o.createTextVNode("X",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(c),"onUpdate:value":t[0]||(t[0]=e=>o.isRef(c)?c.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1}),o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[4]||(t[4]=[o.createTextVNode("Y",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(N),"onUpdate:value":t[1]||(t[1]=e=>o.isRef(N)?N.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1}),o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[5]||(t[5]=[o.createTextVNode("Z",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(v),"onUpdate:value":t[2]||(t[2]=e=>o.isRef(v)?v.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1})]),_:1}));}});},"f247f526":function e(e,r,f,a){e._m(r),e.o(r,"useSceneStore",()=>n),f("bf3a4d74"),f("db38ec0f");var F=f("0e70da6a"),o=f("9aaf3498"),t=(e,r)=>{r.x=parseFloat(e.x.toFixed(2)),r.y=parseFloat(e.y.toFixed(2)),r.z=parseFloat(e.z.toFixed(2));},n=F.defineStore("scene",()=>{var e=o.ref(!0),r=o.ref(0),f=o.ref(!0),a=o.ref(null),F=o.ref("fly"),n=o.ref(20),u=o.ref({x:1,y:1,z:1}),i=o.ref({x:0,y:0,z:-1}),l=o.ref(!1),d=o.ref(!1),c=o.ref({x:0,y:.1,z:0}),x=o.ref(!1),s=o.ref(!1),y=o.ref(!0),p=o.ref(!0),v=o.ref(!1),z=o.ref(""),m=o.ref(!0),P=o.ref(!1),S=o.ref(!0),b=o.ref("#FFFFFF"),C=o.ref(5),R=o.ref({x:10,y:20,z:-20}),k=o.ref(!1),w=o.ref("#FFFFFF"),D=o.ref(1),I=o.ref(!0),M=o.ref(1),_=o.ref(!1),g=o.ref(16),h=o.ref(2),j=o.ref(1),q=o.ref(.25),A=o.ref(1),B=o.ref(1),E=o.ref(!1),G=o.ref(!1),H=o.ref("#FFFFFF"),J=o.ref(1),K=o.ref(30),L=o.ref(.3),N=o.ref(1),O=o.ref(1e3);return{isLoading:e,loadingProgress:r,rendererInfo:o.ref(""),isDarkMode:f,modelRoot:a,movementMode:F,moveSpeed:n,cameraPosition:u,cameraDirection:i,isEditingPosition:l,isEditingDirection:d,playerPosition:c,isEditingPlayerPosition:x,showCollisionBoxes:s,collisionEnabled:y,statsVisible:p,showInteractionPrompt:v,interactionText:z,skyboxEnabled:m,showHeatmap:P,sunEnabled:S,sunColor:b,sunIntensity:C,sunPosition:R,ambientEnabled:k,ambientColor:w,ambientIntensity:D,environmentEnabled:I,environmentIntensity:M,gtaoEnabled:_,gtaoSamples:g,gtaoDistanceExponent:h,gtaoDistanceFallOff:j,gtaoRadius:q,gtaoScale:A,gtaoThickness:B,gtaoAoOnly:E,spotEnabled:G,spotColor:H,spotIntensity:J,spotAngle:K,spotPenumbra:L,spotDecay:N,spotDistance:O,setModelRoot:function(e){a.value=e?o.markRaw(e):null;},updateCameraPosition:function(e){t(e,u.value);},updateCameraDirection:function(e){t(e,i.value);},updatePlayerPosition:function(e){t(e,c.value);}};});},"f49f4847":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var n=a("9aaf3498"),u=a("9aaf3498"),i=a("1f6a8afd"),r=a("0e70da6a"),o=a("f247f526"),d=e.i(a("c879eb01"));t.default=n.defineComponent({__name:"MovementPanel",setup(t){var a=o.useSceneStore(),l=r.storeToRefs(a),n=l.movementMode,f=l.moveSpeed,c=l.cameraPosition,s=l.cameraDirection,N=l.isEditingPosition,p=l.isEditingDirection,v=l.playerPosition,x=l.isEditingPlayerPosition,h=[{label:"飞行",value:"fly"},{label:"轨道",value:"orbit"},{label:"第三人称",value:"thirdPerson"},{label:"俯视",value:"topView"}];return(t,l)=>(u.openBlock(),u.createBlock(u.unref(i.NSpace),{vertical:"",size:"large"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...l[9]||(l[9]=[u.createTextVNode("移动方式",-1)])]),_:1}),u.createVNode(u.unref(i.NSelect),{value:u.unref(n),"onUpdate:value":l[0]||(l[0]=e=>u.isRef(n)?n.value=e:null),options:h},null,8,["value"])]),_:1}),"topView"===u.unref(n)?(u.openBlock(),u.createBlock(u.unref(i.NSpace),{key:0,vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...l[10]||(l[10]=[u.createTextVNode("俯视图设置",-1)])]),_:1}),u.createVNode(u.unref(i.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NSwitch),{value:u.unref(a).showHeatmap,"onUpdate:value":l[1]||(l[1]=e=>u.unref(a).showHeatmap=e)},null,8,["value"]),u.createVNode(u.unref(i.NText),null,{default:u.withCtx(()=>[...l[11]||(l[11]=[u.createTextVNode("显示热力图",-1)])]),_:1})]),_:1})]),_:1})):u.createCommentVNode("",!0),u.createVNode(u.unref(i.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NSpace),{justify:"space-between",style:{width:"100%"}},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...l[12]||(l[12]=[u.createTextVNode("移动速度",-1)])]),_:1}),u.createVNode(u.unref(i.NText),null,{default:u.withCtx(()=>[u.createTextVNode(u.toDisplayString(Math.round(u.unref(f)))+" u/s",1)]),_:1})]),_:1}),u.createVNode(u.unref(i.NSlider),{value:u.unref(f),"onUpdate:value":l[2]||(l[2]=e=>u.isRef(f)?f.value=e:null),min:1,max:50,step:1},null,8,["value"])]),_:1}),u.createVNode(u.unref(i.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NText),{depth:"2",style:{"font-weight":"600"}},{default:u.withCtx(()=>[...l[13]||(l[13]=[u.createTextVNode("摄像机位置",-1)])]),_:1}),u.createVNode(e.f(d),{value:u.unref(c),"onUpdate:value":l[3]||(l[3]=e=>u.isRef(c)?c.value=e:null),editing:u.unref(N),"onUpdate:editing":l[4]||(l[4]=e=>u.isRef(N)?N.value=e:null)},null,8,["value","editing"])]),_:1}),"thirdPerson"===u.unref(n)?(u.openBlock(),u.createBlock(u.unref(i.NSpace),{key:1,vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NText),{depth:"2",style:{"font-weight":"600"}},{default:u.withCtx(()=>[...l[14]||(l[14]=[u.createTextVNode("玩家位置",-1)])]),_:1}),u.createVNode(e.f(d),{value:u.unref(v),"onUpdate:value":l[5]||(l[5]=e=>u.isRef(v)?v.value=e:null),editing:u.unref(x),"onUpdate:editing":l[6]||(l[6]=e=>u.isRef(x)?x.value=e:null)},null,8,["value","editing"])]),_:1})):u.createCommentVNode("",!0),u.createVNode(u.unref(i.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(i.NText),{depth:"2",style:{"font-weight":"600"}},{default:u.withCtx(()=>[...l[15]||(l[15]=[u.createTextVNode("摄像机方向",-1)])]),_:1}),u.createVNode(e.f(d),{value:u.unref(s),"onUpdate:value":l[7]||(l[7]=e=>u.isRef(s)?s.value=e:null),editing:u.unref(p),"onUpdate:editing":l[8]||(l[8]=e=>u.isRef(p)?p.value=e:null)},null,8,["value","editing"])]),_:1})]),_:1}));}});},"ff9d919c":function e(e,t,o,r){e._m(t),o("2d08c2e5"),o("a3876e70");var a=o("9aaf3498"),c=o("9aaf3498"),d=o("1f6a8afd"),n=o("9aaf3498");t.default=a.defineComponent({__name:"PointerLockPrompt",props:{visible:{type:Boolean},mode:{}},emits:["enterPointerLock"],setup(e,t){var o=t.emit,r=n.computed(()=>"fly"===e.mode?"自由飞行视角":"第三人称视角");return(t,a)=>c.withDirectives((c.openBlock(),c.createBlock(c.unref(d.NCard),{class:"controls-overlay",bordered:!1,size:"small",title:r.value},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NText),{depth:"3"},{default:c.withCtx(()=>["fly"===e.mode?(c.openBlock(),c.createElementBlock(c.Fragment,{key:0},[a[4]||(a[4]=c.createTextVNode(" 点击下方按钮以锁定鼠标，使用 ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[1]||(a[1]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[5]||(a[5]=c.createTextVNode(" 移动，",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[2]||(a[2]=[c.createTextVNode("空格",-1)])]),_:1}),a[6]||(a[6]=c.createTextVNode(" 上升，",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[3]||(a[3]=[c.createTextVNode("Shift",-1)])]),_:1}),a[7]||(a[7]=c.createTextVNode(" 下降，鼠标旋转方向。 ",-1))],64)):(c.openBlock(),c.createElementBlock(c.Fragment,{key:1},[a[9]||(a[9]=c.createTextVNode(" 点击下方按钮以锁定鼠标，使用 ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[8]||(a[8]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[10]||(a[10]=c.createTextVNode(" 移动，鼠标旋转视角。 ",-1))],64))]),_:1}),c.createVNode(c.unref(d.NSpace),{vertical:"",style:{"margin-top":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NButton),{type:"primary",onClick:a[0]||(a[0]=e=>o("enterPointerLock")),block:""},{default:c.withCtx(()=>[...a[11]||(a[11]=[c.createTextVNode("开始体验",-1)])]),_:1}),c.createVNode(c.unref(d.NText),{depth:"3",style:{"font-size":"12px"}},{default:c.withCtx(()=>[a[13]||(a[13]=c.createTextVNode("按 ",-1)),c.createVNode(c.unref(d.NText),{code:""},{default:c.withCtx(()=>[...a[12]||(a[12]=[c.createTextVNode("Esc",-1)])]),_:1}),a[14]||(a[14]=c.createTextVNode(" 可退出锁定",-1))]),_:1})]),_:1})]),_:1},8,["title"])),[[c.vShow,e.visible]]);}});},});
//# sourceMappingURL=index_eafd.5eccc83d.js.map