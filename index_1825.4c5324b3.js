(function(_){var filename = ((function(){var _documentCurrentScript = typeof document !== "undefined" ? document.currentScript : null;return typeof document === "undefined" ? require("url").pathToFileURL(__filename).href : _documentCurrentScript && _documentCurrentScript.src || new URL("index_1825.js", document.baseURI).href})());for(var r in _){_[r].__farm_resource_pot__=filename;window['f1d71b9dd14324d7340d3311efaf8136'].__farm_module_system__.register(r,_[r])}})({"03f4e36a":function t(t,e,o,i){t._m(e),t.o(e,"FlyController",()=>d);var s=o("09efd1d2"),c=t.w(o("3b16918b")),r=o("9aaf3498"),n=o("21f39150"),h=o("f247f526"),l=o("0e70da6a"),m=o("3eec3e47");class d{setDomElement(t){var e=this.controls.isLocked;this.leave(),this.domElement=t,this.controls=new n.PointerLockControls(this.camera,t),e&&this.enter();}enter(){this.domElement.addEventListener("click",this.onClick),this.controls.connect(this.domElement),this.controls.lock();var t=l.storeToRefs(h.useSceneStore()).moveSpeed;this.moveSpeed=t;}leave(){this.domElement.removeEventListener("click",this.onClick),this.controls.unlock(),this.controls.disconnect();}update(t){if(this.controls.isLocked){this.velocity.multiplyScalar(Math.exp(-5*t));var e=m.InputManager.getInstance(),o=e.getMovementInput();this.moveUp=e.isKeyPressed("Space"),this.moveDown=e.isKeyPressed("ShiftLeft")||e.isKeyPressed("ShiftRight"),this.direction.set(o.x,Number(this.moveUp)-Number(this.moveDown),o.z),this.direction.lengthSq()>0&&(this.direction.normalize(),this.camera.getWorldDirection(this.tempForward).normalize(),this.tempRight.crossVectors(this.tempForward,new c.Vector3(0,1,0)).normalize(),this.moveVector.copy(this.tempForward).multiplyScalar(this.direction.z),this.moveVector.addScaledVector(this.tempRight,this.direction.x),this.moveVector.y+=this.direction.y,this.moveVector.normalize(),this.velocity.addScaledVector(this.moveVector,this.moveSpeed.value*t)),this.camera.position.addScaledVector(this.velocity,t);}}dispose(){this.controls.dispose();}onClick(){this.controls.isLocked||this.controls.lock();}setLocked(t){t?this.controls.lock():this.controls.unlock();}constructor(t,e){s._(this,"camera",void 0),s._(this,"domElement",void 0),s._(this,"controls",void 0),s._(this,"moveUp",!1),s._(this,"moveDown",!1),s._(this,"velocity",new c.Vector3),s._(this,"direction",new c.Vector3),s._(this,"moveVector",new c.Vector3),s._(this,"tempRight",new c.Vector3),s._(this,"tempForward",new c.Vector3),s._(this,"moveSpeed",r.ref(0)),this.camera=t,this.domElement=e,this.controls=new n.PointerLockControls(t,e),this.onClick=this.onClick.bind(this);}}},"21929cc9":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var r=a("9aaf3498"),u=a("9aaf3498"),n=a("1f6a8afd"),f=a("0e70da6a"),d=a("f247f526");t.default=r.defineComponent({__name:"DebugPanel",setup(e){var t=d.useSceneStore(),a=f.storeToRefs(t),l=a.collisionEnabled,r=a.showCollisionBoxes,c=a.rendererInfo;return(e,a)=>(u.openBlock(),u.createBlock(u.unref(n.NSpace),{vertical:"",size:"large"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[u.createTextVNode("æ¸²æŸ“åŽç«¯ï¼š"+u.toDisplayString(u.unref(c)),1)]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...a[3]||(a[3]=[u.createTextVNode("ç¢°æ’ž",-1)])]),_:1}),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(l),"onUpdate:value":a[0]||(a[0]=e=>u.isRef(l)?l.value=e:null)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[4]||(a[4]=[u.createTextVNode("å¯ç”¨ç¢°æ’ž",-1)])]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace)),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(r),"onUpdate:value":a[1]||(a[1]=e=>u.isRef(r)?r.value=e:null)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[5]||(a[5]=[u.createTextVNode("æ˜¾ç¤ºç¢°æ’žç®±",-1)])]),_:1})]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...a[6]||(a[6]=[u.createTextVNode("æ€§èƒ½ç»Ÿè®¡",-1)])]),_:1}),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(t).statsVisible,"onUpdate:value":a[2]||(a[2]=e=>u.unref(t).statsVisible=e)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[7]||(a[7]=[u.createTextVNode("æ˜¾ç¤º Stats",-1)])]),_:1})]),_:1})]),_:1})]),_:1}));}});},"23b6b720":function t(t,e,i,s){t._m(e),t.o(e,"ThirdPersonCamera",()=>o);var h=i("09efd1d2"),a=t.w(i("3b16918b"));class o{setTarget(t){this.target=t,this.syncWithCamera();}setCollider(t){this.collider=t;}syncWithCamera(){if(this.target){var t=new a.Vector3().subVectors(this.camera.position,this.target.position);this.radius=t.length(),this.currentRadius=this.radius,this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(a.MathUtils.clamp(t.y/this.radius,-1,1)),this.targetTheta=this.theta,this.targetPhi=this.phi;}}onMouseMove(t){this.isLocked&&(this.targetTheta-=t.movementX*this.sensitivity,this.targetPhi-=t.movementY*this.sensitivity,this.targetPhi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.targetPhi)));}onMouseWheel(t){this.isLocked&&(this.radius+=.005*t.deltaY,this.radius=Math.max(2,Math.min(20,this.radius)));}update(t){if(this.target){var e=1-Math.exp(-25*t),i=this.targetTheta-this.theta;this.theta+=i*e,this.phi+=(this.targetPhi-this.phi)*e;var s=this.target.position.clone().add(this.targetOffset),h=this.radius;if(this.collider){var o=new a.Vector3(0);o.setFromSphericalCoords(1,this.phi,this.theta).normalize();var r=new a.Raycaster(s,o);r.far=this.radius,r.firstHitOnly=!0;var n=r.intersectObject(this.collider,!0);n.length>0&&(h=Math.max(.2,n[0].distance-.2));}var d=-150*(this.currentRadius-h)-20*this.radiusVelocity;this.radiusVelocity+=d*t,this.currentRadius+=this.radiusVelocity*t,this.camera.position.setFromSphericalCoords(this.currentRadius,this.phi,this.theta).add(s),this.camera.lookAt(s);}}setDomElement(t){this.domElement=t;}setLocked(t){this.isLocked=t;}onPointerLockChange(){this.isLocked=document.pointerLockElement===this.domElement;}dispose(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("pointerlockchange",this.onPointerLockChange),document.removeEventListener("wheel",this.onMouseWheel);}constructor(t,e){h._(this,"camera",void 0),h._(this,"domElement",void 0),h._(this,"target",null),h._(this,"theta",0),h._(this,"phi",Math.PI/2),h._(this,"radius",3),h._(this,"currentRadius",3),h._(this,"radiusVelocity",0),h._(this,"collider",null),h._(this,"targetTheta",0),h._(this,"targetPhi",Math.PI/2),h._(this,"minPolarAngle",.1),h._(this,"maxPolarAngle",Math.PI-.1),h._(this,"targetOffset",new a.Vector3(0,1.5,0)),h._(this,"isLocked",!1),h._(this,"sensitivity",.002),this.camera=t,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("pointerlockchange",this.onPointerLockChange),document.addEventListener("wheel",this.onMouseWheel);}}},"3eec3e47":function e(e,s,t,o){e._m(s),e.o(s,"InputManager",()=>u);var n=t("09efd1d2");t("2d08c2e5"),t("a3876e70"),t("7bccf4aa");var i=e.w(t("3b16918b"));class u{static getInstance(){return u.instance||(u.instance=new u),u.instance;}bindEvents(){window.addEventListener("keydown",e=>this.onKeyDown(e)),window.addEventListener("keyup",e=>this.onKeyUp(e)),window.addEventListener("mousedown",e=>this.onMouseDown(e)),window.addEventListener("mouseup",e=>this.onMouseUp(e)),window.addEventListener("mousemove",e=>this.onMouseMove(e)),window.addEventListener("wheel",e=>this.onWheel(e),{passive:!1});}onKeyDown(e){this.keys.has(e.code)||this.keysDown.add(e.code),this.keys.add(e.code);}onKeyUp(e){this.keys.delete(e.code);}onMouseDown(e){this.mouseButtons.has(e.button)||this.mouseButtonsDown.add(e.button),this.mouseButtons.add(e.button);}onMouseUp(e){this.mouseButtons.delete(e.button);}onMouseMove(e){this.mousePosition.set(e.clientX,e.clientY),this.mouseDelta.x+=e.movementX,this.mouseDelta.y+=e.movementY;}onWheel(e){this.mouseWheelDelta+=e.deltaY;}isKeyPressed(e){return this.keys.has(e);}isKeyDown(e){return this.keysDown.has(e);}isMouseButtonPressed(e){return this.mouseButtons.has(e);}isMouseButtonDown(e){return this.mouseButtonsDown.has(e);}getMovementInput(){var e=(this.isKeyPressed("KeyD")||this.isKeyPressed("ArrowRight")?1:0)-(this.isKeyPressed("KeyA")||this.isKeyPressed("ArrowLeft")?1:0),s=(this.isKeyPressed("KeyW")||this.isKeyPressed("ArrowUp")?1:0)-(this.isKeyPressed("KeyS")||this.isKeyPressed("ArrowDown")?1:0);return new i.Vector3(e,0,s);}update(){this.keysDown.clear(),this.mouseButtonsDown.clear(),this.mouseDelta.set(0,0),this.mouseWheelDelta=0;}constructor(){n._(this,"keys",new Set),n._(this,"keysDown",new Set),n._(this,"mouseButtons",new Set),n._(this,"mouseButtonsDown",new Set),n._(this,"mousePosition",new i.Vector2),n._(this,"mouseDelta",new i.Vector2),n._(this,"mouseWheelDelta",0),this.bindEvents();}}n._(u,"instance",void 0);},"4735cb57":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var u=a("9aaf3498"),n=a("9aaf3498"),r=a("1f6a8afd"),f=a("0e70da6a"),d=a("f247f526");t.default=u.defineComponent({__name:"PostProcessPanel",setup(e){var t=d.useSceneStore(),a=f.storeToRefs(t),l=a.gtaoEnabled,u=a.gtaoSamples,i=a.gtaoDistanceExponent,o=a.gtaoDistanceFallOff,s=a.gtaoRadius,N=a.gtaoScale,c=a.gtaoThickness,x=a.gtaoAoOnly;return(e,t)=>(n.openBlock(),n.createBlock(n.unref(r.NSpace),{vertical:"",size:"large"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"2",style:{"font-size":"12px"}},{default:n.withCtx(()=>[...t[8]||(t[8]=[n.createTextVNode("GTAO",-1)])]),_:1}),n.createVNode(n.unref(r.NSpace),{align:"center"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSwitch),{value:n.unref(l),"onUpdate:value":t[0]||(t[0]=e=>n.isRef(l)?l.value=e:null)},null,8,["value"]),n.createVNode(n.unref(r.NText),null,{default:n.withCtx(()=>[...t[9]||(t[9]=[n.createTextVNode("å¯ç”¨ GTAO",-1)])]),_:1})]),_:1}),n.createVNode(n.unref(r.NSpace),{align:"center"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSwitch),{value:n.unref(x),"onUpdate:value":t[1]||(t[1]=e=>n.isRef(x)?x.value=e:null),disabled:!n.unref(l)},null,8,["value","disabled"]),n.createVNode(n.unref(r.NText),null,{default:n.withCtx(()=>[...t[10]||(t[10]=[n.createTextVNode("ä»…æ˜¾ç¤º AO",-1)])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGrid),{cols:2,"x-gap":8,"y-gap":8},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[11]||(t[11]=[n.createTextVNode("Samples",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(u),"onUpdate:value":t[2]||(t[2]=e=>n.isRef(u)?u.value=e:null),size:"small",min:4,max:32,step:1,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[12]||(t[12]=[n.createTextVNode("Radius",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(s),"onUpdate:value":t[3]||(t[3]=e=>n.isRef(s)?s.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[13]||(t[13]=[n.createTextVNode("Distance Exp",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(i),"onUpdate:value":t[4]||(t[4]=e=>n.isRef(i)?i.value=e:null),size:"small",min:1,max:4,step:.1,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[14]||(t[14]=[n.createTextVNode("Distance Falloff",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(o),"onUpdate:value":t[5]||(t[5]=e=>n.isRef(o)?o.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[15]||(t[15]=[n.createTextVNode("Scale",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(N),"onUpdate:value":t[6]||(t[6]=e=>n.isRef(N)?N.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[16]||(t[16]=[n.createTextVNode("Thickness",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(c),"onUpdate:value":t[7]||(t[7]=e=>n.isRef(c)?c.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}));}});},"61fbd776":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70"),a("db38ec0f");var u=a("9aaf3498"),r=a("9aaf3498"),n=a("1f6a8afd"),i=a("0e70da6a"),d=a("f247f526"),f=e.i(a("c879eb01"));t.default=u.defineComponent({__name:"LightingPanel",setup(t){var a=d.useSceneStore(),l=i.storeToRefs(a),u=l.skyboxEnabled,o=l.sunEnabled,c=l.sunColor,N=l.sunIntensity,s=l.sunPosition,x=l.ambientEnabled,v=l.ambientColor,p=l.ambientIntensity,h=l.environmentEnabled,V=l.environmentIntensity,w=l.spotEnabled,C=l.spotColor,_=l.spotIntensity,S=l.spotAngle,m=l.spotPenumbra,T=l.spotDecay,z=l.spotDistance;return(t,a)=>(r.openBlock(),r.createBlock(r.unref(n.NSpace),{vertical:"",size:"large"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(u),"onUpdate:value":a[0]||(a[0]=e=>r.isRef(u)?u.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[17]||(a[17]=[r.createTextVNode("å¤©ç©ºç›’",-1)])]),_:1})]),_:1})]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(o),"onUpdate:value":a[1]||(a[1]=e=>r.isRef(o)?o.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[18]||(a[18]=[r.createTextVNode("å¤ªé˜³å…‰",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[19]||(a[19]=[r.createTextVNode("é¢œè‰²",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(c),"onUpdate:value":a[2]||(a[2]=e=>r.isRef(c)?c.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("äº®åº¦ "+r.toDisplayString(r.unref(N).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(N),"onUpdate:value":a[3]||(a[3]=e=>r.isRef(N)?N.value=e:null),min:0,max:10,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(o)]]),r.withDirectives(r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[20]||(a[20]=[r.createTextVNode("å…‰æºä½ç½®",-1)])]),_:1}),r.createVNode(e.f(f),{value:r.unref(s),"onUpdate:value":a[4]||(a[4]=e=>r.isRef(s)?s.value=e:null)},null,8,["value"])]),_:1},512),[[r.vShow,r.unref(o)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(x),"onUpdate:value":a[5]||(a[5]=e=>r.isRef(x)?x.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[21]||(a[21]=[r.createTextVNode("å…¨å±€çŽ¯å¢ƒå…‰",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[22]||(a[22]=[r.createTextVNode("é¢œè‰²",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(v),"onUpdate:value":a[6]||(a[6]=e=>r.isRef(v)?v.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("äº®åº¦ "+r.toDisplayString(r.unref(p).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(p),"onUpdate:value":a[7]||(a[7]=e=>r.isRef(p)?p.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(x)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(h),"onUpdate:value":a[8]||(a[8]=e=>r.isRef(h)?h.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[23]||(a[23]=[r.createTextVNode("çŽ¯å¢ƒå…‰ç…§ (RoomEnvironment)",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("å¼ºåº¦ "+r.toDisplayString(r.unref(V).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(V),"onUpdate:value":a[9]||(a[9]=e=>r.isRef(V)?V.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1},512),[[r.vShow,r.unref(h)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(w),"onUpdate:value":a[10]||(a[10]=e=>r.isRef(w)?w.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...a[24]||(a[24]=[r.createTextVNode("æ‘„åƒæœºèšå…‰ç¯",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...a[25]||(a[25]=[r.createTextVNode("é¢œè‰²",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(C),"onUpdate:value":a[11]||(a[11]=e=>r.isRef(C)?C.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("äº®åº¦ "+r.toDisplayString(r.unref(_).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(_),"onUpdate:value":a[12]||(a[12]=e=>r.isRef(_)?_.value=e:null),min:0,max:100,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(w)]]),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("é”¥å½¢è§’åº¦ "+r.toDisplayString(r.unref(S))+"Â°",1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(S),"onUpdate:value":a[13]||(a[13]=e=>r.isRef(S)?S.value=e:null),min:5,max:90,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("åŠå½± "+r.toDisplayString(r.unref(m).toFixed(2)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(m),"onUpdate:value":a[14]||(a[14]=e=>r.isRef(m)?m.value=e:null),min:0,max:1,step:.01},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(w)]]),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("è¡°å‡ "+r.toDisplayString(r.unref(T).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(T),"onUpdate:value":a[15]||(a[15]=e=>r.isRef(T)?T.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("è·ç¦» "+r.toDisplayString(r.unref(z)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(z),"onUpdate:value":a[16]||(a[16]=e=>r.isRef(z)?z.value=e:null),min:0,max:5e3,step:10},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(w)]])]),_:1})]),_:1}));}});},"67dbd159":function e(e,t,r,n){e._m(t),e.o(t,"Engine",()=>y);var o=r("09efd1d2");r("92de075b"),r("850e6c49"),r("40616381"),r("b25dd2f8"),r("7bccf4aa"),r("2d08c2e5"),r("a3876e70");var s=e.w(r("3b16918b")),i=r("7f2264c7"),a=r("03f4e36a"),d=r("47a20e72"),l=r("69939ce5"),c=r("e9ef43b1"),h=r("e0c628a7"),m=r("3eec3e47"),u=r("7475699d"),f=r("8f363abd"),p=r("e00be090"),v=r("f4cd7510"),g=r("c2079dd8"),b=r("96554b2f"),C=r("99602713"),E=e.i(r("26d7988f")),M=r("f247f526"),w=r("6519cad4");s.BufferGeometry.prototype.computeBoundsTree=w.computeBoundsTree,s.BufferGeometry.prototype.disposeBoundsTree=w.disposeBoundsTree,s.Mesh.prototype.raycast=w.acceleratedRaycast;class y{async init(){var t=M.useSceneStore();await e.f(E).init(),e.f(E).onRendererChange(this.handleRendererChange.bind(this));var r=e.f(E).renderer;t.rendererInfo=r.backend.constructor.name.replace("Backend",""),this.setupEnvironment(e.f(E).renderer),this.postProcessing=new u.PostProcessing(e.f(E).renderer,this.scene,e.f(E).camera);var n=new s.CubeTextureLoader;n.setPath("cubeMap/");var o=n.load(C.ASSETS.textures.skybox);this.setSkybox(o);var i=new v.InfiniteGrid;this.scene.add(i),this.scene.add(e.f(E).camera),this.lightManager=new f.LightManager(this.scene,e.f(E).camera),this.modelLoader=new p.ModelLoader(e.f(E).renderer);var a=async()=>{var e=new h.Character;try{this.modelLoader&&(await e.load(this.modelLoader,C.ASSETS.models.characterIdle,C.ASSETS.models.characterWalk,e=>{e.lengthComputable&&(t.loadingProgress=50+Math.round(e.loaded/e.total*50));}),this.setCharacter(e),t.movementMode="thirdPerson",t.isLoading=!1);}catch(e){console.error("Character loading failed:",e),t.isLoading=!1;}};this.modelLoader.loadGLTF(C.ASSETS.models.home,e=>{e.lengthComputable&&(t.loadingProgress=Math.round(e.loaded/e.total*50));}).then(e=>{e.scene.position.set(0,.1,0),this.scene.add(e.scene),t.setModelRoot(e.scene),e.scene.updateMatrixWorld(!0);var r=new s.AnimationMixer(e.scene);this.addMixer(r),e.scene.traverse(e=>{e.isMesh&&(e.receiveShadow=!0,e.castShadow=!0,e.name.endsWith("Glass")&&(e.castShadow=!1));});var n=e.scene.getObjectByName("Door");n&&n.children.forEach(t=>{b.doorManager.addDoor(t,e.animations,r);}),g.colliderManager.generateCollider(e.scene,this.scene,e=>{this.setEnvironmentCollider(e);}),g.colliderManager.setVisibility(t.showCollisionBoxes),a();}).catch(e=>{console.error("æ¨¡åž‹åŠ è½½å¤±è´¥:",e),t.isLoading=!1;}),this.currentController.enter(),e.f(E).renderer.setAnimationLoop(this.animate);}handleRendererChange(t){Object.values(this.controllers).forEach(e=>{e.setDomElement(t.domElement);}),this.postProcessing=new u.PostProcessing(t,this.scene,e.f(E).camera),this.modelLoader&&this.modelLoader.updateRenderer(t),this.setupEnvironment(t),t.setAnimationLoop(this.animate);}setupEnvironment(e){var t=new s.PMREMGenerator(e);this.environmentTexture=t.fromScene(new i.RoomEnvironment,.04).texture,this.scene.environment=this.environmentTexture;}addMixer(e){this.mixers.push(e);}setCharacter(e){this.character=e,e.mesh&&(this.scene.add(e.mesh),this.controllers.thirdPerson.setCharacter(e));}async updateGTAO(t){this.gtaoEnabled!==t.enabled&&(this.gtaoEnabled=t.enabled,await e.f(E).recreateRenderer(!t.enabled)),this.postProcessing&&this.postProcessing.update(t);}lockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!0):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!0);}unlockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!1):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!1);}setMovementMode(e){this.movementMode!==e&&(this.currentController.leave(),this.movementMode=e,this.currentController=this.controllers[e],this.currentController.enter());}setCameraPosition(t){e.f(E).camera.position.copy(t);}setCameraDirection(t){"orbit"!==this.movementMode&&0!==t.lengthSq()&&e.f(E).camera.lookAt(t.add(e.f(E).camera.position));}getCameraDirection(){var t=new s.Vector3;return e.f(E).camera.getWorldDirection(t),t;}onUpdate(e){return this.updateListeners.add(e),()=>this.updateListeners.delete(e);}dispose(){e.f(E).renderer.setAnimationLoop(null),Object.values(this.controllers).forEach(e=>e.dispose()),e.f(E).dispose();}setEnvironmentEnabled(e){this.scene.environment=e?this.environmentTexture:null;}setEnvironmentIntensity(e){this.scene.environmentIntensity=e;}setEnvironmentCollider(e){this.controllers.thirdPerson.setCollider(e);}setSkybox(e){this.skyboxTexture=e,this.scene.background=e;}setSkyboxEnabled(e){this.scene.background=e?this.skyboxTexture:null;}constructor(){o._(this,"scene",void 0),o._(this,"postProcessing",null),o._(this,"gtaoEnabled",!0),o._(this,"controllers",void 0),o._(this,"currentController",void 0),o._(this,"movementMode","fly"),o._(this,"clock",new s.Clock),o._(this,"environmentTexture",null),o._(this,"mixers",[]),o._(this,"skyboxTexture",null),o._(this,"character",null),o._(this,"lightManager",null),o._(this,"modelLoader",null),o._(this,"updateListeners",new Set),o._(this,"animate",()=>{var t,r=this.clock.getDelta();this.mixers.forEach(e=>e.update(r)),null===(t=this.character)||void 0===t||t.update(r),this.currentController.update(r),this.updateListeners.forEach(e=>e(r)),e.f(E).stats.update(),this.postProcessing&&this.gtaoEnabled?this.postProcessing.render():e.f(E).renderer.render(this.scene,e.f(E).camera),m.InputManager.getInstance().update();}),this.scene=new s.Scene,this.controllers={fly:new a.FlyController(e.f(E).camera,e.f(E).renderer.domElement),orbit:new d.OrbitController(e.f(E).camera,e.f(E).renderer.domElement),thirdPerson:new l.ThirdPersonController(e.f(E).camera,e.f(E).renderer.domElement,new s.Vector3),topView:new c.TopViewController(e.f(E).camera,e.f(E).renderer.domElement)},this.currentController=this.controllers.fly;}}var x=new y;t.default=x;},"69939ce5":function e(e,t,i,s){e._m(t),e.o(t,"ThirdPersonController",()=>m);var r=i("09efd1d2"),o=e.w(i("3b16918b")),a=i("23b6b720"),n=i("f247f526"),l=i("0e70da6a"),h=i("9aaf3498"),c=i("96554b2f"),d=i("3eec3e47");class m{setDomElement(e){this.isActive&&this.domElement.removeEventListener("click",this.onClick),this.domElement=e,this.thirdPersonCamera.setDomElement(e),this.isActive&&this.domElement.addEventListener("click",this.onClick);}setCharacter(e){e.mesh&&this.setPlayerMesh(e.mesh),this.playerVelocity=e.velocity;}setPlayerMesh(e){this.playerMesh=e,this.thirdPersonCamera.setTarget(e);}setCollider(e){this.collider=e,this.thirdPersonCamera.setCollider(e);}enter(){this.isActive=!0,this.domElement.addEventListener("click",this.onClick),this.playerMesh&&this.thirdPersonCamera.syncWithCamera();var e=l.storeToRefs(n.useSceneStore()),t=e.moveSpeed,i=e.collisionEnabled;this.moveSpeed=t,this.collisionEnabled=i;}leave(){this.isActive=!1,this.domElement.removeEventListener("click",this.onClick),this.thirdPersonCamera.setLocked(!1),document.pointerLockElement===this.domElement&&document.exitPointerLock();}update(e){this.handleInput(e),this.updatePlayer(e),this.thirdPersonCamera.update(e),this.playerMesh&&c.doorManager.update(this.playerMesh.position);}dispose(){this.thirdPersonCamera.dispose();}onClick(){document.pointerLockElement||(this.domElement.requestPointerLock(),this.thirdPersonCamera.setLocked(!0));}handleInput(e){if(this.playerMesh){var t=d.InputManager.getInstance(),i=t.getMovementInput();if(t.isKeyDown("KeyF")&&c.doorManager.interact(),this.camera.getWorldDirection(this.tempForward),this.tempForward.y=0,this.tempForward.normalize(),this.tempRight.crossVectors(this.tempForward,this.camera.up).normalize(),this.playerDirection.set(0,0,0),this.playerDirection.addScaledVector(this.tempForward,i.z),this.playerDirection.addScaledVector(this.tempRight,i.x),this.playerDirection.lengthSq()>0){this.playerDirection.normalize(),this.playerVelocity.add(this.playerDirection.multiplyScalar(this.moveSpeed.value*e));var s=Math.atan2(this.playerDirection.x,this.playerDirection.z),r=new o.Quaternion;r.setFromAxisAngle(new o.Vector3(0,1,0),s),this.playerMesh.quaternion.slerp(r,.2);}}}updatePlayer(e){if(this.playerMesh){var t=Math.exp(-4*e)-1;this.playerVelocity.addScaledVector(this.playerVelocity,t);var i=this.playerVelocity.clone().multiplyScalar(e);this.collider&&this.collisionEnabled.value&&(this.resolveCollisions(i),c.doorManager.checkCollision(this.playerMesh.position,.15,i)),this.playerMesh.position.add(i);}}resolveCollisions(e){if(this.playerMesh&&this.collider){var t=new o.Vector3(0,.2,0),i=this.playerMesh.position.clone().add(t).add(e),s=this.collider.geometry.boundsTree;if(s){for(var r=new o.Vector3,a=0;a<5;a++)s.shapecast({intersectsBounds:e=>.15>e.distanceToPoint(i),intersectsTriangle:e=>{var t=e.closestPointToPoint(i,r).distanceTo(i);if(t<.15){var s=.15-t,o=i.clone().sub(r).normalize();o.y=0,i.addScaledVector(o,s);}}});var n=i.clone().sub(t);e.copy(n).sub(this.playerMesh.position);}}}setLocked(e){this.thirdPersonCamera.setLocked(e),e?this.domElement.requestPointerLock():document.pointerLockElement===this.domElement&&document.exitPointerLock();}constructor(e,t,i){r._(this,"camera",void 0),r._(this,"domElement",void 0),r._(this,"thirdPersonCamera",void 0),r._(this,"playerMesh",null),r._(this,"playerVelocity",void 0),r._(this,"playerDirection",new o.Vector3),r._(this,"tempForward",new o.Vector3),r._(this,"tempRight",new o.Vector3),r._(this,"collider",null),r._(this,"moveSpeed",h.ref(0)),r._(this,"collisionEnabled",h.ref(!0)),r._(this,"isActive",!1),this.camera=e,this.domElement=t,this.playerVelocity=i,this.thirdPersonCamera=new a.ThirdPersonCamera(e,t),this.onClick=this.onClick.bind(this);}}},"71200ed9":function e(e,a,t,n){e._m(a),e.o(a,"useViewerSync",()=>r);var i=t("15edfc35"),o=t("9aaf3498"),l=t("0e70da6a"),s=t("f247f526"),u=e.i(t("26d7988f")),v=e.i(t("67dbd159")),c=e.w(t("3b16918b")),f=t("c2079dd8");function r(){var a=s.useSceneStore(),t=l.storeToRefs(a),n=t.cameraPosition,r=t.cameraDirection,d=t.isEditingPosition,h=t.isEditingDirection,m=t.movementMode,E=t.skyboxEnabled,g=t.showCollisionBoxes,p=t.statsVisible,b=t.playerPosition,w=t.isEditingPlayerPosition,y=t.environmentEnabled,P=t.environmentIntensity,S=t.gtaoEnabled,C=t.gtaoSamples,D=t.gtaoDistanceExponent,x=t.gtaoDistanceFallOff,M=t.gtaoRadius,V=t.gtaoScale,I=t.gtaoThickness,O=t.gtaoAoOnly,k=t.sunEnabled,A=t.sunColor,z=t.sunIntensity,L=t.sunPosition,T=t.ambientEnabled,F=t.ambientColor,R=t.ambientIntensity,U=t.spotEnabled,_=t.spotColor,q=t.spotIntensity,B=t.spotAngle,G=t.spotPenumbra,j=t.spotDecay,H=t.spotDistance;o.watchEffect(()=>{if(d.value){var a=n.value,t=a.x,i=a.y,o=a.z;e.f(v).setCameraPosition(new c.Vector3(t,i,o));}}),o.watchEffect(()=>{if(h.value){var a=r.value,t=a.x,n=a.y,i=a.z,o=new c.Vector3(t,n,i);o.lengthSq()>0&&e.f(v).setCameraDirection(o);}}),o.watchEffect(()=>{var a;if(w.value&&(null===(a=e.f(v).character)||void 0===a?void 0:a.mesh)){var t=b.value,n=t.x,i=t.y,o=t.z;e.f(v).character.mesh.position.set(n,i,o);}}),o.watchEffect(()=>{e.f(v).setMovementMode(m.value);}),o.watchEffect(()=>{e.f(v).setSkyboxEnabled(E.value);}),o.watchEffect(()=>{f.colliderManager.setVisibility(g.value);}),o.watchEffect(()=>{e.f(u).setStatsVisible(p.value);}),o.watchEffect(()=>{e.f(v).setEnvironmentEnabled(y.value);}),o.watchEffect(()=>{e.f(v).setEnvironmentIntensity(P.value);}),o.watchEffect(()=>{e.f(v).updateGTAO({enabled:S.value,samples:C.value,distanceExponent:D.value,distanceFallOff:x.value,radius:M.value,scale:V.value,thickness:I.value,aoOnly:O.value});}),o.watchEffect(()=>{var a;null===(a=e.f(v).lightManager)||void 0===a||a.updateSunLight(k.value,A.value,z.value,i._({},L.value));}),o.watchEffect(()=>{var a;null===(a=e.f(v).lightManager)||void 0===a||a.updateAmbientLight(T.value,F.value,R.value);}),o.watchEffect(()=>{var a;null===(a=e.f(v).lightManager)||void 0===a||a.updateSpotLight(U.value,_.value,q.value,B.value,G.value,j.value,H.value);});var J=e.f(v).onUpdate(()=>{var t;d.value||a.updateCameraPosition(e.f(u).camera.position),h.value||a.updateCameraDirection(e.f(v).getCameraDirection()),"thirdPerson"===m.value&&!w.value&&(null===(t=e.f(v).character)||void 0===t?void 0:t.mesh)&&a.updatePlayerPosition(e.f(v).character.mesh.position);});o.onUnmounted(()=>{J();});}},"7c3ee4ab":function e(e,t,a,l){e._m(t);var n=a("b5537c77");a("c550eeaa"),a("2d08c2e5"),a("a3876e70"),a("2554870f"),a("c98af605");var r=a("9aaf3498"),c=a("9aaf3498"),o=a("9aaf3498"),i=a("1f6a8afd"),u=a("0e70da6a"),d=a("f247f526"),v={class:"scene-tree-container"};t.default=r.defineComponent({__name:"SceneTreePanel",setup(e){var t=d.useSceneStore(),a=u.storeToRefs(t),l=a.modelRoot,r=a.movementMode,f=o.ref([]),h=o.ref([]),s=o.ref(4),p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=t?"".concat(t,"-").concat(e.id):"".concat(e.id),n={key:l,label:e.name||"".concat(e.type," #").concat(e.id),object3D:e};return e.children.length>0&&a<s.value&&(n.children=e.children.map(e=>p(e,l,a+1))),n;},y=e=>{var t=[],a=e=>{var l=!0,n=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(l=(c=o.next()).done);l=!0){var i=c.value;t.push(i.key),i.children&&a(i.children);}}catch(e){n=!0,r=e;}finally{try{l||null==o.return||o.return();}finally{if(n)throw r;}}};return a(e),t;},m=()=>{if(l.value){var e=p(l.value);f.value=[e],h.value=y(f.value);}},x=(e,t,a)=>{var l=a.node;l&&(l.object3D.visible="check"===a.action),h.value=e;};return o.watch(l,e=>{e&&m();},{immediate:!0}),o.watch(s,()=>{m();}),o.watch(r,e=>{var t="topView"===e,a=function(e){var t=f.value,a=!0,l=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(a=(c=o.next()).done);a=!0){var i=function(){var a=c.value,l=t.find(e=>e.object3D.name===a);return l?a===e[e.length-1]?{v:l}:void(t=l.children||[]):{v:null};}();if("object"===n._(i))return i.v;}}catch(e){l=!0,r=e;}finally{try{a||null==o.return||o.return();}finally{if(l)throw r;}}return null;}(["Scene","Scene_Collection","Ceiling"]);a&&(a.object3D.visible=!t,t?h.value=h.value.filter(e=>e!==a.key):h.value.includes(a.key)||h.value.push(a.key));}),(e,t)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createVNode(c.unref(i.NText),{depth:"3"},{default:c.withCtx(()=>[...t[1]||(t[1]=[c.createTextVNode("å‹¾é€‰/å–æ¶ˆå‹¾é€‰ä»¥æ˜¾ç¤º/éšè—æ¨¡åž‹å±‚çº§ä¸­çš„å¯¹è±¡ã€‚",-1)])]),_:1}),c.createVNode(c.unref(i.NSpace),{vertical:"",size:"small",style:{"margin-top":"12px","margin-bottom":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NSpace),{justify:"space-between",style:{width:"100%"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NText),{depth:"2",style:{"font-size":"12px"}},{default:c.withCtx(()=>[...t[2]||(t[2]=[c.createTextVNode("æ˜¾ç¤ºæ·±åº¦",-1)])]),_:1}),c.createVNode(c.unref(i.NText),null,{default:c.withCtx(()=>[c.createTextVNode(c.toDisplayString(s.value)+" å±‚",1)]),_:1})]),_:1}),c.createVNode(c.unref(i.NSlider),{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),min:1,max:10,step:1},null,8,["value"])]),_:1}),c.createElementVNode("div",v,[c.createVNode(c.unref(i.NTree),{data:f.value,"checked-keys":h.value,"onUpdate:checkedKeys":x,checkable:"",selectable:"","block-line":"","expand-on-click":"","default-expand-all":"",style:{"font-size":"12px"}},null,8,["data","checked-keys"])])],64));}});},"96554b2f":function t(t,i,o,n){t._m(i),t.o(i,"Door",()=>s),t.o(i,"DoorManager",()=>c),t.o(i,"doorManager",()=>h);var e=o("09efd1d2");o("c550eeaa"),o("2d08c2e5"),o("a3876e70");var a=t.w(o("3b16918b")),r=o("f247f526");class s{get isAnimating(){return!!this.action&&this.action.isRunning();}interact(){this.action&&(this.isOpen=!this.isOpen,this.action.paused=!1,this.isOpen?this.action.timeScale=1:this.action.timeScale=-1,this.action.play());}getDistance(t){return this.object.getWorldPosition(this.worldPosition),this.worldPosition.distanceTo(t);}constructor(t,i,o){e._(this,"object",void 0),e._(this,"isOpen",!1),e._(this,"mixer",void 0),e._(this,"action",null),e._(this,"box",void 0),e._(this,"worldPosition",new a.Vector3),this.object=t,this.box=new a.Box3().setFromObject(t),this.mixer=o;var n=t.name+"Open",r=i.find(t=>t.name===n);r?(this.action=this.mixer.clipAction(r),this.action.loop=a.LoopOnce,this.action.clampWhenFinished=!0):console.warn("Animation ".concat(n," not found for door ").concat(t.name));}}class c{addDoor(t,i,o){if(!this.doors.find(i=>i.object===t)){var n=new s(t,i,o);this.doors.push(n);}}update(t){var i=null,o=1/0,n=!0,e=!1,a=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value,l=h.getDistance(t);l<this.interactionDistance&&l<o&&(o=l,i=h);}}catch(t){e=!0,a=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw a;}}var x=r.useSceneStore();i?(this.activeDoor=i,x.showInteractionPrompt=!0,x.interactionText=i.isOpen?"æŒ‰ F å…³é—¨":"æŒ‰ F å¼€é—¨"):(this.activeDoor=null,x.showInteractionPrompt=!1);}interact(){this.activeDoor&&this.activeDoor.interact();}checkCollision(t,i,o){var n=!0,e=!1,r=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value;if(!h.isOpen&&!h.isAnimating){h.box.setFromObject(h.object);var l=new a.Box3,x=t.clone().add(o);if(l.min.set(x.x-i,x.y,x.z-i),l.max.set(x.x+i,x.y+2,x.z+i),h.box.intersectsBox(l)){var d=h.box.clone().intersect(l),m=d.max.x-d.min.x,v=d.max.z-d.min.z;m<v?x.x<h.box.min.x+(h.box.max.x-h.box.min.x)/2?o.x-=m:o.x+=m:x.z<h.box.min.z+(h.box.max.z-h.box.min.z)/2?o.z-=v:o.z+=v;}}}}catch(t){e=!0,r=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw r;}}}constructor(){e._(this,"doors",[]),e._(this,"interactionDistance",2),e._(this,"activeDoor",null);}}var h=new c;},"b1f59e44":function e(e,a,t,r){e._m(a),t("2d08c2e5"),t("a3876e70");var d=t("9aaf3498"),n=t("9aaf3498"),f=t("1f6a8afd"),c=t("0e70da6a"),i=t("f247f526"),o=e.i(t("ae1ac647")),u=e.i(t("5c886761")),l=e.i(t("f7acc5ff")),N=e.i(t("76d74377")),s=e.i(t("8fd7a7b3"));a.default=d.defineComponent({__name:"ControlPanel",setup(a){var t=i.useSceneStore(),r=c.storeToRefs(t).isDarkMode;return(a,t)=>(n.openBlock(),n.createBlock(n.unref(f.NCard),{class:"param-panel",bordered:!1,size:"small"},{header:n.withCtx(()=>[n.createVNode(n.unref(f.NSpace),{align:"center",justify:"space-between",style:{margin:"0",width:"100%"}},{default:n.withCtx(()=>[n.createVNode(n.unref(f.NText),{strong:""},{default:n.withCtx(()=>[...t[1]||(t[1]=[n.createTextVNode("æŽ§åˆ¶é¢æ¿",-1)])]),_:1}),n.createVNode(n.unref(f.NSwitch),{value:n.unref(r),"onUpdate:value":t[0]||(t[0]=e=>n.isRef(r)?r.value=e:null),size:"small"},{checked:n.withCtx(()=>[...t[2]||(t[2]=[n.createTextVNode("ðŸŒ™",-1)])]),unchecked:n.withCtx(()=>[...t[3]||(t[3]=[n.createTextVNode("â˜€ï¸",-1)])]),_:1},8,["value"])]),_:1})]),default:n.withCtx(()=>[n.createVNode(n.unref(f.NTabs),{type:"line",animated:""},{default:n.withCtx(()=>[n.createVNode(n.unref(f.NTabPane),{name:"movement",tab:"æ¼«æ¸¸"},{default:n.withCtx(()=>[n.createVNode(e.f(u))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"lighting",tab:"å…‰ç…§"},{default:n.withCtx(()=>[n.createVNode(e.f(l))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"postprocess",tab:"åŽæœŸ"},{default:n.withCtx(()=>[n.createVNode(e.f(N))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"debug",tab:"è°ƒè¯•"},{default:n.withCtx(()=>[n.createVNode(e.f(s))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"hierarchy",tab:"å±‚çº§","display-directive":"show"},{default:n.withCtx(()=>[n.createVNode(e.f(o))]),_:1})]),_:1})]),_:1}));}});},"b7044e63":function e(e,t,u,a){e._m(t);var l=u("15edfc35"),n=u("94a74ea6");u("2d08c2e5"),u("a3876e70");var r=u("9aaf3498"),o=u("9aaf3498"),d=u("9aaf3498"),i=u("1f6a8afd");t.default=r.defineComponent({__name:"Vector3Input",props:{value:{required:!0},valueModifiers:{},editing:{type:Boolean},editingModifiers:{}},emits:["update:value","update:editing"],setup(e){var t=r.useModel(e,"value"),u=r.useModel(e,"editing"),a=()=>u.value=!0,f=()=>u.value=!1,s=e=>d.computed({get:()=>t.value[e],set:u=>{null!==u&&(t.value=n._(l._({},t.value),{[e]:u}));}}),c=s("x"),N=s("y"),v=s("z");return(e,t)=>(o.openBlock(),o.createBlock(o.unref(i.NGrid),{cols:3,"x-gap":8},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[3]||(t[3]=[o.createTextVNode("X",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(c),"onUpdate:value":t[0]||(t[0]=e=>o.isRef(c)?c.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1}),o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[4]||(t[4]=[o.createTextVNode("Y",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(N),"onUpdate:value":t[1]||(t[1]=e=>o.isRef(N)?N.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1}),o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[5]||(t[5]=[o.createTextVNode("Z",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(v),"onUpdate:value":t[2]||(t[2]=e=>o.isRef(v)?v.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1})]),_:1}));}});},"e0c628a7":function t(t,i,e,s){t._m(i),t.o(i,"Character",()=>o);var a=e("09efd1d2");e("b25dd2f8");var n=t.w(e("3b16918b"));class o{setupMeshProperties(t){t.traverse(t=>{if(t.isMesh){t.castShadow=!0,t.receiveShadow=!0;var i=t.material;t.material=new n.MeshStandardMaterial({color:i.color,map:i.map,roughness:.8,metalness:.1});}});}async load(t,i,e,s){var a=(t,i)=>{s&&i.lengthComputable&&i.total>0&&s(new ProgressEvent("progress",{lengthComputable:!0,loaded:100*(.5*t+.5*(i.loaded/i.total)),total:100}));},o=await t.loadFBX(i,t=>a(0,t));this.mesh=o,o.scale.set(.01,.01,.01),o.position.set(0,.1,0),this.setupMeshProperties(o),this.mixer=new n.AnimationMixer(o),this.idleAction=this.mixer.clipAction(o.animations[0]),this.idleAction.play(),this.currentAction=this.idleAction;var r=await t.loadFBX(e,t=>a(1,t));this.setupMeshProperties(r),this.walkAction=this.mixer.clipAction(r.animations[0]);}update(t){this.mixer&&this.mixer.update(t),this.updateAnimation();}updateAnimation(){if(this.idleAction&&this.walkAction){var t=this.velocity.length()>1?this.walkAction:this.idleAction;this.currentAction!==t&&(this.currentAction&&this.currentAction.fadeOut(.2),t.reset().fadeIn(.2).play(),this.currentAction=t);}}constructor(){a._(this,"mesh",null),a._(this,"velocity",new n.Vector3),a._(this,"mixer",null),a._(this,"idleAction",null),a._(this,"walkAction",null),a._(this,"currentAction",null);}}},"f247f526":function e(e,r,f,a){e._m(r),e.o(r,"useSceneStore",()=>n),f("bf3a4d74"),f("db38ec0f");var F=f("0e70da6a"),o=f("9aaf3498"),t=(e,r)=>{r.x=parseFloat(e.x.toFixed(2)),r.y=parseFloat(e.y.toFixed(2)),r.z=parseFloat(e.z.toFixed(2));},n=F.defineStore("scene",()=>{var e=o.ref(!0),r=o.ref(0),f=o.ref(!0),a=o.ref(null),F=o.ref("fly"),n=o.ref(20),u=o.ref({x:1,y:1,z:1}),i=o.ref({x:0,y:0,z:-1}),l=o.ref(!1),d=o.ref(!1),c=o.ref({x:0,y:.1,z:0}),x=o.ref(!1),s=o.ref(!1),y=o.ref(!0),p=o.ref(!0),v=o.ref(!1),z=o.ref(""),m=o.ref(!0),P=o.ref(!0),S=o.ref("#FFFFFF"),b=o.ref(5),C=o.ref({x:10,y:20,z:-20}),R=o.ref(!1),k=o.ref("#FFFFFF"),w=o.ref(1),D=o.ref(!0),I=o.ref(1),M=o.ref(!1),_=o.ref(16),g=o.ref(2),h=o.ref(1),j=o.ref(.25),q=o.ref(1),A=o.ref(1),B=o.ref(!1),E=o.ref(!1),G=o.ref("#FFFFFF"),H=o.ref(1),J=o.ref(30),K=o.ref(.3),L=o.ref(1),N=o.ref(1e3);return{isLoading:e,loadingProgress:r,rendererInfo:o.ref(""),isDarkMode:f,modelRoot:a,movementMode:F,moveSpeed:n,cameraPosition:u,cameraDirection:i,isEditingPosition:l,isEditingDirection:d,playerPosition:c,isEditingPlayerPosition:x,showCollisionBoxes:s,collisionEnabled:y,statsVisible:p,showInteractionPrompt:v,interactionText:z,skyboxEnabled:m,sunEnabled:P,sunColor:S,sunIntensity:b,sunPosition:C,ambientEnabled:R,ambientColor:k,ambientIntensity:w,environmentEnabled:D,environmentIntensity:I,gtaoEnabled:M,gtaoSamples:_,gtaoDistanceExponent:g,gtaoDistanceFallOff:h,gtaoRadius:j,gtaoScale:q,gtaoThickness:A,gtaoAoOnly:B,spotEnabled:E,spotColor:G,spotIntensity:H,spotAngle:J,spotPenumbra:K,spotDecay:L,spotDistance:N,setModelRoot:function(e){a.value=e?o.markRaw(e):null;},updateCameraPosition:function(e){t(e,u.value);},updateCameraDirection:function(e){t(e,i.value);},updatePlayerPosition:function(e){t(e,c.value);}};});},"f49f4847":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var i=a("9aaf3498"),n=a("9aaf3498"),u=a("1f6a8afd"),r=a("0e70da6a"),d=a("f247f526"),o=e.i(a("c879eb01"));t.default=i.defineComponent({__name:"MovementPanel",setup(t){var a=d.useSceneStore(),l=r.storeToRefs(a),i=l.movementMode,f=l.moveSpeed,c=l.cameraPosition,s=l.cameraDirection,v=l.isEditingPosition,N=l.isEditingDirection,p=l.playerPosition,x=l.isEditingPlayerPosition,h=[{label:"é£žè¡Œ",value:"fly"},{label:"è½¨é“",value:"orbit"},{label:"ç¬¬ä¸‰äººç§°",value:"thirdPerson"},{label:"ä¿¯è§†",value:"topView"}];return(t,a)=>(n.openBlock(),n.createBlock(n.unref(u.NSpace),{vertical:"",size:"large"},{default:n.withCtx(()=>[n.createVNode(n.unref(u.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(u.NText),{depth:"2",style:{"font-size":"12px"}},{default:n.withCtx(()=>[...a[8]||(a[8]=[n.createTextVNode("ç§»åŠ¨æ–¹å¼",-1)])]),_:1}),n.createVNode(n.unref(u.NSelect),{value:n.unref(i),"onUpdate:value":a[0]||(a[0]=e=>n.isRef(i)?i.value=e:null),options:h},null,8,["value"])]),_:1}),n.createVNode(n.unref(u.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(u.NSpace),{justify:"space-between",style:{width:"100%"}},{default:n.withCtx(()=>[n.createVNode(n.unref(u.NText),{depth:"2",style:{"font-size":"12px"}},{default:n.withCtx(()=>[...a[9]||(a[9]=[n.createTextVNode("ç§»åŠ¨é€Ÿåº¦",-1)])]),_:1}),n.createVNode(n.unref(u.NText),null,{default:n.withCtx(()=>[n.createTextVNode(n.toDisplayString(Math.round(n.unref(f)))+" u/s",1)]),_:1})]),_:1}),n.createVNode(n.unref(u.NSlider),{value:n.unref(f),"onUpdate:value":a[1]||(a[1]=e=>n.isRef(f)?f.value=e:null),min:1,max:50,step:1},null,8,["value"])]),_:1}),n.createVNode(n.unref(u.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(u.NText),{depth:"2",style:{"font-weight":"600"}},{default:n.withCtx(()=>[...a[10]||(a[10]=[n.createTextVNode("æ‘„åƒæœºä½ç½®",-1)])]),_:1}),n.createVNode(e.f(o),{value:n.unref(c),"onUpdate:value":a[2]||(a[2]=e=>n.isRef(c)?c.value=e:null),editing:n.unref(v),"onUpdate:editing":a[3]||(a[3]=e=>n.isRef(v)?v.value=e:null)},null,8,["value","editing"])]),_:1}),"thirdPerson"===n.unref(i)?(n.openBlock(),n.createBlock(n.unref(u.NSpace),{key:0,vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(u.NText),{depth:"2",style:{"font-weight":"600"}},{default:n.withCtx(()=>[...a[11]||(a[11]=[n.createTextVNode("çŽ©å®¶ä½ç½®",-1)])]),_:1}),n.createVNode(e.f(o),{value:n.unref(p),"onUpdate:value":a[4]||(a[4]=e=>n.isRef(p)?p.value=e:null),editing:n.unref(x),"onUpdate:editing":a[5]||(a[5]=e=>n.isRef(x)?x.value=e:null)},null,8,["value","editing"])]),_:1})):n.createCommentVNode("",!0),n.createVNode(n.unref(u.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(u.NText),{depth:"2",style:{"font-weight":"600"}},{default:n.withCtx(()=>[...a[12]||(a[12]=[n.createTextVNode("æ‘„åƒæœºæ–¹å‘",-1)])]),_:1}),n.createVNode(e.f(o),{value:n.unref(s),"onUpdate:value":a[6]||(a[6]=e=>n.isRef(s)?s.value=e:null),editing:n.unref(N),"onUpdate:editing":a[7]||(a[7]=e=>n.isRef(N)?N.value=e:null)},null,8,["value","editing"])]),_:1})]),_:1}));}});},"ff9d919c":function e(e,t,o,r){e._m(t),o("2d08c2e5"),o("a3876e70");var a=o("9aaf3498"),c=o("9aaf3498"),d=o("1f6a8afd"),n=o("9aaf3498");t.default=a.defineComponent({__name:"PointerLockPrompt",props:{visible:{type:Boolean},mode:{}},emits:["enterPointerLock"],setup(e,t){var o=t.emit,r=n.computed(()=>"fly"===e.mode?"è‡ªç”±é£žè¡Œè§†è§’":"ç¬¬ä¸‰äººç§°è§†è§’");return(t,a)=>c.withDirectives((c.openBlock(),c.createBlock(c.unref(d.NCard),{class:"controls-overlay",bordered:!1,size:"small",title:r.value},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NText),{depth:"3"},{default:c.withCtx(()=>["fly"===e.mode?(c.openBlock(),c.createElementBlock(c.Fragment,{key:0},[a[4]||(a[4]=c.createTextVNode(" ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥é”å®šé¼ æ ‡ï¼Œä½¿ç”¨ ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[1]||(a[1]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[5]||(a[5]=c.createTextVNode(" ç§»åŠ¨ï¼Œ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[2]||(a[2]=[c.createTextVNode("ç©ºæ ¼",-1)])]),_:1}),a[6]||(a[6]=c.createTextVNode(" ä¸Šå‡ï¼Œ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[3]||(a[3]=[c.createTextVNode("Shift",-1)])]),_:1}),a[7]||(a[7]=c.createTextVNode(" ä¸‹é™ï¼Œé¼ æ ‡æ—‹è½¬æ–¹å‘ã€‚ ",-1))],64)):(c.openBlock(),c.createElementBlock(c.Fragment,{key:1},[a[9]||(a[9]=c.createTextVNode(" ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥é”å®šé¼ æ ‡ï¼Œä½¿ç”¨ ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[8]||(a[8]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[10]||(a[10]=c.createTextVNode(" ç§»åŠ¨ï¼Œé¼ æ ‡æ—‹è½¬è§†è§’ã€‚ ",-1))],64))]),_:1}),c.createVNode(c.unref(d.NSpace),{vertical:"",style:{"margin-top":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NButton),{type:"primary",onClick:a[0]||(a[0]=e=>o("enterPointerLock")),block:""},{default:c.withCtx(()=>[...a[11]||(a[11]=[c.createTextVNode("å¼€å§‹ä½“éªŒ",-1)])]),_:1}),c.createVNode(c.unref(d.NText),{depth:"3",style:{"font-size":"12px"}},{default:c.withCtx(()=>[a[13]||(a[13]=c.createTextVNode("æŒ‰ ",-1)),c.createVNode(c.unref(d.NText),{code:""},{default:c.withCtx(()=>[...a[12]||(a[12]=[c.createTextVNode("Esc",-1)])]),_:1}),a[14]||(a[14]=c.createTextVNode(" å¯é€€å‡ºé”å®š",-1))]),_:1})]),_:1})]),_:1},8,["title"])),[[c.vShow,e.visible]]);}});},});
//# sourceMappingURL=index_1825.4c5324b3.js.map