(function(_){var filename = ((function(){var _documentCurrentScript = typeof document !== "undefined" ? document.currentScript : null;return typeof document === "undefined" ? require("url").pathToFileURL(__filename).href : _documentCurrentScript && _documentCurrentScript.src || new URL("index_d3d1.js", document.baseURI).href})());for(var r in _){_[r].__farm_resource_pot__=filename;window['f1d71b9dd14324d7340d3311efaf8136'].__farm_module_system__.register(r,_[r])}})({"03f4e36a":function e(e,t,o,i){e._m(t),e.o(t,"FlyController",()=>m);var s=o("09efd1d2"),r=e.w(o("3b16918b")),c=o("9aaf3498"),h=o("21f39150"),n=o("f247f526"),a=o("0e70da6a");class m{enter(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),this.domElement.addEventListener("click",this.onClick),this.controls.connect(this.domElement),this.controls.lock();var e=a.storeToRefs(n.useSceneStore()).moveSpeed;this.moveSpeed=e;}leave(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.domElement.removeEventListener("click",this.onClick),this.controls.unlock(),this.controls.disconnect();}update(e){this.controls.isLocked&&(this.velocity.multiplyScalar(Math.exp(-5*e)),this.direction.set(Number(this.moveRight)-Number(this.moveLeft),Number(this.moveUp)-Number(this.moveDown),Number(this.moveForward)-Number(this.moveBackward)),this.direction.lengthSq()>0&&(this.direction.normalize(),this.camera.getWorldDirection(this.tempForward).normalize(),this.tempRight.crossVectors(this.tempForward,new r.Vector3(0,1,0)).normalize(),this.moveVector.copy(this.tempForward).multiplyScalar(this.direction.z),this.moveVector.addScaledVector(this.tempRight,this.direction.x),this.moveVector.y+=this.direction.y,this.moveVector.normalize(),this.velocity.addScaledVector(this.moveVector,this.moveSpeed.value*e)),this.camera.position.addScaledVector(this.velocity,e));}dispose(){this.controls.dispose();}onClick(){this.controls.isLocked||this.controls.lock();}onKeyDown(e){switch(e.code){case"KeyW":case"ArrowUp":this.moveForward=!0;break;case"KeyS":case"ArrowDown":this.moveBackward=!0;break;case"KeyA":case"ArrowLeft":this.moveLeft=!0;break;case"KeyD":case"ArrowRight":this.moveRight=!0;break;case"Space":this.moveUp=!0;break;case"ShiftLeft":case"ShiftRight":this.moveDown=!0;}}onKeyUp(e){switch(e.code){case"KeyW":case"ArrowUp":this.moveForward=!1;break;case"KeyS":case"ArrowDown":this.moveBackward=!1;break;case"KeyA":case"ArrowLeft":this.moveLeft=!1;break;case"KeyD":case"ArrowRight":this.moveRight=!1;break;case"Space":this.moveUp=!1;break;case"ShiftLeft":case"ShiftRight":this.moveDown=!1;}}setLocked(e){e?this.controls.lock():this.controls.unlock();}constructor(e,t){s._(this,"camera",void 0),s._(this,"domElement",void 0),s._(this,"controls",void 0),s._(this,"moveForward",!1),s._(this,"moveBackward",!1),s._(this,"moveLeft",!1),s._(this,"moveRight",!1),s._(this,"moveUp",!1),s._(this,"moveDown",!1),s._(this,"velocity",new r.Vector3),s._(this,"direction",new r.Vector3),s._(this,"moveVector",new r.Vector3),s._(this,"tempRight",new r.Vector3),s._(this,"tempForward",new r.Vector3),s._(this,"moveSpeed",c.ref(0)),this.camera=e,this.domElement=t,this.controls=new h.PointerLockControls(e,t),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onClick=this.onClick.bind(this);}}},"08f7389c":function e(e,t,a,l){e._m(t);var n=a("b5537c77");a("c550eeaa"),a("2d08c2e5"),a("a3876e70"),a("2554870f"),a("c98af605");var r=a("9aaf3498"),c=a("9aaf3498"),o=a("9aaf3498"),i=a("1f6a8afd"),u=a("0e70da6a"),d=a("f247f526"),v={class:"scene-tree-container"};t.default=r.defineComponent({__name:"SceneTreePanel",setup(e){var t=d.useSceneStore(),a=u.storeToRefs(t),l=a.modelRoot,r=a.movementMode,f=o.ref([]),h=o.ref([]),s=o.ref(4),p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=t?"".concat(t,"-").concat(e.id):"".concat(e.id),n={key:l,label:e.name||"".concat(e.type," #").concat(e.id),object3D:e};return e.children.length>0&&a<s.value&&(n.children=e.children.map(e=>p(e,l,a+1))),n;},y=e=>{var t=[],a=e=>{var l=!0,n=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(l=(c=o.next()).done);l=!0){var i=c.value;t.push(i.key),i.children&&a(i.children);}}catch(e){n=!0,r=e;}finally{try{l||null==o.return||o.return();}finally{if(n)throw r;}}};return a(e),t;},m=()=>{if(l.value){var e=p(l.value);f.value=[e],h.value=y(f.value);}},x=(e,t,a)=>{var l=a.node;l&&(l.object3D.visible="check"===a.action),h.value=e;};return o.watch(l,e=>{e&&m();},{immediate:!0}),o.watch(s,()=>{m();}),o.watch(r,e=>{var t="topView"===e,a=function(e){var t=f.value,a=!0,l=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(a=(c=o.next()).done);a=!0){var i=function(){var a=c.value,l=t.find(e=>e.object3D.name===a);return l?a===e[e.length-1]?{v:l}:void(t=l.children||[]):{v:null};}();if("object"===n._(i))return i.v;}}catch(e){l=!0,r=e;}finally{try{a||null==o.return||o.return();}finally{if(l)throw r;}}return null;}(["Scene","Scene_Collection","Ceiling"]);a&&(a.object3D.visible=!t,t?h.value=h.value.filter(e=>e!==a.key):h.value.includes(a.key)||h.value.push(a.key));}),(e,t)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createVNode(c.unref(i.NText),{depth:"3"},{default:c.withCtx(()=>[...t[1]||(t[1]=[c.createTextVNode("勾选/取消勾选以显示/隐藏模型层级中的对象。",-1)])]),_:1}),c.createVNode(c.unref(i.NSpace),{vertical:"",size:"small",style:{"margin-top":"12px","margin-bottom":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NSpace),{justify:"space-between",style:{width:"100%"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NText),{depth:"2",style:{"font-size":"12px"}},{default:c.withCtx(()=>[...t[2]||(t[2]=[c.createTextVNode("显示深度",-1)])]),_:1}),c.createVNode(c.unref(i.NText),null,{default:c.withCtx(()=>[c.createTextVNode(c.toDisplayString(s.value)+" 层",1)]),_:1})]),_:1}),c.createVNode(c.unref(i.NSlider),{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),min:1,max:10,step:1},null,8,["value"])]),_:1}),c.createElementVNode("div",v,[c.createVNode(c.unref(i.NTree),{data:f.value,"checked-keys":h.value,"onUpdate:checkedKeys":x,checkable:"",selectable:"","block-line":"","expand-on-click":"","default-expand-all":"",style:{"font-size":"12px"}},null,8,["data","checked-keys"])])],64));}});},"23b6b720":function t(t,i,e,s){t._m(i),t.o(i,"ThirdPersonCamera",()=>o);var h=e("09efd1d2"),a=t.w(e("3b16918b"));class o{setTarget(t){this.target=t,this.syncWithCamera();}setCollider(t){this.collider=t;}syncWithCamera(){if(this.target){var t=new a.Vector3().subVectors(this.camera.position,this.target.position);this.radius=t.length(),this.currentRadius=this.radius,this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(a.MathUtils.clamp(t.y/this.radius,-1,1)),this.targetTheta=this.theta,this.targetPhi=this.phi;}}onMouseMove(t){this.isLocked&&(this.targetTheta-=t.movementX*this.sensitivity,this.targetPhi-=t.movementY*this.sensitivity,this.targetPhi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.targetPhi)));}onMouseWheel(t){this.isLocked&&(this.radius+=.005*t.deltaY,this.radius=Math.max(2,Math.min(20,this.radius)));}update(t){if(this.target){var i=1-Math.exp(-25*t),e=this.targetTheta-this.theta;this.theta+=e*i,this.phi+=(this.targetPhi-this.phi)*i;var s=this.target.position.clone().add(this.targetOffset),h=this.radius;if(this.collider){var o=new a.Vector3(0);o.setFromSphericalCoords(1,this.phi,this.theta).normalize();var r=new a.Raycaster(s,o);r.far=this.radius,r.firstHitOnly=!0;var n=r.intersectObject(this.collider,!0);n.length>0&&(h=Math.max(.2,n[0].distance-.2));}var d=-150*(this.currentRadius-h)-20*this.radiusVelocity;this.radiusVelocity+=d*t,this.currentRadius+=this.radiusVelocity*t,this.camera.position.setFromSphericalCoords(this.currentRadius,this.phi,this.theta).add(s),this.camera.lookAt(s);}}setLocked(t){this.isLocked=t;}onPointerLockChange(){this.isLocked=document.pointerLockElement===this.domElement;}dispose(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("pointerlockchange",this.onPointerLockChange),document.removeEventListener("wheel",this.onMouseWheel);}constructor(t,i){h._(this,"camera",void 0),h._(this,"domElement",void 0),h._(this,"target",null),h._(this,"theta",0),h._(this,"phi",Math.PI/2),h._(this,"radius",3),h._(this,"currentRadius",3),h._(this,"radiusVelocity",0),h._(this,"collider",null),h._(this,"targetTheta",0),h._(this,"targetPhi",Math.PI/2),h._(this,"minPolarAngle",.1),h._(this,"maxPolarAngle",Math.PI-.1),h._(this,"targetOffset",new a.Vector3(0,1.5,0)),h._(this,"isLocked",!1),h._(this,"sensitivity",.002),this.camera=t,this.domElement=i,this.onMouseMove=this.onMouseMove.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("pointerlockchange",this.onPointerLockChange),document.addEventListener("wheel",this.onMouseWheel);}}},"26d7988f":function e(e,t,r,n){e._m(t),e.o(t,"Viewer",()=>m);var i=r("09efd1d2");r("b25dd2f8"),r("c550eeaa"),r("2d08c2e5"),r("a3876e70");var o=e.w(r("3b16918b")),s=r("7f2264c7"),h=e.i(r("1498cb29")),a=r("03f4e36a"),d=r("47a20e72"),l=r("69939ce5"),c=r("e9ef43b1");class m{addMixer(e){this.mixers.push(e);}setCharacter(e){this.character=e,e.mesh&&(this.scene.add(e.mesh),this.controllers.thirdPerson.setCharacter(e));}removeMixer(e){var t=this.mixers.indexOf(e);-1!==t&&this.mixers.splice(t,1);}async init(){await this.renderer.init();var e=new o.PMREMGenerator(this.renderer);this.environmentTexture=e.fromScene(new s.RoomEnvironment,.04).texture,this.scene.environment=this.environmentTexture,this.currentController.enter();}lockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!0):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!0);}unlockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!1):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!1);}setMovementMode(e){this.movementMode!==e&&(this.currentController.leave(),this.movementMode=e,this.currentController=this.controllers[e],this.currentController.enter());}setCameraPosition(e){this.camera.position.copy(e);}setCameraDirection(e){if("orbit"!==this.movementMode&&0!==e.lengthSq()){var t=e.clone().normalize();this.tempTarget.copy(this.camera.position).add(t),this.camera.lookAt(this.tempTarget);}}getCameraDirection(){return this.camera.getWorldDirection(this.worldDirection),this.worldDirection.clone();}dispose(){this.renderer.setAnimationLoop(null),Object.values(this.controllers).forEach(e=>e.dispose()),this.renderer.dispose(),this.renderer.domElement.parentElement&&this.renderer.domElement.parentElement.removeChild(this.renderer.domElement),this.stats.dom.parentElement&&this.stats.dom.parentElement.removeChild(this.stats.dom);}setEnvironmentEnabled(e){this.scene.environment=e?this.environmentTexture:null;}setEnvironmentIntensity(e){this.scene.environmentIntensity=e;}setEnvironmentCollider(e){this.controllers.thirdPerson.setCollider(e);}constructor(){i._(this,"scene",void 0),i._(this,"camera",void 0),i._(this,"stats",void 0),i._(this,"renderer",void 0),i._(this,"controllers",void 0),i._(this,"currentController",void 0),i._(this,"movementMode","fly"),i._(this,"clock",new o.Clock),i._(this,"environmentTexture",null),i._(this,"mixers",[]),i._(this,"worldDirection",new o.Vector3),i._(this,"tempTarget",new o.Vector3),i._(this,"character",null),i._(this,"animate",()=>{var e=this.clock.getDelta(),t=!0,r=!1,n=void 0;try{for(var i,o=this.mixers[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)i.value.update(e);}catch(e){r=!0,n=e;}finally{try{t||null==o.return||o.return();}finally{if(r)throw n;}}this.character&&this.character.update(e),this.currentController.update(e),this.stats.update(),this.renderer.render(this.scene,this.camera);}),this.scene=new o.Scene;var t=window.innerWidth,r=window.innerHeight;this.camera=new o.PerspectiveCamera(45,t/r,.1,3e3),this.camera.position.set(1,1,1),this.renderer=new o.WebGPURenderer({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=o.PCFSoftShadowMap,this.renderer.outputColorSpace=o.SRGBColorSpace,this.renderer.toneMapping=o.ACESFilmicToneMapping,this.renderer.toneMappingExposure=1,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(t,r),document.body.appendChild(this.renderer.domElement),this.stats=new(e.f(h)),document.body.appendChild(this.stats.dom),this.controllers={fly:new a.FlyController(this.camera,this.renderer.domElement),orbit:new d.OrbitController(this.camera,this.renderer.domElement),thirdPerson:new l.ThirdPersonController(this.camera,this.renderer.domElement,new o.Vector3),topView:new c.TopViewController(this.camera,this.renderer.domElement)},this.currentController=this.controllers.fly,this.renderer.setAnimationLoop(this.animate),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();});}}var p=new m;t.default=p;},"69939ce5":function e(e,t,i,s){e._m(t),e.o(t,"ThirdPersonController",()=>d);var o=i("09efd1d2"),r=e.w(i("3b16918b")),a=i("23b6b720"),h=i("f247f526"),n=i("0e70da6a"),l=i("9aaf3498"),c=i("96554b2f");class d{setCharacter(e){e.mesh&&this.setPlayerMesh(e.mesh),this.playerVelocity=e.velocity;}setPlayerMesh(e){this.playerMesh=e,this.thirdPersonCamera.setTarget(e);}setCollider(e){this.collider=e,this.thirdPersonCamera.setCollider(e);}enter(){document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp),this.domElement.addEventListener("click",this.onClick),this.playerMesh&&this.thirdPersonCamera.syncWithCamera();var e=n.storeToRefs(h.useSceneStore()),t=e.moveSpeed,i=e.collisionEnabled;this.moveSpeed=t,this.collisionEnabled=i;}leave(){document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.domElement.removeEventListener("click",this.onClick),this.thirdPersonCamera.setLocked(!1),document.pointerLockElement===this.domElement&&document.exitPointerLock();}update(e){this.handleInput(e),this.updatePlayer(e),this.thirdPersonCamera.update(e),this.playerMesh&&c.doorManager.update(this.playerMesh.position);}dispose(){this.thirdPersonCamera.dispose();}onClick(){document.pointerLockElement||(this.domElement.requestPointerLock(),this.thirdPersonCamera.setLocked(!0));}onKeyDown(e){switch(e.code){case"KeyW":case"ArrowUp":this.moveForward=!0;break;case"KeyS":case"ArrowDown":this.moveBackward=!0;break;case"KeyA":case"ArrowLeft":this.moveLeft=!0;break;case"KeyD":case"ArrowRight":this.moveRight=!0;break;case"KeyF":c.doorManager.interact();}}onKeyUp(e){switch(e.code){case"KeyW":case"ArrowUp":this.moveForward=!1;break;case"KeyS":case"ArrowDown":this.moveBackward=!1;break;case"KeyA":case"ArrowLeft":this.moveLeft=!1;break;case"KeyD":case"ArrowRight":this.moveRight=!1;}}handleInput(e){if(this.playerMesh&&(this.camera.getWorldDirection(this.tempForward),this.tempForward.y=0,this.tempForward.normalize(),this.tempRight.crossVectors(this.tempForward,this.camera.up).normalize(),this.playerDirection.set(0,0,0),this.moveForward&&this.playerDirection.add(this.tempForward),this.moveBackward&&this.playerDirection.sub(this.tempForward),this.moveRight&&this.playerDirection.add(this.tempRight),this.moveLeft&&this.playerDirection.sub(this.tempRight),this.playerDirection.lengthSq()>0)){this.playerDirection.normalize(),this.playerVelocity.add(this.playerDirection.multiplyScalar(this.moveSpeed.value*e));var t=Math.atan2(this.playerDirection.x,this.playerDirection.z),i=new r.Quaternion;i.setFromAxisAngle(new r.Vector3(0,1,0),t),this.playerMesh.quaternion.slerp(i,.2);}}updatePlayer(e){if(this.playerMesh){var t=Math.exp(-4*e)-1;this.playerVelocity.addScaledVector(this.playerVelocity,t);var i=this.playerVelocity.clone().multiplyScalar(e);this.collider&&this.collisionEnabled.value&&(this.resolveCollisions(i),c.doorManager.checkCollision(this.playerMesh.position,.15,i)),this.playerMesh.position.add(i);}}resolveCollisions(e){if(this.playerMesh&&this.collider){var t=new r.Vector3(0,.2,0),i=this.playerMesh.position.clone().add(t).add(e),s=this.collider.geometry.boundsTree;if(s){for(var o=new r.Vector3,a=0;a<5;a++)s.shapecast({intersectsBounds:e=>.15>e.distanceToPoint(i),intersectsTriangle:e=>{var t=e.closestPointToPoint(i,o).distanceTo(i);if(t<.15){var s=.15-t,r=i.clone().sub(o).normalize();r.y=0,i.addScaledVector(r,s);}}});var h=i.clone().sub(t);e.copy(h).sub(this.playerMesh.position);}}}setLocked(e){this.thirdPersonCamera.setLocked(e),e?this.domElement.requestPointerLock():document.pointerLockElement===this.domElement&&document.exitPointerLock();}constructor(e,t,i){o._(this,"camera",void 0),o._(this,"domElement",void 0),o._(this,"thirdPersonCamera",void 0),o._(this,"playerMesh",null),o._(this,"playerVelocity",void 0),o._(this,"playerDirection",new r.Vector3),o._(this,"moveForward",!1),o._(this,"moveBackward",!1),o._(this,"moveLeft",!1),o._(this,"moveRight",!1),o._(this,"tempForward",new r.Vector3),o._(this,"tempRight",new r.Vector3),o._(this,"collider",null),o._(this,"moveSpeed",l.ref(0)),o._(this,"collisionEnabled",l.ref(!0)),this.camera=e,this.domElement=t,this.playerVelocity=i,this.thirdPersonCamera=new a.ThirdPersonCamera(e,t),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onClick=this.onClick.bind(this);}}},"80c0fbdc":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70"),a("db38ec0f");var u=a("9aaf3498"),r=a("9aaf3498"),n=a("9aaf3498"),i=a("1f6a8afd"),d=a("0e70da6a"),o=a("f247f526"),f=e.i(a("26d7988f"));t.default=u.defineComponent({__name:"SceneParamsPanel",setup(t){var a=o.useSceneStore(),l=d.storeToRefs(a),u=l.movementMode,N=l.moveSpeed,c=l.cameraPosition,s=l.cameraDirection,x=l.isEditingPosition,p=l.isEditingDirection,v=l.playerPosition,h=l.isEditingPlayerPosition,V=l.showCollisionBoxes,w=l.collisionEnabled,C=l.skyboxEnabled,_=l.sunEnabled,m=l.sunColor,S=l.sunIntensity,z=l.sunPosition,T=l.ambientEnabled,y=l.ambientColor,g=l.ambientIntensity,b=l.environmentEnabled,U=l.environmentIntensity,G=l.spotEnabled,D=l.spotColor,R=l.spotIntensity,F=l.spotAngle,B=l.spotPenumbra,E=l.spotDecay,I=l.spotDistance,P=[{label:"飞行",value:"fly"},{label:"轨道",value:"orbit"},{label:"第三人称",value:"thirdPerson"},{label:"俯视",value:"topView"}];return n.watch(b,t=>{e.f(f).setEnvironmentEnabled(t);}),n.watch(U,t=>{e.f(f).setEnvironmentIntensity(t);}),(e,t)=>(r.openBlock(),r.createElementBlock(r.Fragment,null,[r.createVNode(r.unref(i.NText),{depth:"3"},{default:r.withCtx(()=>[...t[50]||(t[50]=[r.createTextVNode("实时调整移动方式、摄像机与光照参数。",-1)])]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"large",style:{"margin-top":"16px"}},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"2",style:{"font-size":"12px","text-transform":"uppercase"}},{default:r.withCtx(()=>[...t[51]||(t[51]=[r.createTextVNode("移动方式",-1)])]),_:1}),r.createVNode(r.unref(i.NSelect),{value:r.unref(u),"onUpdate:value":t[0]||(t[0]=e=>r.isRef(u)?u.value=e:null),options:P},null,8,["value"])]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{justify:"space-between",style:{width:"100%"}},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"2",style:{"font-size":"12px","text-transform":"uppercase"}},{default:r.withCtx(()=>[...t[52]||(t[52]=[r.createTextVNode("移动速度",-1)])]),_:1}),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[r.createTextVNode(r.toDisplayString(Math.round(r.unref(N)))+" u/s",1)]),_:1})]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(N),"onUpdate:value":t[1]||(t[1]=e=>r.isRef(N)?N.value=e:null),min:1,max:50,step:1},null,8,["value"])]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"2",style:{"font-size":"12px","text-transform":"uppercase"}},{default:r.withCtx(()=>[...t[53]||(t[53]=[r.createTextVNode("碰撞",-1)])]),_:1}),r.createVNode(r.unref(i.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSwitch),{value:r.unref(w),"onUpdate:value":t[2]||(t[2]=e=>r.isRef(w)?w.value=e:null)},null,8,["value"]),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[...t[54]||(t[54]=[r.createTextVNode("启用碰撞",-1)])]),_:1})]),_:1}),r.createVNode(r.unref(i.NSpace)),r.createVNode(r.unref(i.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSwitch),{value:r.unref(V),"onUpdate:value":t[3]||(t[3]=e=>r.isRef(V)?V.value=e:null)},null,8,["value"]),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[...t[55]||(t[55]=[r.createTextVNode("显示碰撞箱",-1)])]),_:1})]),_:1})]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"2",style:{"font-weight":"600"}},{default:r.withCtx(()=>[...t[56]||(t[56]=[r.createTextVNode("摄像机位置",-1)])]),_:1}),r.createVNode(r.unref(i.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[57]||(t[57]=[r.createTextVNode("X",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(c).x,"onUpdate:value":t[4]||(t[4]=e=>r.unref(c).x=e),size:"small","show-button":!1,onFocus:t[5]||(t[5]=e=>x.value=!0),onBlur:t[6]||(t[6]=e=>x.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[58]||(t[58]=[r.createTextVNode("Y",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(c).y,"onUpdate:value":t[7]||(t[7]=e=>r.unref(c).y=e),size:"small","show-button":!1,onFocus:t[8]||(t[8]=e=>x.value=!0),onBlur:t[9]||(t[9]=e=>x.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[59]||(t[59]=[r.createTextVNode("Z",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(c).z,"onUpdate:value":t[10]||(t[10]=e=>r.unref(c).z=e),size:"small","show-button":!1,onFocus:t[11]||(t[11]=e=>x.value=!0),onBlur:t[12]||(t[12]=e=>x.value=!1)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),"thirdPerson"===r.unref(u)?(r.openBlock(),r.createBlock(r.unref(i.NSpace),{key:0,vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"2",style:{"font-weight":"600"}},{default:r.withCtx(()=>[...t[60]||(t[60]=[r.createTextVNode("玩家位置",-1)])]),_:1}),r.createVNode(r.unref(i.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[61]||(t[61]=[r.createTextVNode("X",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(v).x,"onUpdate:value":t[13]||(t[13]=e=>r.unref(v).x=e),size:"small","show-button":!1,onFocus:t[14]||(t[14]=e=>h.value=!0),onBlur:t[15]||(t[15]=e=>h.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[62]||(t[62]=[r.createTextVNode("Y",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(v).y,"onUpdate:value":t[16]||(t[16]=e=>r.unref(v).y=e),size:"small","show-button":!1,onFocus:t[17]||(t[17]=e=>h.value=!0),onBlur:t[18]||(t[18]=e=>h.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[63]||(t[63]=[r.createTextVNode("Z",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(v).z,"onUpdate:value":t[19]||(t[19]=e=>r.unref(v).z=e),size:"small","show-button":!1,onFocus:t[20]||(t[20]=e=>h.value=!0),onBlur:t[21]||(t[21]=e=>h.value=!1)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})):r.createCommentVNode("",!0),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"2",style:{"font-weight":"600"}},{default:r.withCtx(()=>[...t[64]||(t[64]=[r.createTextVNode("摄像机方向",-1)])]),_:1}),r.createVNode(r.unref(i.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[65]||(t[65]=[r.createTextVNode("X",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(s).x,"onUpdate:value":t[22]||(t[22]=e=>r.unref(s).x=e),size:"small","show-button":!1,onFocus:t[23]||(t[23]=e=>p.value=!0),onBlur:t[24]||(t[24]=e=>p.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[66]||(t[66]=[r.createTextVNode("Y",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(s).y,"onUpdate:value":t[25]||(t[25]=e=>r.unref(s).y=e),size:"small","show-button":!1,onFocus:t[26]||(t[26]=e=>p.value=!0),onBlur:t[27]||(t[27]=e=>p.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[67]||(t[67]=[r.createTextVNode("Z",-1)])]),_:1}),r.createVNode(r.unref(i.NInputNumber),{value:r.unref(s).z,"onUpdate:value":t[28]||(t[28]=e=>r.unref(s).z=e),size:"small","show-button":!1,onFocus:t[29]||(t[29]=e=>p.value=!0),onBlur:t[30]||(t[30]=e=>p.value=!1)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSwitch),{value:r.unref(C),"onUpdate:value":t[31]||(t[31]=e=>r.isRef(C)?C.value=e:null)},null,8,["value"]),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[...t[68]||(t[68]=[r.createTextVNode("天空盒",-1)])]),_:1})]),_:1})]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSwitch),{value:r.unref(_),"onUpdate:value":t[32]||(t[32]=e=>r.isRef(_)?_.value=e:null)},null,8,["value"]),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[...t[69]||(t[69]=[r.createTextVNode("太阳光",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(i.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[70]||(t[70]=[r.createTextVNode("颜色",-1)])]),_:1}),r.createVNode(r.unref(i.NColorPicker),{value:r.unref(m),"onUpdate:value":t[33]||(t[33]=e=>r.isRef(m)?m.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("亮度 "+r.toDisplayString(r.unref(S).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(S),"onUpdate:value":t[34]||(t[34]=e=>r.isRef(S)?S.value=e:null),min:0,max:10,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(_)]]),r.withDirectives(r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[71]||(t[71]=[r.createTextVNode("光源位置",-1)])]),_:1}),r.createVNode(r.unref(i.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("X "+r.toDisplayString(r.unref(z).x),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(z).x,"onUpdate:value":t[35]||(t[35]=e=>r.unref(z).x=e),min:-100,max:100,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("Y "+r.toDisplayString(r.unref(z).y),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(z).y,"onUpdate:value":t[36]||(t[36]=e=>r.unref(z).y=e),min:0,max:100,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("Z "+r.toDisplayString(r.unref(z).z),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(z).z,"onUpdate:value":t[37]||(t[37]=e=>r.unref(z).z=e),min:-100,max:100,step:1},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(_)]])]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSwitch),{value:r.unref(T),"onUpdate:value":t[38]||(t[38]=e=>r.isRef(T)?T.value=e:null)},null,8,["value"]),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[...t[72]||(t[72]=[r.createTextVNode("全局环境光",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(i.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[73]||(t[73]=[r.createTextVNode("颜色",-1)])]),_:1}),r.createVNode(r.unref(i.NColorPicker),{value:r.unref(y),"onUpdate:value":t[39]||(t[39]=e=>r.isRef(y)?y.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("亮度 "+r.toDisplayString(r.unref(g).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(g),"onUpdate:value":t[40]||(t[40]=e=>r.isRef(g)?g.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(T)]])]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSwitch),{value:r.unref(b),"onUpdate:value":t[41]||(t[41]=e=>r.isRef(b)?b.value=e:null)},null,8,["value"]),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[...t[74]||(t[74]=[r.createTextVNode("环境光照 (RoomEnvironment)",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("强度 "+r.toDisplayString(r.unref(U).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(U),"onUpdate:value":t[42]||(t[42]=e=>r.isRef(U)?U.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1},512),[[r.vShow,r.unref(b)]])]),_:1}),r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSwitch),{value:r.unref(G),"onUpdate:value":t[43]||(t[43]=e=>r.isRef(G)?G.value=e:null)},null,8,["value"]),r.createVNode(r.unref(i.NText),null,{default:r.withCtx(()=>[...t[75]||(t[75]=[r.createTextVNode("摄像机聚光灯",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(i.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[76]||(t[76]=[r.createTextVNode("颜色",-1)])]),_:1}),r.createVNode(r.unref(i.NColorPicker),{value:r.unref(D),"onUpdate:value":t[44]||(t[44]=e=>r.isRef(D)?D.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("亮度 "+r.toDisplayString(r.unref(R).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(R),"onUpdate:value":t[45]||(t[45]=e=>r.isRef(R)?R.value=e:null),min:0,max:100,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(G)]]),r.withDirectives(r.createVNode(r.unref(i.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("锥形角度 "+r.toDisplayString(r.unref(F))+"°",1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(F),"onUpdate:value":t[46]||(t[46]=e=>r.isRef(F)?F.value=e:null),min:5,max:90,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("半影 "+r.toDisplayString(r.unref(B).toFixed(2)),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(B),"onUpdate:value":t[47]||(t[47]=e=>r.isRef(B)?B.value=e:null),min:0,max:1,step:.01},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(G)]]),r.withDirectives(r.createVNode(r.unref(i.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("衰减 "+r.toDisplayString(r.unref(E).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(E),"onUpdate:value":t[48]||(t[48]=e=>r.isRef(E)?E.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(i.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(i.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("距离 "+r.toDisplayString(r.unref(I)),1)]),_:1}),r.createVNode(r.unref(i.NSlider),{value:r.unref(I),"onUpdate:value":t[49]||(t[49]=e=>r.isRef(I)?I.value=e:null),min:0,max:5e3,step:10},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(G)]])]),_:1})]),_:1})],64));}});},"8f363abd":function t(t,i,s,h){t._m(i),t.o(i,"LightManager",()=>L);var e=s("09efd1d2"),a=t.w(s("3b16918b")),o=s("f247f526"),n=s("0e70da6a"),g=s("9aaf3498");class L{initLights(){this.sunLight=new a.DirectionalLight(16777215,1),this.sunLight.position.set(10,20,-20),this.sunLight.castShadow=!0,this.sunLight.shadow.bias=-.0001,this.sunLight.shadow.normalBias=.05,this.sunLight.shadow.camera.near=.5,this.sunLight.shadow.camera.far=50,this.sunLight.shadow.camera.left=-20,this.sunLight.shadow.camera.right=20,this.sunLight.shadow.camera.top=20,this.sunLight.shadow.camera.bottom=-20,this.sunLight.shadow.mapSize.width=2048,this.sunLight.shadow.mapSize.height=2048,this.scene.add(this.sunLight),this.cameraHelper=new a.CameraHelper(this.sunLight.shadow.camera),this.scene.add(this.cameraHelper),this.cameraHelper.update(),this.ambientLight=new a.AmbientLight(16777215,1),this.scene.add(this.ambientLight),this.spotLight=new a.SpotLight(16777215,1),this.spotLight.castShadow=!0,this.spotLight.shadow.bias=-.0001,this.spotLight.shadow.normalBias=.05,this.spotLight.angle=Math.PI/6,this.spotLight.penumbra=.3,this.spotLight.decay=1,this.spotLight.distance=1e3,this.camera.add(this.spotLight),this.spotLight.position.set(0,0,0),this.spotLight.target.position.set(0,0,-1),this.camera.add(this.spotLight.target);}setupReactivity(){var t=o.useSceneStore(),i=n.storeToRefs(t),s=i.sunEnabled,h=i.sunColor,e=i.sunIntensity,a=i.sunPosition,L=i.ambientEnabled,u=i.ambientColor,p=i.ambientIntensity,r=i.spotEnabled,c=i.spotColor,d=i.spotIntensity,l=i.spotAngle,m=i.spotPenumbra,v=i.spotDecay,b=i.spotDistance;g.watchEffect(()=>{this.sunLight.visible=s.value,this.sunLight.color.set(h.value),this.sunLight.intensity=e.value,this.sunLight.position.set(a.value.x,a.value.y,a.value.z),this.cameraHelper.update();}),g.watchEffect(()=>{this.ambientLight.visible=L.value,this.ambientLight.color.set(u.value),this.ambientLight.intensity=p.value;}),g.watchEffect(()=>{this.spotLight.visible=r.value,this.spotLight.color.set(c.value),this.spotLight.intensity=d.value,this.spotLight.angle=l.value*Math.PI/180,this.spotLight.penumbra=m.value,this.spotLight.decay=v.value,this.spotLight.distance=b.value;});}constructor(t,i){e._(this,"scene",void 0),e._(this,"camera",void 0),e._(this,"sunLight",void 0),e._(this,"ambientLight",void 0),e._(this,"spotLight",void 0),e._(this,"cameraHelper",void 0),this.scene=t,this.camera=i,this.initLights(),this.setupReactivity();}}},"96554b2f":function t(t,i,o,n){t._m(i),t.o(i,"Door",()=>s),t.o(i,"DoorManager",()=>c),t.o(i,"doorManager",()=>h);var e=o("09efd1d2");o("c550eeaa"),o("2d08c2e5"),o("a3876e70");var a=t.w(o("3b16918b")),r=o("f247f526");class s{get isAnimating(){return!!this.action&&this.action.isRunning();}interact(){this.action&&(this.isOpen=!this.isOpen,this.action.paused=!1,this.isOpen?this.action.timeScale=1:this.action.timeScale=-1,this.action.play());}getDistance(t){return this.object.getWorldPosition(this.worldPosition),this.worldPosition.distanceTo(t);}constructor(t,i,o){e._(this,"object",void 0),e._(this,"isOpen",!1),e._(this,"mixer",void 0),e._(this,"action",null),e._(this,"box",void 0),e._(this,"worldPosition",new a.Vector3),this.object=t,this.box=new a.Box3().setFromObject(t),this.mixer=o;var n=t.name+"Open",r=i.find(t=>t.name===n);r?(this.action=this.mixer.clipAction(r),this.action.loop=a.LoopOnce,this.action.clampWhenFinished=!0):console.warn("Animation ".concat(n," not found for door ").concat(t.name));}}class c{addDoor(t,i,o){if(!this.doors.find(i=>i.object===t)){var n=new s(t,i,o);this.doors.push(n);}}update(t){var i=null,o=1/0,n=!0,e=!1,a=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value,l=h.getDistance(t);l<this.interactionDistance&&l<o&&(o=l,i=h);}}catch(t){e=!0,a=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw a;}}var x=r.useSceneStore();i?(this.activeDoor=i,x.showInteractionPrompt=!0,x.interactionText=i.isOpen?"按 F 关门":"按 F 开门"):(this.activeDoor=null,x.showInteractionPrompt=!1);}interact(){this.activeDoor&&this.activeDoor.interact();}checkCollision(t,i,o){var n=!0,e=!1,r=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value;if(!h.isOpen&&!h.isAnimating){h.box.setFromObject(h.object);var l=new a.Box3,x=t.clone().add(o);if(l.min.set(x.x-i,x.y,x.z-i),l.max.set(x.x+i,x.y+2,x.z+i),h.box.intersectsBox(l)){var d=h.box.clone().intersect(l),m=d.max.x-d.min.x,v=d.max.z-d.min.z;m<v?x.x<h.box.min.x+(h.box.max.x-h.box.min.x)/2?o.x-=m:o.x+=m:x.z<h.box.min.z+(h.box.max.z-h.box.min.z)/2?o.z-=v:o.z+=v;}}}}catch(t){e=!0,r=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw r;}}}constructor(){e._(this,"doors",[]),e._(this,"interactionDistance",2),e._(this,"activeDoor",null);}}var h=new c;},"cca86db6":function e(e,o,n,t){e._m(o);var a=n("493f9ad4");n("b25dd2f8");var r=n("9aaf3498"),i=n("9aaf3498"),l=n("9aaf3498"),d=e.i(n("26d7988f")),c=n("1f6a8afd"),s=n("0e70da6a"),u=n("f247f526"),f=e.i(n("7cdc7ff0")),v=e.i(n("93e7dcc4")),m=e.i(n("d0f5b517")),p=n("d6303f37"),h={class:"ui-layer"},g={key:0,class:"interaction-prompt"};o.default=r.defineComponent({__name:"Viewer",async setup(o){var n,t,P,k=u.useSceneStore(),y=s.storeToRefs(k),E=y.isLoading,C=y.loadingProgress,w=y.isDarkMode,L=y.movementMode,V=y.isEditingPosition,N=y.isEditingDirection,B=y.playerPosition,D=y.isEditingPlayerPosition,_=y.showInteractionPrompt,b=y.interactionText;n=(P=a._(r.withAsyncContext(()=>p.initViewerScene()),2))[0],t=P[1],await n,t();var x=l.computed(()=>w.value?c.darkTheme:null),S=l.ref(!1),I=()=>{("fly"===L.value||"thirdPerson"===L.value)&&e.f(d).lockPointer();},M=()=>{var o;V.value||k.updateCameraPosition(e.f(d).camera.position),N.value||k.updateCameraDirection(e.f(d).getCameraDirection()),"thirdPerson"===L.value&&!D.value&&(null===(o=e.f(d).character)||void 0===o?void 0:o.mesh)&&k.updatePlayerPosition(e.f(d).character.mesh.position);};l.watch(B,o=>{var n;(null===(n=e.f(d).character)||void 0===n?void 0:n.mesh)&&e.f(d).character.mesh.position.set(o.x,o.y,o.z);},{deep:!0});var T=l.computed(()=>("fly"===L.value||"thirdPerson"===L.value)&&!S.value),z=null,A=()=>{S.value=document.pointerLockElement===e.f(d).renderer.domElement;};return l.onMounted(()=>{z=setInterval(M,200),document.addEventListener("pointerlockchange",A);}),l.onBeforeUnmount(()=>{null!==z&&(clearInterval(z),z=null),document.removeEventListener("pointerlockchange",A);}),(o,n)=>(i.openBlock(),i.createBlock(i.unref(c.NConfigProvider),{theme:x.value},{default:i.withCtx(()=>[i.createVNode(e.f(f),{isLoading:i.unref(E),progress:i.unref(C)},null,8,["isLoading","progress"]),i.createElementVNode("div",h,[i.createVNode(e.f(v),{visible:T.value,mode:i.unref(L),onEnterPointerLock:I},null,8,["visible","mode"]),i.unref(_)?(i.openBlock(),i.createElementBlock("div",g,i.toDisplayString(i.unref(b)),1)):i.createCommentVNode("",!0),i.createVNode(e.f(m))])]),_:1},8,["theme"]));}});},"d6303f37":function e(e,a,o,r){e._m(a),e.o(a,"initViewerScene",()=>w),o("b25dd2f8"),o("40616381");var t=o("9aaf3498"),n=e.i(o("26d7988f")),s=e.w(o("3b16918b")),d=o("e00be090"),i=o("f247f526"),c=o("0e70da6a"),l=o("f4cd7510"),f=o("6519cad4"),h=o("8f363abd"),u=o("e0c628a7"),m=o("c2079dd8"),g=o("96554b2f"),v=o("99602713");async function w(){var a=i.useSceneStore(),o=c.storeToRefs(a),r=o.skyboxEnabled,f=o.cameraPosition,w=o.cameraDirection,M=o.isEditingPosition,S=o.isEditingDirection,b=o.movementMode,p=o.showCollisionBoxes;await e.f(n).init();var y=new s.CubeTextureLoader;y.setPath("/cubeMap/");var T=y.load(v.ASSETS.textures.skybox);e.f(n).scene.background=T;var x=new l.InfiniteGrid;e.f(n).scene.add(x),e.f(n).scene.add(e.f(n).camera),new h.LightManager(e.f(n).scene,e.f(n).camera);var C=new d.ModelLoader(e.f(n).renderer);async function E(){var o=new u.Character;try{await o.load(C,v.ASSETS.models.characterIdle,v.ASSETS.models.characterWalk,e=>{e.lengthComputable&&(a.loadingProgress=50+Math.round(e.loaded/e.total*50));}),e.f(n).setCharacter(o),a.movementMode="thirdPerson",a.isLoading=!1;}catch(e){console.error("Character loading failed:",e),a.isLoading=!1;}}C.loadGLTF(v.ASSETS.models.home,e=>{e.lengthComputable&&(a.loadingProgress=Math.round(e.loaded/e.total*50));}).then(o=>{o.scene.position.set(0,.1,0),e.f(n).scene.add(o.scene),a.setModelRoot(o.scene),o.scene.updateMatrixWorld(!0);var r=new s.AnimationMixer(o.scene);e.f(n).addMixer(r),o.scene.traverse(e=>{e.isMesh&&(e.receiveShadow=!0,e.castShadow=!0,e.name.endsWith("Glass")&&(e.castShadow=!1));});var t=o.scene.getObjectByName("Door");t&&t.children.forEach(e=>{console.log(e.name),g.doorManager.addDoor(e,o.animations,r);}),m.colliderManager.generateCollider(o.scene),m.colliderManager.setVisibility(p.value),E();}).catch(e=>{console.error("模型加载失败:",e),a.isLoading=!1;}),t.watch(f,a=>{if(M.value){var o=new s.Vector3(a.x,a.y,a.z);e.f(n).setCameraPosition(o);}},{deep:!0}),t.watch(w,a=>{if(S.value){var o=new s.Vector3(a.x,a.y,a.z);o.lengthSq()>0&&e.f(n).setCameraDirection(o);}},{deep:!0}),t.watchEffect(()=>{e.f(n).setMovementMode(b.value),e.f(n).scene.background=r.value?T:null;}),t.watch(p,e=>{m.colliderManager.setVisibility(e);});}s.BufferGeometry.prototype.computeBoundsTree=f.computeBoundsTree,s.BufferGeometry.prototype.disposeBoundsTree=f.disposeBoundsTree,s.Mesh.prototype.raycast=f.acceleratedRaycast;},"e0c628a7":function t(t,i,e,s){t._m(i),t.o(i,"Character",()=>o);var a=e("09efd1d2");e("b25dd2f8");var n=t.w(e("3b16918b"));class o{setupMeshProperties(t){t.traverse(t=>{if(t.isMesh){t.castShadow=!0,t.receiveShadow=!0;var i=t.material;t.material=new n.MeshStandardMaterial({color:i.color,map:i.map,roughness:.8,metalness:.1});}});}async load(t,i,e,s){var a=(t,i)=>{s&&i.lengthComputable&&i.total>0&&s(new ProgressEvent("progress",{lengthComputable:!0,loaded:100*(.5*t+.5*(i.loaded/i.total)),total:100}));},o=await t.loadFBX(i,t=>a(0,t));this.mesh=o,o.scale.set(.01,.01,.01),o.position.set(0,.1,0),this.setupMeshProperties(o),this.mixer=new n.AnimationMixer(o),this.idleAction=this.mixer.clipAction(o.animations[0]),this.idleAction.play(),this.currentAction=this.idleAction;var r=await t.loadFBX(e,t=>a(1,t));this.setupMeshProperties(r),this.walkAction=this.mixer.clipAction(r.animations[0]);}update(t){this.mixer&&this.mixer.update(t),this.updateAnimation();}updateAnimation(){if(this.idleAction&&this.walkAction){var t=this.velocity.length()>1?this.walkAction:this.idleAction;this.currentAction!==t&&(this.currentAction&&this.currentAction.fadeOut(.2),t.reset().fadeIn(.2).play(),this.currentAction=t);}}constructor(){a._(this,"mesh",null),a._(this,"velocity",new n.Vector3),a._(this,"mixer",null),a._(this,"idleAction",null),a._(this,"walkAction",null),a._(this,"currentAction",null);}}},"e9ef43b1":function t(t,o,n,i){t._m(o),t.o(o,"TopViewController",()=>a);var s=n("09efd1d2"),e=t.w(n("3b16918b")),r=n("1500a9c9");class a{enter(){this.controls.enabled=!0,this.animateToTopView();}leave(){this.controls.enabled=!1,this.isAnimating=!1;}update(t){this.isAnimating||this.controls.update(t);}dispose(){this.controls.dispose();}animateToTopView(){this.isAnimating=!0;var t=this.camera.position.clone(),o=new e.Vector3;this.camera.getWorldDirection(o).normalize();var n=t.clone().add(o),i=new e.Vector3(o.x,0,o.z),s=new e.Vector3(0,20,0),r=performance.now();this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI;var a=()=>{if(this.controls.enabled){var o=Math.min((performance.now()-r)/1e3,1),e=3*Math.pow(o,2)-2*Math.pow(o,3);this.camera.position.lerpVectors(t,s,e),this.controls.target.lerpVectors(n,i,e),this.camera.lookAt(this.controls.target),o<1?requestAnimationFrame(a):(this.isAnimating=!1,this.controls.minPolarAngle=0,this.controls.maxPolarAngle=.1);}};a();}constructor(t,o){s._(this,"camera",void 0),s._(this,"controls",void 0),s._(this,"isAnimating",!1),this.camera=t,this.controls=new r.OrbitControls(t,o),this.controls.target.set(0,0,0),this.controls.enabled=!1,this.controls.enableDamping=!0,this.controls.dampingFactor=.08,this.controls.rotateSpeed=.35,this.controls.minPolarAngle=0,this.controls.maxPolarAngle=.01,this.controls.enablePan=!0,this.controls.screenSpacePanning=!0;}}},"f247f526":function e(e,r,f,a){e._m(r),e.o(r,"useSceneStore",()=>i),f("bf3a4d74"),f("db38ec0f");var t=f("0e70da6a"),o=f("9aaf3498"),F=(e,r)=>{r.x=parseFloat(e.x.toFixed(2)),r.y=parseFloat(e.y.toFixed(2)),r.z=parseFloat(e.z.toFixed(2));},i=t.defineStore("scene",()=>{var e=o.ref(!0),r=o.ref(0),f=o.ref(!0),a=o.ref(null),t=o.ref("fly"),i=o.ref(20),n=o.reactive({x:1,y:1,z:1}),c=o.reactive({x:0,y:0,z:-1}),u=o.ref(!1),d=o.ref(!1),l=o.reactive({x:0,y:.1,z:0}),s=o.ref(!1),x=o.ref(!1),y=o.ref(!0),p=o.ref(!1),v=o.ref(""),z=o.ref(!0),m=o.ref(!0),D=o.ref("#FFFFFF"),P=o.ref(1),S=o.reactive({x:10,y:20,z:-20}),b=o.ref(!1),C=o.ref("#FFFFFF"),R=o.ref(1),k=o.ref(!0),w=o.ref(1),M=o.ref(!1),_=o.ref("#FFFFFF"),g=o.ref(1),h=o.ref(30),j=o.ref(.3);return{isLoading:e,loadingProgress:r,isDarkMode:f,modelRoot:a,movementMode:t,moveSpeed:i,cameraPosition:n,cameraDirection:c,isEditingPosition:u,isEditingDirection:d,playerPosition:l,isEditingPlayerPosition:s,showCollisionBoxes:x,collisionEnabled:y,showInteractionPrompt:p,interactionText:v,skyboxEnabled:z,sunEnabled:m,sunColor:D,sunIntensity:P,sunPosition:S,ambientEnabled:b,ambientColor:C,ambientIntensity:R,environmentEnabled:k,environmentIntensity:w,spotEnabled:M,spotColor:_,spotIntensity:g,spotAngle:h,spotPenumbra:j,spotDecay:o.ref(1),spotDistance:o.ref(1e3),setModelRoot:function(e){a.value=e?o.markRaw(e):null;},updateCameraPosition:function(e){F(e,n);},updateCameraDirection:function(e){F(e,c);},updatePlayerPosition:function(e){F(e,l);}};});},"ff9d919c":function e(e,t,o,r){e._m(t),o("2d08c2e5"),o("a3876e70");var a=o("9aaf3498"),c=o("9aaf3498"),d=o("1f6a8afd"),n=o("9aaf3498");t.default=a.defineComponent({__name:"PointerLockPrompt",props:{visible:{type:Boolean},mode:{}},emits:["enterPointerLock"],setup(e,t){var o=t.emit,r=n.computed(()=>"fly"===e.mode?"自由飞行视角":"第三人称视角");return(t,a)=>c.withDirectives((c.openBlock(),c.createBlock(c.unref(d.NCard),{class:"controls-overlay",bordered:!1,size:"small",title:r.value},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NText),{depth:"3"},{default:c.withCtx(()=>["fly"===e.mode?(c.openBlock(),c.createElementBlock(c.Fragment,{key:0},[a[4]||(a[4]=c.createTextVNode(" 点击下方按钮以锁定鼠标，使用 ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[1]||(a[1]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[5]||(a[5]=c.createTextVNode(" 移动，",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[2]||(a[2]=[c.createTextVNode("空格",-1)])]),_:1}),a[6]||(a[6]=c.createTextVNode(" 上升，",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[3]||(a[3]=[c.createTextVNode("Shift",-1)])]),_:1}),a[7]||(a[7]=c.createTextVNode(" 下降，鼠标旋转方向。 ",-1))],64)):(c.openBlock(),c.createElementBlock(c.Fragment,{key:1},[a[9]||(a[9]=c.createTextVNode(" 点击下方按钮以锁定鼠标，使用 ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[8]||(a[8]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[10]||(a[10]=c.createTextVNode(" 移动，鼠标旋转视角。 ",-1))],64))]),_:1}),c.createVNode(c.unref(d.NSpace),{vertical:"",style:{"margin-top":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NButton),{type:"primary",onClick:a[0]||(a[0]=e=>o("enterPointerLock")),block:""},{default:c.withCtx(()=>[...a[11]||(a[11]=[c.createTextVNode("开始体验",-1)])]),_:1}),c.createVNode(c.unref(d.NText),{depth:"3",style:{"font-size":"12px"}},{default:c.withCtx(()=>[a[13]||(a[13]=c.createTextVNode("按 ",-1)),c.createVNode(c.unref(d.NText),{code:""},{default:c.withCtx(()=>[...a[12]||(a[12]=[c.createTextVNode("Esc",-1)])]),_:1}),a[14]||(a[14]=c.createTextVNode(" 可退出锁定",-1))]),_:1})]),_:1})]),_:1},8,["title"])),[[c.vShow,e.visible]]);}});},});
//# sourceMappingURL=index_d3d1.2c52ab03.js.map