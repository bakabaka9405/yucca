(function(_){var filename = ((function(){var _documentCurrentScript = typeof document !== "undefined" ? document.currentScript : null;return typeof document === "undefined" ? require("url").pathToFileURL(__filename).href : _documentCurrentScript && _documentCurrentScript.src || new URL("index_62e3.js", document.baseURI).href})());for(var r in _){_[r].__farm_resource_pot__=filename;window['f1d71b9dd14324d7340d3311efaf8136'].__farm_module_system__.register(r,_[r])}})({"03f4e36a":function t(t,e,o,i){t._m(e),t.o(e,"FlyController",()=>d);var s=o("09efd1d2"),c=t.w(o("3b16918b")),r=o("9aaf3498"),n=o("21f39150"),h=o("f247f526"),l=o("0e70da6a"),m=o("3eec3e47");class d{setDomElement(t){var e=this.controls.isLocked;this.leave(),this.domElement=t,this.controls=new n.PointerLockControls(this.camera,t),e&&this.enter();}enter(){this.domElement.addEventListener("click",this.onClick),this.controls.connect(this.domElement),this.controls.lock();var t=l.storeToRefs(h.useSceneStore()).moveSpeed;this.moveSpeed=t;}leave(){this.domElement.removeEventListener("click",this.onClick),this.controls.unlock(),this.controls.disconnect();}update(t){if(this.controls.isLocked){this.velocity.multiplyScalar(Math.exp(-5*t));var e=m.InputManager.getInstance(),o=e.getMovementInput();this.moveUp=e.isKeyPressed("Space"),this.moveDown=e.isKeyPressed("ShiftLeft")||e.isKeyPressed("ShiftRight"),this.direction.set(o.x,Number(this.moveUp)-Number(this.moveDown),o.z),this.direction.lengthSq()>0&&(this.direction.normalize(),this.camera.getWorldDirection(this.tempForward).normalize(),this.tempRight.crossVectors(this.tempForward,new c.Vector3(0,1,0)).normalize(),this.moveVector.copy(this.tempForward).multiplyScalar(this.direction.z),this.moveVector.addScaledVector(this.tempRight,this.direction.x),this.moveVector.y+=this.direction.y,this.moveVector.normalize(),this.velocity.addScaledVector(this.moveVector,this.moveSpeed.value*t)),this.camera.position.addScaledVector(this.velocity,t);}}dispose(){this.controls.dispose();}onClick(){this.controls.isLocked||this.controls.lock();}setLocked(t){t?this.controls.lock():this.controls.unlock();}constructor(t,e){s._(this,"camera",void 0),s._(this,"domElement",void 0),s._(this,"controls",void 0),s._(this,"moveUp",!1),s._(this,"moveDown",!1),s._(this,"velocity",new c.Vector3),s._(this,"direction",new c.Vector3),s._(this,"moveVector",new c.Vector3),s._(this,"tempRight",new c.Vector3),s._(this,"tempForward",new c.Vector3),s._(this,"moveSpeed",r.ref(0)),this.camera=t,this.domElement=e,this.controls=new n.PointerLockControls(t,e),this.onClick=this.onClick.bind(this);}}},"0c69ee6e":function d(d,a,f,c){d._m(a);var e=d.i(f("bd4a3b48")),i=d.i(f("ddc00f4e"));a.default=d.f(i)(d.f(e),[["__scopeId","data-v-6fa670d2"]]);},"21929cc9":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var r=a("9aaf3498"),u=a("9aaf3498"),n=a("1f6a8afd"),f=a("0e70da6a"),d=a("f247f526");t.default=r.defineComponent({__name:"DebugPanel",setup(e){var t=d.useSceneStore(),a=f.storeToRefs(t),l=a.collisionEnabled,r=a.showCollisionBoxes,c=a.rendererInfo;return(e,a)=>(u.openBlock(),u.createBlock(u.unref(n.NSpace),{vertical:"",size:"large"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[u.createTextVNode("æ¸²æŸ“åç«¯ï¼š"+u.toDisplayString(u.unref(c)),1)]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...a[3]||(a[3]=[u.createTextVNode("ç¢°æ’",-1)])]),_:1}),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(l),"onUpdate:value":a[0]||(a[0]=e=>u.isRef(l)?l.value=e:null)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[4]||(a[4]=[u.createTextVNode("å¯ç”¨ç¢°æ’",-1)])]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace)),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(r),"onUpdate:value":a[1]||(a[1]=e=>u.isRef(r)?r.value=e:null)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[5]||(a[5]=[u.createTextVNode("æ˜¾ç¤ºç¢°æ’ç®±",-1)])]),_:1})]),_:1})]),_:1}),u.createVNode(u.unref(n.NSpace),{vertical:"",size:"small"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NText),{depth:"2",style:{"font-size":"12px"}},{default:u.withCtx(()=>[...a[6]||(a[6]=[u.createTextVNode("æ€§èƒ½ç»Ÿè®¡",-1)])]),_:1}),u.createVNode(u.unref(n.NSpace),{align:"center"},{default:u.withCtx(()=>[u.createVNode(u.unref(n.NSwitch),{value:u.unref(t).statsVisible,"onUpdate:value":a[2]||(a[2]=e=>u.unref(t).statsVisible=e)},null,8,["value"]),u.createVNode(u.unref(n.NText),null,{default:u.withCtx(()=>[...a[7]||(a[7]=[u.createTextVNode("æ˜¾ç¤º Stats",-1)])]),_:1})]),_:1})]),_:1})]),_:1}));}});},"23b6b720":function t(t,e,i,s){t._m(e),t.o(e,"ThirdPersonCamera",()=>o);var h=i("09efd1d2"),a=t.w(i("3b16918b"));class o{setTarget(t){this.target=t,this.syncWithCamera();}setCollider(t){this.collider=t;}syncWithCamera(){if(this.target){var t=new a.Vector3().subVectors(this.camera.position,this.target.position);this.radius=t.length(),this.currentRadius=this.radius,this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(a.MathUtils.clamp(t.y/this.radius,-1,1)),this.targetTheta=this.theta,this.targetPhi=this.phi;}}onMouseMove(t){this.isLocked&&(this.targetTheta-=t.movementX*this.sensitivity,this.targetPhi-=t.movementY*this.sensitivity,this.targetPhi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.targetPhi)));}onMouseWheel(t){this.isLocked&&(this.radius+=.005*t.deltaY,this.radius=Math.max(2,Math.min(20,this.radius)));}update(t){if(this.target){var e=1-Math.exp(-5*t),i=this.targetTheta-this.theta;this.theta+=i*e,this.phi+=(this.targetPhi-this.phi)*e;var s=this.target.position.clone().add(this.targetOffset),h=this.radius;if(this.collider){var o=new a.Vector3(0);o.setFromSphericalCoords(1,this.phi,this.theta).normalize();var r=new a.Raycaster(s,o);r.far=this.radius,r.firstHitOnly=!0;var n=r.intersectObject(this.collider,!0);n.length>0&&(h=Math.max(.2,n[0].distance-.2));}var d=-100*(this.currentRadius-h)-20*this.radiusVelocity;this.radiusVelocity+=d*t,this.currentRadius+=this.radiusVelocity*t,this.camera.position.setFromSphericalCoords(this.currentRadius,this.phi,this.theta).add(s),this.camera.lookAt(s);}}setDomElement(t){this.domElement=t;}setLocked(t){this.isLocked=t;}onPointerLockChange(){this.isLocked=document.pointerLockElement===this.domElement;}dispose(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("pointerlockchange",this.onPointerLockChange),document.removeEventListener("wheel",this.onMouseWheel);}constructor(t,e){h._(this,"camera",void 0),h._(this,"domElement",void 0),h._(this,"target",null),h._(this,"theta",0),h._(this,"phi",Math.PI/2),h._(this,"radius",3),h._(this,"currentRadius",3),h._(this,"radiusVelocity",0),h._(this,"collider",null),h._(this,"targetTheta",0),h._(this,"targetPhi",Math.PI/2),h._(this,"minPolarAngle",.1),h._(this,"maxPolarAngle",Math.PI-.1),h._(this,"targetOffset",new a.Vector3(0,1.5,0)),h._(this,"isLocked",!1),h._(this,"sensitivity",.002),this.camera=t,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("pointerlockchange",this.onPointerLockChange),document.addEventListener("wheel",this.onMouseWheel);}}},"26d7988f":function e(e,n,t,i){e._m(n),e.o(n,"Viewer",()=>o);var r=t("09efd1d2");t("b25dd2f8"),t("7bccf4aa"),t("2d08c2e5"),t("a3876e70");var d=e.w(t("3b16918b")),a=e.i(t("1498cb29"));class o{_createRenderer(e){var n=window.innerWidth,t=window.innerHeight,i=new d.WebGPURenderer({antialias:e});return i.shadowMap.enabled=!0,i.shadowMap.type=d.PCFSoftShadowMap,i.outputColorSpace=d.SRGBColorSpace,i.toneMapping=d.ACESFilmicToneMapping,i.toneMappingExposure=1,i.setPixelRatio(Math.min(window.devicePixelRatio,2)),i.setSize(n,t),i;}async recreateRenderer(e){var n=this.renderer,t=this._createRenderer(e);await t.init(),n.domElement.parentElement?n.domElement.parentElement.replaceChild(t.domElement,n.domElement):document.body.appendChild(t.domElement),n.dispose(),this.renderer=t,this._onRendererChange.forEach(e=>e(t));}onRendererChange(e){return this._onRendererChange.add(e),()=>this._onRendererChange.delete(e);}async init(){await this.renderer.init();}dispose(){var e,n;this.renderer.dispose(),null===(e=this.renderer.domElement.parentElement)||void 0===e||e.removeChild(this.renderer.domElement),null===(n=this.stats.dom.parentElement)||void 0===n||n.removeChild(this.stats.dom);}setStatsVisible(e){this.stats.dom.style.display=e?"block":"none";}constructor(){r._(this,"camera",void 0),r._(this,"stats",void 0),r._(this,"renderer",void 0),r._(this,"_onRendererChange",new Set);var n=window.innerWidth,t=window.innerHeight;this.camera=new d.PerspectiveCamera(45,n/t,.1,3e3),this.camera.position.set(1,1,1),this.renderer=this._createRenderer(!0),document.body.appendChild(this.renderer.domElement),this.stats=new(e.f(a)),document.body.appendChild(this.stats.dom),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();});}}var s=new o;n.default=s;},"3eec3e47":function e(e,s,t,o){e._m(s),e.o(s,"InputManager",()=>u);var n=t("09efd1d2");t("2d08c2e5"),t("a3876e70"),t("7bccf4aa");var i=e.w(t("3b16918b"));class u{static getInstance(){return u.instance||(u.instance=new u),u.instance;}bindEvents(){window.addEventListener("keydown",e=>this.onKeyDown(e)),window.addEventListener("keyup",e=>this.onKeyUp(e)),window.addEventListener("mousedown",e=>this.onMouseDown(e)),window.addEventListener("mouseup",e=>this.onMouseUp(e)),window.addEventListener("mousemove",e=>this.onMouseMove(e)),window.addEventListener("wheel",e=>this.onWheel(e),{passive:!0});}onKeyDown(e){this.keys.has(e.code)||this.keysDown.add(e.code),this.keys.add(e.code);}onKeyUp(e){this.keys.delete(e.code);}onMouseDown(e){this.mouseButtons.has(e.button)||this.mouseButtonsDown.add(e.button),this.mouseButtons.add(e.button);}onMouseUp(e){this.mouseButtons.delete(e.button);}onMouseMove(e){this.mousePosition.set(e.clientX,e.clientY),this.mouseDelta.x+=e.movementX,this.mouseDelta.y+=e.movementY;}onWheel(e){this.mouseWheelDelta+=e.deltaY;}isKeyPressed(e){return this.keys.has(e);}isKeyDown(e){return this.keysDown.has(e);}isMouseButtonPressed(e){return this.mouseButtons.has(e);}isMouseButtonDown(e){return this.mouseButtonsDown.has(e);}getMovementInput(){var e=(this.isKeyPressed("KeyD")||this.isKeyPressed("ArrowRight")?1:0)-(this.isKeyPressed("KeyA")||this.isKeyPressed("ArrowLeft")?1:0),s=(this.isKeyPressed("KeyW")||this.isKeyPressed("ArrowUp")?1:0)-(this.isKeyPressed("KeyS")||this.isKeyPressed("ArrowDown")?1:0);return new i.Vector3(e,0,s);}update(){this.keysDown.clear(),this.mouseButtonsDown.clear(),this.mouseDelta.set(0,0),this.mouseWheelDelta=0;}constructor(){n._(this,"keys",new Set),n._(this,"keysDown",new Set),n._(this,"mouseButtons",new Set),n._(this,"mouseButtonsDown",new Set),n._(this,"mousePosition",new i.Vector2),n._(this,"mouseDelta",new i.Vector2),n._(this,"mouseWheelDelta",0),this.bindEvents();}}n._(u,"instance",void 0);},"47a20e72":function t(t,o,s,e){t._m(o),t.o(o,"OrbitController",()=>l);var n=s("09efd1d2"),r=s("1500a9c9");class l{setupControls(){this.controls.enabled=!1,this.controls.enableDamping=!0,this.controls.dampingFactor=.08,this.controls.rotateSpeed=.35,this.controls.target.set(0,0,0),this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI,this.controls.enablePan=!0;}setDomElement(t){var o=this.controls.enabled,s=this.controls.target.clone();this.controls.dispose(),this.controls=new r.OrbitControls(this.camera,t),this.setupControls(),this.controls.target.copy(s),this.controls.enabled=o;}enter(){this.controls.enabled=!0;}leave(){this.controls.enabled=!1;}update(t){this.controls.update(t);}dispose(){this.controls.dispose();}setTarget(t){this.controls.target.copy(t);}constructor(t,o){n._(this,"controls",void 0),n._(this,"camera",void 0),this.camera=t,this.controls=new r.OrbitControls(t,o),this.setupControls();}}},"5c886761":function f(f,a,e,i){f._m(a);var n=f.i(e("f49f4847")),t=e("f49f4847");f._e(a,t),a.default=f.f(n);},"7475699d":function s(s,e,t,a){s._m(e),s.o(e,"PostProcessing",()=>P);var o=t("09efd1d2"),i=s.w(t("3b16918b")),r=t("16fd0772"),n=t("3c3302b1"),c=t("9faa30b5");class P{update(s){this.aoPass&&(this.aoPass.samples.value=s.samples,this.aoPass.distanceExponent.value=s.distanceExponent,this.aoPass.distanceFallOff.value=s.distanceFallOff,this.aoPass.radius.value=s.radius,this.aoPass.scale.value=s.scale,this.aoPass.thickness.value=s.thickness,s.enabled&&(s.aoOnly?this.postProcessing.outputNode=r.vec4(r.vec3(this.aoPass.r),1):this.postProcessing.outputNode=this.traaPass),this.postProcessing.needsUpdate=!0);}render(){this.postProcessing.render();}constructor(s,e,t){o._(this,"postProcessing",void 0),o._(this,"aoPass",void 0),o._(this,"traaPass",void 0),o._(this,"scenePass",void 0),this.postProcessing=new i.PostProcessing(s);var a=r.pass(e,t);a.setMRT(r.mrt({output:r.directionToColor(r.normalView),velocity:r.velocity}));var P=r.sample(s=>r.colorToDirection(a.getTextureNode().sample(s))),h=a.getTextureNode("depth"),l=a.getTextureNode("velocity");this.scenePass=r.pass(e,t),this.aoPass=n.ao(h,P,t),this.aoPass.resolutionScale=.5,this.aoPass.useTemporalFiltering=!0;var d=this.aoPass.getTextureNode();this.scenePass.contextNode=r.builtinAOContext(d.sample(r.screenUV).r),this.traaPass=c.traa(this.scenePass,h,l,t),this.traaPass.useSubpixelCorrection=!1,this.postProcessing.outputNode=this.traaPass;}}},"76d74377":function c(c,f,a,b){c._m(f);var e=c.i(a("4735cb57")),i=a("4735cb57");c._e(f,i),f.default=c.f(e);},"7cdc7ff0":function f(f,a,c,d){f._m(a);var e=f.i(c("f194c96a")),_=f.i(c("ddc00f4e")),i=c("f194c96a");f._e(a,i),a.default=f.f(_)(f.f(e),[["__scopeId","data-v-f7f46c31"]]);},"7d33ac30":function c(c,f,a,i){c._m(f);var n=c.i(a("89380c7c"));f.default=c.f(n);},"89380c7c":function e(e,a,n,t){e._m(a);var f=n("9aaf3498"),o=n("9aaf3498"),l=e.i(n("8eb479d3"));a.default=f.defineComponent({__name:"App",setup:a=>(a,n)=>(o.openBlock(),o.createBlock(o.Suspense,null,{default:o.withCtx(()=>[o.createVNode(e.f(l))]),_:1}))});},"8eb479d3":function c(c,a,d,f){c._m(a);var e=c.i(d("cca86db6")),_=c.i(d("ddc00f4e")),b=d("cca86db6");c._e(a,b),a.default=c.f(_)(c.f(e),[["__scopeId","data-v-5b88c8fa"]]);},"8f363abd":function t(t,i,s,h){t._m(i),t.o(i,"LightManager",()=>o);var a=s("09efd1d2"),e=t.w(s("3b16918b"));class o{initLights(){this.sunLight=new e.DirectionalLight(16777215,5),this.sunLight.position.set(5,10,-10),this.sunLight.castShadow=!0,this.sunLight.shadow.bias=-.0001,this.sunLight.shadow.normalBias=.05,this.sunLight.shadow.camera.near=.5,this.sunLight.shadow.camera.far=50,this.sunLight.shadow.camera.left=-20,this.sunLight.shadow.camera.right=20,this.sunLight.shadow.camera.top=20,this.sunLight.shadow.camera.bottom=-20,this.sunLight.shadow.mapSize.width=1024,this.sunLight.shadow.mapSize.height=1024,this.scene.add(this.sunLight),this.cameraHelper=new e.CameraHelper(this.sunLight.shadow.camera),this.scene.add(this.cameraHelper),this.cameraHelper.update(),this.ambientLight=new e.AmbientLight(16777215,1),this.scene.add(this.ambientLight),this.spotLight=new e.SpotLight(16777215,1),this.spotLight.castShadow=!0,this.spotLight.shadow.bias=-.0001,this.spotLight.shadow.normalBias=.05,this.spotLight.angle=Math.PI/6,this.spotLight.penumbra=.3,this.spotLight.decay=1,this.spotLight.distance=1e3,this.camera.add(this.spotLight),this.spotLight.position.set(0,0,0),this.spotLight.target.position.set(0,0,-1),this.camera.add(this.spotLight.target);}updateSunLight(t,i,s,h){this.sunLight.visible=t,this.sunLight.color.set(i),this.sunLight.intensity=s,this.sunLight.position.set(h.x,h.y,h.z),this.cameraHelper.update();}updateAmbientLight(t,i,s){this.ambientLight.visible=t,this.ambientLight.color.set(i),this.ambientLight.intensity=s;}updateSpotLight(t,i,s,h,a,e,o){this.spotLight.visible=t,this.spotLight.color.set(i),this.spotLight.intensity=s,this.spotLight.angle=h*Math.PI/180,this.spotLight.penumbra=a,this.spotLight.decay=e,this.spotLight.distance=o;}constructor(t,i){a._(this,"scene",void 0),a._(this,"camera",void 0),a._(this,"sunLight",void 0),a._(this,"ambientLight",void 0),a._(this,"spotLight",void 0),a._(this,"cameraHelper",void 0),this.scene=t,this.camera=i,this.initLights();}}},"8fd7a7b3":function c(c,f,a,e){c._m(f);var i=c.i(a("21929cc9")),n=a("21929cc9");c._e(f,n),f.default=c.f(i);},"93e7dcc4":function f(f,d,a,c){f._m(d);var e=f.i(a("ff9d919c")),_=f.i(a("ddc00f4e")),i=a("ff9d919c");f._e(d,i),d.default=f.f(_)(f.f(e),[["__scopeId","data-v-13d72a26"]]);},"953dfae2":function a(a,e,c,i){a._m(e);var n=c("9aaf3498"),p=c("0e70da6a"),t=a.i(c("7d33ac30")),f=n.createApp(a.f(t)),r=p.createPinia();f.use(r),f.mount("#app");},"96554b2f":function t(t,i,o,n){t._m(i),t.o(i,"Door",()=>s),t.o(i,"DoorManager",()=>c),t.o(i,"doorManager",()=>h);var e=o("09efd1d2");o("c550eeaa"),o("2d08c2e5"),o("a3876e70");var a=t.w(o("3b16918b")),r=o("f247f526");class s{get isAnimating(){return!!this.action&&this.action.isRunning();}interact(){this.action&&(this.isOpen=!this.isOpen,this.action.paused=!1,this.isOpen?this.action.timeScale=1:this.action.timeScale=-1,this.action.play());}getDistance(t){return this.object.getWorldPosition(this.worldPosition),this.worldPosition.distanceTo(t);}constructor(t,i,o){e._(this,"object",void 0),e._(this,"isOpen",!1),e._(this,"mixer",void 0),e._(this,"action",null),e._(this,"box",void 0),e._(this,"worldPosition",new a.Vector3),this.object=t,this.box=new a.Box3().setFromObject(t),this.mixer=o;var n=t.name+"Open",r=i.find(t=>t.name===n);r?(this.action=this.mixer.clipAction(r),this.action.loop=a.LoopOnce,this.action.clampWhenFinished=!0):console.warn("Animation ".concat(n," not found for door ").concat(t.name));}}class c{addDoor(t,i,o){if(!this.doors.find(i=>i.object===t)){var n=new s(t,i,o);this.doors.push(n);}}update(t){var i=null,o=1/0,n=!0,e=!1,a=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value,l=h.getDistance(t);l<this.interactionDistance&&l<o&&(o=l,i=h);}}catch(t){e=!0,a=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw a;}}var x=r.useSceneStore();i?(this.activeDoor=i,x.showInteractionPrompt=!0,x.interactionText=i.isOpen?"æŒ‰ F å…³é—¨":"æŒ‰ F å¼€é—¨"):(this.activeDoor=null,x.showInteractionPrompt=!1);}interact(){this.activeDoor&&this.activeDoor.interact();}checkCollision(t,i,o){var n=!0,e=!1,r=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value;if(!h.isOpen&&!h.isAnimating){h.box.setFromObject(h.object);var l=new a.Box3,x=t.clone().add(o);if(l.min.set(x.x-i,x.y,x.z-i),l.max.set(x.x+i,x.y+2,x.z+i),h.box.intersectsBox(l)){var d=h.box.clone().intersect(l),m=d.max.x-d.min.x,v=d.max.z-d.min.z;m<v?x.x<h.box.min.x+(h.box.max.x-h.box.min.x)/2?o.x-=m:o.x+=m:x.z<h.box.min.z+(h.box.max.z-h.box.min.z)/2?o.z-=v:o.z+=v;}}}}catch(t){e=!0,r=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw r;}}}constructor(){e._(this,"doors",[]),e._(this,"interactionDistance",2),e._(this,"activeDoor",null);}}var h=new c;},"99602713":function p(p,g,o,e){p._m(g),p.o(g,"ASSETS",()=>j);var j={models:{home:"models/home.glb",char:"models/char.glb"},textures:{skybox:["xp.jpg","xn.jpg","yp.jpg","yn.jpg","zp.jpg","zn.jpg"]}};},"ae1ac647":function e(e,a,c,d){e._m(a);var f=e.i(c("7c3ee4ab")),_=e.i(c("ddc00f4e")),i=c("7c3ee4ab");e._e(a,i),a.default=e.f(_)(e.f(f),[["__scopeId","data-v-e9a38472"]]);},"b1f59e44":function e(e,a,t,r){e._m(a),t("2d08c2e5"),t("a3876e70");var d=t("9aaf3498"),n=t("9aaf3498"),f=t("1f6a8afd"),c=t("0e70da6a"),i=t("f247f526"),o=e.i(t("ae1ac647")),u=e.i(t("5c886761")),l=e.i(t("f7acc5ff")),N=e.i(t("76d74377")),s=e.i(t("8fd7a7b3"));a.default=d.defineComponent({__name:"ControlPanel",setup(a){var t=i.useSceneStore(),r=c.storeToRefs(t).isDarkMode;return(a,t)=>(n.openBlock(),n.createBlock(n.unref(f.NCard),{class:"param-panel",bordered:!1,size:"small"},{header:n.withCtx(()=>[n.createVNode(n.unref(f.NSpace),{align:"center",justify:"space-between",style:{margin:"0",width:"100%"}},{default:n.withCtx(()=>[n.createVNode(n.unref(f.NText),{strong:""},{default:n.withCtx(()=>[...t[1]||(t[1]=[n.createTextVNode("æ§åˆ¶é¢æ¿",-1)])]),_:1}),n.createVNode(n.unref(f.NSwitch),{value:n.unref(r),"onUpdate:value":t[0]||(t[0]=e=>n.isRef(r)?r.value=e:null),size:"small"},{checked:n.withCtx(()=>[...t[2]||(t[2]=[n.createTextVNode("ğŸŒ™",-1)])]),unchecked:n.withCtx(()=>[...t[3]||(t[3]=[n.createTextVNode("â˜€ï¸",-1)])]),_:1},8,["value"])]),_:1})]),default:n.withCtx(()=>[n.createVNode(n.unref(f.NTabs),{type:"line",animated:""},{default:n.withCtx(()=>[n.createVNode(n.unref(f.NTabPane),{name:"movement",tab:"æ¼«æ¸¸"},{default:n.withCtx(()=>[n.createVNode(e.f(u))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"lighting",tab:"å…‰ç…§"},{default:n.withCtx(()=>[n.createVNode(e.f(l))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"postprocess",tab:"åæœŸ"},{default:n.withCtx(()=>[n.createVNode(e.f(N))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"debug",tab:"è°ƒè¯•"},{default:n.withCtx(()=>[n.createVNode(e.f(s))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"hierarchy",tab:"å±‚çº§","display-directive":"show"},{default:n.withCtx(()=>[n.createVNode(e.f(o))]),_:1})]),_:1})]),_:1}));}});},"b7044e63":function e(e,t,u,a){e._m(t);var l=u("15edfc35"),n=u("94a74ea6");u("2d08c2e5"),u("a3876e70");var r=u("9aaf3498"),o=u("9aaf3498"),d=u("9aaf3498"),i=u("1f6a8afd");t.default=r.defineComponent({__name:"Vector3Input",props:{value:{required:!0},valueModifiers:{},editing:{type:Boolean},editingModifiers:{}},emits:["update:value","update:editing"],setup(e){var t=r.useModel(e,"value"),u=r.useModel(e,"editing"),a=()=>u.value=!0,f=()=>u.value=!1,s=e=>d.computed({get:()=>t.value[e],set:u=>{null!==u&&(t.value=n._(l._({},t.value),{[e]:u}));}}),c=s("x"),N=s("y"),v=s("z");return(e,t)=>(o.openBlock(),o.createBlock(o.unref(i.NGrid),{cols:3,"x-gap":8},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[3]||(t[3]=[o.createTextVNode("X",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(c),"onUpdate:value":t[0]||(t[0]=e=>o.isRef(c)?c.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1}),o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[4]||(t[4]=[o.createTextVNode("Y",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(N),"onUpdate:value":t[1]||(t[1]=e=>o.isRef(N)?N.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1}),o.createVNode(o.unref(i.NGi),null,{default:o.withCtx(()=>[o.createVNode(o.unref(i.NSpace),{vertical:"",size:"small"},{default:o.withCtx(()=>[o.createVNode(o.unref(i.NText),{depth:"3",style:{"font-size":"11px"}},{default:o.withCtx(()=>[...t[5]||(t[5]=[o.createTextVNode("Z",-1)])]),_:1}),o.createVNode(o.unref(i.NInputNumber),{value:o.unref(v),"onUpdate:value":t[2]||(t[2]=e=>o.isRef(v)?v.value=e:null),size:"small","show-button":!1,onFocus:a,onBlur:f},null,8,["value"])]),_:1})]),_:1})]),_:1}));}});},"c2079dd8":function e(e,i,r,l){e._m(i),e.o(i,"ColliderManager",()=>a),e.o(i,"colliderManager",()=>d);var s=r("09efd1d2");r("40616381");var t=e.w(r("3b16918b")),o=e.w(r("ef066f7a"));class a{generateCollider(e,i,r){this.dispose(),this.scene=i;var l=[];if(e.traverse(e=>{if(e.isMesh){for(var i=e.geometry.clone(),r=!1,s=e.parent;s;){if("Door"===s.name){r=!0;break;}s=s.parent;}if(!(r||e.name.endsWith("Glass"))){for(var t in i.applyMatrix4(e.matrixWorld),i.attributes)"position"!==t&&i.deleteAttribute(t);l.push(i);}}}),l.length>0){var s=o.mergeGeometries(l);s.computeBoundsTree(),this.collider=new t.Mesh(s,new t.MeshBasicMaterial({wireframe:!0,color:16711680})),this.collider.visible=!1,this.collider.name="collider",this.scene.add(this.collider),r(this.collider);}}setVisibility(e){this.collider&&(this.collider.visible=e);}dispose(){this.collider&&(this.scene&&this.scene.remove(this.collider),this.collider.geometry.dispose(),Array.isArray(this.collider.material)?this.collider.material.forEach(e=>e.dispose()):this.collider.material.dispose(),this.collider=null);}constructor(){s._(this,"collider",null),s._(this,"scene",null);}}var d=new a;},"c879eb01":function e(e,f,a,b){e._m(f);var i=e.i(a("b7044e63")),n=a("b7044e63");e._e(f,n),f.default=e.f(i);},"cca86db6":function e(e,n,o,t){e._m(n);var r=o("493f9ad4");o("b25dd2f8");var a=o("9aaf3498"),i=o("9aaf3498"),d=o("9aaf3498"),c=e.i(o("67dbd159")),l=e.i(o("26d7988f")),f=o("1f6a8afd"),u=o("0e70da6a"),s=o("f247f526"),m=e.i(o("7cdc7ff0")),v=e.i(o("93e7dcc4")),p=e.i(o("d0f5b517")),k=e.i(o("0c69ee6e")),g=o("71200ed9"),h={class:"ui-layer"},y={key:0,class:"interaction-prompt"};n.default=a.defineComponent({__name:"Viewer",async setup(n){var o,t,V,E=s.useSceneStore(),L=u.storeToRefs(E),N=L.isLoading,P=L.loadingProgress,w=L.isDarkMode,b=L.movementMode,B=L.showInteractionPrompt,C=L.interactionText;o=(V=r._(a.withAsyncContext(()=>e.f(c).init()),2))[0],t=V[1],await o,t(),g.useViewerSync();var _=d.computed(()=>w.value?f.darkTheme:null),S=d.ref(!1),x=()=>{("fly"===b.value||"thirdPerson"===b.value)&&e.f(c).lockPointer();},M=d.computed(()=>("fly"===b.value||"thirdPerson"===b.value)&&!S.value),T=()=>{S.value=document.pointerLockElement===e.f(l).renderer.domElement;};return d.onMounted(()=>{document.addEventListener("pointerlockchange",T);}),d.onBeforeUnmount(()=>{document.removeEventListener("pointerlockchange",T);}),(n,o)=>(i.openBlock(),i.createBlock(i.unref(f.NConfigProvider),{theme:_.value},{default:i.withCtx(()=>[i.createVNode(e.f(m),{isLoading:i.unref(N),progress:i.unref(P)},null,8,["isLoading","progress"]),i.createElementVNode("div",h,[i.createVNode(e.f(v),{visible:M.value,mode:i.unref(b),onEnterPointerLock:x},null,8,["visible","mode"]),i.createVNode(e.f(k)),i.unref(B)?(i.openBlock(),i.createElementBlock("div",y,i.toDisplayString(i.unref(C)),1)):i.createCommentVNode("",!0),i.createVNode(e.f(p))])]),_:1},8,["theme"]));}});},"d0f5b517":function f(f,e,a,d){f._m(e);var c=f.i(a("b1f59e44")),_=f.i(a("ddc00f4e")),i=a("b1f59e44");f._e(e,i),e.default=f.f(_)(f.f(c),[["__scopeId","data-v-fc9a7620"]]);},"ddc00f4e":function r(r,a,t,e){r._m(a);var n=t("493f9ad4");t("c550eeaa"),t("2d08c2e5"),t("a3876e70"),a.default=(r,a)=>{var t=r.__vccOpts||r,e=!0,l=!1,c=void 0;try{for(var f,o=a[Symbol.iterator]();!(e=(f=o.next()).done);e=!0){var u=n._(f.value,2),v=u[0],i=u[1];t[v]=i;}}catch(r){l=!0,c=r;}finally{try{e||null==o.return||o.return();}finally{if(l)throw c;}}return t;};},"e00be090":function e(e,d,o,r){e._m(d),e.o(d,"ModelLoader",()=>h);var a=o("09efd1d2");o("b25dd2f8");var t=o("ca576447"),s=o("4ecad5d1"),i=o("44079c7b"),L=o("fb22d209");class h{loadGLTF(e,d){return new Promise((o,r)=>{this.gltfLoader.load(e,e=>{o(e);},d,e=>{r(e);});});}loadFBX(e,d){return new Promise((o,r)=>{this.fbxLoader.load(e,e=>{o(e);},d,e=>{r(e);});});}dispose(){this.dracoLoader.dispose(),this.ktx2Loader.dispose();}updateRenderer(e){this.ktx2Loader.detectSupport(e);}constructor(e){a._(this,"gltfLoader",void 0),a._(this,"fbxLoader",void 0),a._(this,"dracoLoader",void 0),a._(this,"ktx2Loader",void 0),this.gltfLoader=new t.GLTFLoader,this.fbxLoader=new s.FBXLoader,this.dracoLoader=new i.DRACOLoader,this.dracoLoader.setDecoderPath("draco/"),this.dracoLoader.setDecoderConfig({type:"wasm"}),this.dracoLoader.preload(),this.gltfLoader.setDRACOLoader(this.dracoLoader),!1===e.initialized&&console.warn("ModelLoader çš„ KTX2Loader åˆå§‹åŒ–éœ€è¦åœ¨ renderer åˆå§‹åŒ–ä¹‹åè¿›è¡Œã€‚\n å¦‚æœçœ‹åˆ°è¿™æ¡è­¦å‘Šï¼Œå¯èƒ½ ModelLoader å®ä¾‹åŒ–å¤ªæ—©äº†ã€‚"),this.ktx2Loader=new L.KTX2Loader,this.ktx2Loader.setTranscoderPath("basis/"),this.ktx2Loader.detectSupport(e),this.gltfLoader.setKTX2Loader(this.ktx2Loader);}}},"e0c628a7":function i(i,t,e,s){i._m(t),i.o(t,"Character",()=>r);var n=e("09efd1d2");e("b25dd2f8");var a=i.w(e("3b16918b"));class r{setupMeshProperties(i){i.traverse(i=>{if(i.isMesh){i.castShadow=!0,i.receiveShadow=!0;var t=i.material;i.material=new a.MeshStandardMaterial({color:t.color,map:t.map,roughness:.8,metalness:.1});}});}async load(i,t,e){var s=await i.loadGLTF(t,i=>e&&e(i)),n=s.scene;n.scale.set(.45,.45,.45),n.position.set(0,.1,0),this.setupMeshProperties(n),this.mixer=new a.AnimationMixer(n),this.idleAction=this.mixer.clipAction(s.animations[0]),this.idleAction.play(),this.currentAction=this.idleAction,this.mesh=n,this.walkAction=this.mixer.clipAction(s.animations[1]);}update(i){this.mixer&&this.mixer.update(i),this.updateAnimation();}updateAnimation(){if(this.idleAction&&this.walkAction){var i=this.velocity.length()>1?this.walkAction:this.idleAction;this.currentAction!==i&&(this.currentAction&&this.currentAction.fadeOut(.2),i.reset().fadeIn(.2).play(),this.currentAction=i);}}constructor(){n._(this,"mesh",null),n._(this,"velocity",new a.Vector3),n._(this,"mixer",null),n._(this,"idleAction",null),n._(this,"walkAction",null),n._(this,"currentAction",null);}}},"e9ef43b1":function t(t,o,s,n){t._m(o),t.o(o,"TopViewController",()=>a);var e=s("09efd1d2"),i=t.w(s("3b16918b")),r=s("1500a9c9");class a{setupControls(){this.controls.target.set(0,0,0),this.controls.enabled=!1,this.controls.enableDamping=!0,this.controls.dampingFactor=.08,this.controls.rotateSpeed=.35,this.controls.minPolarAngle=0,this.controls.maxPolarAngle=.1,this.controls.enablePan=!0,this.controls.screenSpacePanning=!0;}setDomElement(t){var o=this.controls.enabled,s=this.controls.target.clone();this.controls.dispose(),this.controls=new r.OrbitControls(this.camera,t),this.setupControls(),this.controls.target.copy(s),this.controls.enabled=o;}enter(){this.controls.enabled=!0,this.animateToTopView();}leave(){this.controls.enabled=!1,this.isAnimating=!1;}update(t){this.isAnimating||this.controls.update(t);}dispose(){this.controls.dispose();}animateToTopView(){this.isAnimating=!0;var t=this.camera.position.clone(),o=new i.Vector3;this.camera.getWorldDirection(o).normalize();var s=t.clone().add(o),n=new i.Vector3(o.x,0,o.z),e=new i.Vector3(0,20,0),r=performance.now();this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI;var a=()=>{if(this.controls.enabled){var o=Math.min((performance.now()-r)/1e3,1),i=3*Math.pow(o,2)-2*Math.pow(o,3);this.camera.position.lerpVectors(t,e,i),this.controls.target.lerpVectors(s,n,i),this.camera.lookAt(this.controls.target),o<1?requestAnimationFrame(a):(this.isAnimating=!1,this.controls.minPolarAngle=0,this.controls.maxPolarAngle=.1);}};a();}constructor(t,o){e._(this,"camera",void 0),e._(this,"controls",void 0),e._(this,"isAnimating",!1),this.camera=t,this.controls=new r.OrbitControls(t,o),this.setupControls();}}},"f194c96a":function e(e,a,t,o){e._m(a),t("2d08c2e5"),t("a3876e70");var n=t("9aaf3498"),r=t("9aaf3498"),i=t("1f6a8afd"),d={key:0,class:"loading-overlay"},l={class:"loading-content"};a.default=n.defineComponent({__name:"LoadingOverlay",props:{isLoading:{type:Boolean},progress:{}},setup:e=>(a,t)=>(r.openBlock(),r.createBlock(r.Transition,{name:"fade"},{default:r.withCtx(()=>[e.isLoading?(r.openBlock(),r.createElementBlock("div",d,[r.createElementVNode("div",l,[r.createVNode(r.unref(i.NSpin),{size:"large"}),r.createVNode(r.unref(i.NText),{class:"loading-text"},{default:r.withCtx(()=>[...t[0]||(t[0]=[r.createTextVNode("æ¨¡å‹åŠ è½½ä¸­...",-1)])]),_:1}),r.createVNode(r.unref(i.NProgress),{type:"line",percentage:e.progress,"show-indicator":!0,height:8,"border-radius":4,"indicator-placement":"outside",style:{width:"280px","margin-top":"16px"}},null,8,["percentage"])])])):r.createCommentVNode("",!0)]),_:1}))});},"f4cd7510":function e(e,t,o,s){e._m(t),e.o(t,"InfiniteGrid",()=>r);var a=e.w(o("3b16918b")),i=o("16fd0772");class r extends a.Mesh{constructor(){var e=new a.PlaneGeometry(1,1),t=new a.MeshStandardNodeMaterial({side:a.DoubleSide}),o=i.Fn(()=>{var e=i.positionWorld.xz,t=i.positionWorld.distance(i.cameraPosition),o=i.smoothstep(1e3,200,t),s=i.float(10),a=i.float(100),r=e.div(s).fract().sub(.5).abs().mul(2),m=i.smoothstep(.95,1,r.x).max(i.smoothstep(.95,1,r.y)),l=e.div(a).fract().sub(.5).abs().mul(2),n=i.smoothstep(.98,1,l.x).max(i.smoothstep(.98,1,l.y)),d=i.vec3(.6),u=i.vec3(.2),c=i.mix(m.mul(.2),n.mul(.5),n);return i.mix(u,d,c.mul(o));});t.colorNode=o(),super(e,t),this.scale.set(4e3,4e3,1),this.rotation.x=-Math.PI/2,this.frustumCulled=!1,this.receiveShadow=!0;}}},"f7acc5ff":function f(f,d,a,b){f._m(d);var e=f.i(a("61fbd776")),i=a("61fbd776");f._e(d,i),d.default=f.f(e);},"ff9d919c":function e(e,t,o,r){e._m(t),o("2d08c2e5"),o("a3876e70");var a=o("9aaf3498"),c=o("9aaf3498"),d=o("1f6a8afd"),n=o("9aaf3498");t.default=a.defineComponent({__name:"PointerLockPrompt",props:{visible:{type:Boolean},mode:{}},emits:["enterPointerLock"],setup(e,t){var o=t.emit,r=n.computed(()=>"fly"===e.mode?"è‡ªç”±é£è¡Œè§†è§’":"ç¬¬ä¸‰äººç§°è§†è§’");return(t,a)=>c.withDirectives((c.openBlock(),c.createBlock(c.unref(d.NCard),{class:"controls-overlay",bordered:!1,size:"small",title:r.value},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NText),{depth:"3"},{default:c.withCtx(()=>["fly"===e.mode?(c.openBlock(),c.createElementBlock(c.Fragment,{key:0},[a[4]||(a[4]=c.createTextVNode(" ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥é”å®šé¼ æ ‡ï¼Œä½¿ç”¨ ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[1]||(a[1]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[5]||(a[5]=c.createTextVNode(" ç§»åŠ¨ï¼Œ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[2]||(a[2]=[c.createTextVNode("ç©ºæ ¼",-1)])]),_:1}),a[6]||(a[6]=c.createTextVNode(" ä¸Šå‡ï¼Œ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[3]||(a[3]=[c.createTextVNode("Shift",-1)])]),_:1}),a[7]||(a[7]=c.createTextVNode(" ä¸‹é™ï¼Œé¼ æ ‡æ—‹è½¬æ–¹å‘ã€‚ ",-1))],64)):(c.openBlock(),c.createElementBlock(c.Fragment,{key:1},[a[9]||(a[9]=c.createTextVNode(" ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥é”å®šé¼ æ ‡ï¼Œä½¿ç”¨ ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[8]||(a[8]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[10]||(a[10]=c.createTextVNode(" ç§»åŠ¨ï¼Œé¼ æ ‡æ—‹è½¬è§†è§’ã€‚ ",-1))],64))]),_:1}),c.createVNode(c.unref(d.NSpace),{vertical:"",style:{"margin-top":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NButton),{type:"primary",onClick:a[0]||(a[0]=e=>o("enterPointerLock")),block:""},{default:c.withCtx(()=>[...a[11]||(a[11]=[c.createTextVNode("å¼€å§‹ä½“éªŒ",-1)])]),_:1}),c.createVNode(c.unref(d.NText),{depth:"3",style:{"font-size":"12px"}},{default:c.withCtx(()=>[a[13]||(a[13]=c.createTextVNode("æŒ‰ ",-1)),c.createVNode(c.unref(d.NText),{code:""},{default:c.withCtx(()=>[...a[12]||(a[12]=[c.createTextVNode("Esc",-1)])]),_:1}),a[14]||(a[14]=c.createTextVNode(" å¯é€€å‡ºé”å®š",-1))]),_:1})]),_:1})]),_:1},8,["title"])),[[c.vShow,e.visible]]);}});},});
//# sourceMappingURL=index_62e3.d639a06e.js.map