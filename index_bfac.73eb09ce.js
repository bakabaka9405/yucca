(function(_){var filename = ((function(){var _documentCurrentScript = typeof document !== "undefined" ? document.currentScript : null;return typeof document === "undefined" ? require("url").pathToFileURL(__filename).href : _documentCurrentScript && _documentCurrentScript.src || new URL("index_bfac.js", document.baseURI).href})());for(var r in _){_[r].__farm_resource_pot__=filename;window['f1d71b9dd14324d7340d3311efaf8136'].__farm_module_system__.register(r,_[r])}})({"26d7988f":function e(e,n,t,i){e._m(n),e.o(n,"Viewer",()=>o);var r=t("09efd1d2");t("b25dd2f8"),t("7bccf4aa"),t("2d08c2e5"),t("a3876e70");var d=e.w(t("3b16918b")),a=e.i(t("1498cb29"));class o{_createRenderer(e){var n=window.innerWidth,t=window.innerHeight,i=new d.WebGPURenderer({antialias:e});return i.shadowMap.enabled=!0,i.shadowMap.type=d.PCFSoftShadowMap,i.outputColorSpace=d.SRGBColorSpace,i.toneMapping=d.ACESFilmicToneMapping,i.toneMappingExposure=1,i.setPixelRatio(window.devicePixelRatio),i.setSize(n,t),i;}async recreateRenderer(e){var n=this.renderer,t=this._createRenderer(e);await t.init(),n.domElement.parentElement?n.domElement.parentElement.replaceChild(t.domElement,n.domElement):document.body.appendChild(t.domElement),n.dispose(),this.renderer=t,this._onRendererChange.forEach(e=>e(t));}onRendererChange(e){return this._onRendererChange.add(e),()=>this._onRendererChange.delete(e);}async init(){await this.renderer.init();}dispose(){var e,n;this.renderer.dispose(),null===(e=this.renderer.domElement.parentElement)||void 0===e||e.removeChild(this.renderer.domElement),null===(n=this.stats.dom.parentElement)||void 0===n||n.removeChild(this.stats.dom);}setStatsVisible(e){this.stats.dom.style.display=e?"block":"none";}constructor(){r._(this,"camera",void 0),r._(this,"stats",void 0),r._(this,"renderer",void 0),r._(this,"_onRendererChange",new Set);var n=window.innerWidth,t=window.innerHeight;this.camera=new d.PerspectiveCamera(45,n/t,.1,3e3),this.camera.position.set(1,1,1),this.renderer=this._createRenderer(!0),document.body.appendChild(this.renderer.domElement),this.stats=new(e.f(a)),document.body.appendChild(this.stats.dom),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();});}}var s=new o;n.default=s;},"47a20e72":function t(t,o,s,e){t._m(o),t.o(o,"OrbitController",()=>l);var n=s("09efd1d2"),r=s("1500a9c9");class l{setupControls(){this.controls.enabled=!1,this.controls.enableDamping=!0,this.controls.dampingFactor=.08,this.controls.rotateSpeed=.35,this.controls.target.set(0,0,0),this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI,this.controls.enablePan=!0;}setDomElement(t){var o=this.controls.enabled,s=this.controls.target.clone();this.controls.dispose(),this.controls=new r.OrbitControls(this.camera,t),this.setupControls(),this.controls.target.copy(s),this.controls.enabled=o;}enter(){this.controls.enabled=!0;}leave(){this.controls.enabled=!1;}update(t){this.controls.update(t);}dispose(){this.controls.dispose();}setTarget(t){this.controls.target.copy(t);}constructor(t,o){n._(this,"controls",void 0),n._(this,"camera",void 0),this.camera=t,this.controls=new r.OrbitControls(t,o),this.setupControls();}}},"5c886761":function f(f,a,e,i){f._m(a);var n=f.i(e("f49f4847")),t=e("f49f4847");f._e(a,t),a.default=f.f(n);},"7475699d":function s(s,e,t,a){s._m(e),s.o(e,"PostProcessing",()=>P);var o=t("09efd1d2"),i=s.w(t("3b16918b")),r=t("16fd0772"),n=t("3c3302b1"),c=t("9faa30b5");class P{update(s){this.aoPass&&(this.aoPass.samples.value=s.samples,this.aoPass.distanceExponent.value=s.distanceExponent,this.aoPass.distanceFallOff.value=s.distanceFallOff,this.aoPass.radius.value=s.radius,this.aoPass.scale.value=s.scale,this.aoPass.thickness.value=s.thickness,s.enabled&&(s.aoOnly?this.postProcessing.outputNode=r.vec4(r.vec3(this.aoPass.r),1):this.postProcessing.outputNode=this.traaPass),this.postProcessing.needsUpdate=!0);}render(){this.postProcessing.render();}constructor(s,e,t){o._(this,"postProcessing",void 0),o._(this,"aoPass",void 0),o._(this,"traaPass",void 0),o._(this,"scenePass",void 0),this.postProcessing=new i.PostProcessing(s);var a=r.pass(e,t);a.setMRT(r.mrt({output:r.directionToColor(r.normalView),velocity:r.velocity}));var P=r.sample(s=>r.colorToDirection(a.getTextureNode().sample(s))),h=a.getTextureNode("depth"),l=a.getTextureNode("velocity");this.scenePass=r.pass(e,t),this.aoPass=n.ao(h,P,t),this.aoPass.resolutionScale=.5,this.aoPass.useTemporalFiltering=!0;var d=this.aoPass.getTextureNode();this.scenePass.contextNode=r.builtinAOContext(d.sample(r.screenUV).r),this.traaPass=c.traa(this.scenePass,h,l,t),this.traaPass.useSubpixelCorrection=!1,this.postProcessing.outputNode=this.traaPass;}}},"76d74377":function c(c,f,a,b){c._m(f);var e=c.i(a("4735cb57")),i=a("4735cb57");c._e(f,i),f.default=c.f(e);},"7cdc7ff0":function f(f,a,c,d){f._m(a);var e=f.i(c("f194c96a")),_=f.i(c("ddc00f4e")),i=c("f194c96a");f._e(a,i),a.default=f.f(_)(f.f(e),[["__scopeId","data-v-f7f46c31"]]);},"7d33ac30":function c(c,f,a,i){c._m(f);var n=c.i(a("89380c7c"));f.default=c.f(n);},"89380c7c":function e(e,a,n,t){e._m(a);var f=n("9aaf3498"),o=n("9aaf3498"),l=e.i(n("8eb479d3"));a.default=f.defineComponent({__name:"App",setup:a=>(a,n)=>(o.openBlock(),o.createBlock(o.Suspense,null,{default:o.withCtx(()=>[o.createVNode(e.f(l))]),_:1}))});},"8eb479d3":function c(c,d,a,f){c._m(d);var e=c.i(a("cca86db6")),_=c.i(a("ddc00f4e")),i=a("cca86db6");c._e(d,i),d.default=c.f(_)(c.f(e),[["__scopeId","data-v-70256964"]]);},"8f363abd":function t(t,i,s,h){t._m(i),t.o(i,"LightManager",()=>o);var a=s("09efd1d2"),e=t.w(s("3b16918b"));class o{initLights(){this.sunLight=new e.DirectionalLight(16777215,5),this.sunLight.position.set(10,20,-20),this.sunLight.castShadow=!0,this.sunLight.shadow.bias=-.0001,this.sunLight.shadow.normalBias=.05,this.sunLight.shadow.camera.near=.5,this.sunLight.shadow.camera.far=50,this.sunLight.shadow.camera.left=-20,this.sunLight.shadow.camera.right=20,this.sunLight.shadow.camera.top=20,this.sunLight.shadow.camera.bottom=-20,this.sunLight.shadow.mapSize.width=2048,this.sunLight.shadow.mapSize.height=2048,this.scene.add(this.sunLight),this.cameraHelper=new e.CameraHelper(this.sunLight.shadow.camera),this.scene.add(this.cameraHelper),this.cameraHelper.update(),this.ambientLight=new e.AmbientLight(16777215,1),this.scene.add(this.ambientLight),this.spotLight=new e.SpotLight(16777215,1),this.spotLight.castShadow=!0,this.spotLight.shadow.bias=-.0001,this.spotLight.shadow.normalBias=.05,this.spotLight.angle=Math.PI/6,this.spotLight.penumbra=.3,this.spotLight.decay=1,this.spotLight.distance=1e3,this.camera.add(this.spotLight),this.spotLight.position.set(0,0,0),this.spotLight.target.position.set(0,0,-1),this.camera.add(this.spotLight.target);}updateSunLight(t,i,s,h){this.sunLight.visible=t,this.sunLight.color.set(i),this.sunLight.intensity=s,this.sunLight.position.set(h.x,h.y,h.z),this.cameraHelper.update();}updateAmbientLight(t,i,s){this.ambientLight.visible=t,this.ambientLight.color.set(i),this.ambientLight.intensity=s;}updateSpotLight(t,i,s,h,a,e,o){this.spotLight.visible=t,this.spotLight.color.set(i),this.spotLight.intensity=s,this.spotLight.angle=h*Math.PI/180,this.spotLight.penumbra=a,this.spotLight.decay=e,this.spotLight.distance=o;}constructor(t,i){a._(this,"scene",void 0),a._(this,"camera",void 0),a._(this,"sunLight",void 0),a._(this,"ambientLight",void 0),a._(this,"spotLight",void 0),a._(this,"cameraHelper",void 0),this.scene=t,this.camera=i,this.initLights();}}},"8fd7a7b3":function c(c,f,a,e){c._m(f);var i=c.i(a("21929cc9")),n=a("21929cc9");c._e(f,n),f.default=c.f(i);},"93e7dcc4":function f(f,d,a,c){f._m(d);var e=f.i(a("ff9d919c")),_=f.i(a("ddc00f4e")),i=a("ff9d919c");f._e(d,i),d.default=f.f(_)(f.f(e),[["__scopeId","data-v-13d72a26"]]);},"953dfae2":function a(a,e,c,i){a._m(e);var n=c("9aaf3498"),p=c("0e70da6a"),t=a.i(c("7d33ac30")),f=n.createApp(a.f(t)),r=p.createPinia();f.use(r),f.mount("#app");},"99602713":function e(e,l,o,p){e._m(l),e.o(l,"ASSETS",()=>g);var g={models:{home:"models/home.glb",characterIdle:"models/Idle.fbx",characterWalk:"models/Walking.fbx"},textures:{skybox:["xp.jpg","xn.jpg","yp.jpg","yn.jpg","zp.jpg","zn.jpg"]}};},"ae1ac647":function e(e,a,c,d){e._m(a);var f=e.i(c("7c3ee4ab")),_=e.i(c("ddc00f4e")),i=c("7c3ee4ab");e._e(a,i),a.default=e.f(_)(e.f(f),[["__scopeId","data-v-e9a38472"]]);},"c2079dd8":function e(e,i,r,l){e._m(i),e.o(i,"ColliderManager",()=>a),e.o(i,"colliderManager",()=>d);var s=r("09efd1d2");r("40616381");var t=e.w(r("3b16918b")),o=e.w(r("ef066f7a"));class a{generateCollider(e,i,r){this.dispose(),this.scene=i;var l=[];if(e.traverse(e=>{if(e.isMesh){for(var i=e.geometry.clone(),r=!1,s=e.parent;s;){if("Door"===s.name){r=!0;break;}s=s.parent;}if(!(r||e.name.endsWith("Glass"))){for(var t in i.applyMatrix4(e.matrixWorld),i.attributes)"position"!==t&&i.deleteAttribute(t);l.push(i);}}}),l.length>0){var s=o.mergeGeometries(l);s.computeBoundsTree(),this.collider=new t.Mesh(s,new t.MeshBasicMaterial({wireframe:!0,color:16711680})),this.collider.visible=!1,this.collider.name="collider",this.scene.add(this.collider),r(this.collider);}}setVisibility(e){this.collider&&(this.collider.visible=e);}dispose(){this.collider&&(this.scene&&this.scene.remove(this.collider),this.collider.geometry.dispose(),Array.isArray(this.collider.material)?this.collider.material.forEach(e=>e.dispose()):this.collider.material.dispose(),this.collider=null);}constructor(){s._(this,"collider",null),s._(this,"scene",null);}}var d=new a;},"c879eb01":function e(e,f,a,b){e._m(f);var i=e.i(a("b7044e63")),n=a("b7044e63");e._e(f,n),f.default=e.f(i);},"cca86db6":function e(e,n,o,t){e._m(n);var r=o("493f9ad4");o("b25dd2f8");var a=o("9aaf3498"),i=o("9aaf3498"),d=o("9aaf3498"),c=e.i(o("67dbd159")),l=e.i(o("26d7988f")),f=o("1f6a8afd"),u=o("0e70da6a"),s=o("f247f526"),m=e.i(o("7cdc7ff0")),v=e.i(o("93e7dcc4")),p=e.i(o("d0f5b517")),k=o("71200ed9"),g={class:"ui-layer"},h={key:0,class:"interaction-prompt"};n.default=a.defineComponent({__name:"Viewer",async setup(n){var o,t,y,E=s.useSceneStore(),L=u.storeToRefs(E),P=L.isLoading,V=L.loadingProgress,w=L.isDarkMode,N=L.movementMode,b=L.showInteractionPrompt,B=L.interactionText;o=(y=r._(a.withAsyncContext(()=>e.f(c).init()),2))[0],t=y[1],await o,t(),k.useViewerSync();var C=d.computed(()=>w.value?f.darkTheme:null),_=d.ref(!1),S=()=>{("fly"===N.value||"thirdPerson"===N.value)&&e.f(c).lockPointer();},x=d.computed(()=>("fly"===N.value||"thirdPerson"===N.value)&&!_.value),M=()=>{_.value=document.pointerLockElement===e.f(l).renderer.domElement;};return d.onMounted(()=>{document.addEventListener("pointerlockchange",M);}),d.onBeforeUnmount(()=>{document.removeEventListener("pointerlockchange",M);}),(n,o)=>(i.openBlock(),i.createBlock(i.unref(f.NConfigProvider),{theme:C.value},{default:i.withCtx(()=>[i.createVNode(e.f(m),{isLoading:i.unref(P),progress:i.unref(V)},null,8,["isLoading","progress"]),i.createElementVNode("div",g,[i.createVNode(e.f(v),{visible:x.value,mode:i.unref(N),onEnterPointerLock:S},null,8,["visible","mode"]),i.unref(b)?(i.openBlock(),i.createElementBlock("div",h,i.toDisplayString(i.unref(B)),1)):i.createCommentVNode("",!0),i.createVNode(e.f(p))])]),_:1},8,["theme"]));}});},"d0f5b517":function f(f,e,a,d){f._m(e);var c=f.i(a("b1f59e44")),_=f.i(a("ddc00f4e")),i=a("b1f59e44");f._e(e,i),e.default=f.f(_)(f.f(c),[["__scopeId","data-v-fc9a7620"]]);},"ddc00f4e":function r(r,a,t,e){r._m(a);var n=t("493f9ad4");t("c550eeaa"),t("2d08c2e5"),t("a3876e70"),a.default=(r,a)=>{var t=r.__vccOpts||r,e=!0,l=!1,c=void 0;try{for(var f,o=a[Symbol.iterator]();!(e=(f=o.next()).done);e=!0){var u=n._(f.value,2),v=u[0],i=u[1];t[v]=i;}}catch(r){l=!0,c=r;}finally{try{e||null==o.return||o.return();}finally{if(l)throw c;}}return t;};},"e00be090":function e(e,d,o,r){e._m(d),e.o(d,"ModelLoader",()=>h);var a=o("09efd1d2");o("b25dd2f8");var t=o("ca576447"),s=o("4ecad5d1"),i=o("44079c7b"),L=o("fb22d209");class h{loadGLTF(e,d){return new Promise((o,r)=>{this.gltfLoader.load(e,e=>{o(e);},d,e=>{r(e);});});}loadFBX(e,d){return new Promise((o,r)=>{this.fbxLoader.load(e,e=>{o(e);},d,e=>{r(e);});});}dispose(){this.dracoLoader.dispose(),this.ktx2Loader.dispose();}updateRenderer(e){this.ktx2Loader.detectSupport(e);}constructor(e){a._(this,"gltfLoader",void 0),a._(this,"fbxLoader",void 0),a._(this,"dracoLoader",void 0),a._(this,"ktx2Loader",void 0),this.gltfLoader=new t.GLTFLoader,this.fbxLoader=new s.FBXLoader,this.dracoLoader=new i.DRACOLoader,this.dracoLoader.setDecoderPath("draco/"),this.dracoLoader.setDecoderConfig({type:"wasm"}),this.dracoLoader.preload(),this.gltfLoader.setDRACOLoader(this.dracoLoader),!1===e.initialized&&console.warn("ModelLoader 的 KTX2Loader 初始化需要在 renderer 初始化之后进行。\n 如果看到这条警告，可能 ModelLoader 实例化太早了。"),this.ktx2Loader=new L.KTX2Loader,this.ktx2Loader.setTranscoderPath("basis/"),this.ktx2Loader.detectSupport(e),this.gltfLoader.setKTX2Loader(this.ktx2Loader);}}},"e9ef43b1":function t(t,o,s,n){t._m(o),t.o(o,"TopViewController",()=>a);var e=s("09efd1d2"),i=t.w(s("3b16918b")),r=s("1500a9c9");class a{setupControls(){this.controls.target.set(0,0,0),this.controls.enabled=!1,this.controls.enableDamping=!0,this.controls.dampingFactor=.08,this.controls.rotateSpeed=.35,this.controls.minPolarAngle=0,this.controls.maxPolarAngle=.1,this.controls.enablePan=!0,this.controls.screenSpacePanning=!0;}setDomElement(t){var o=this.controls.enabled,s=this.controls.target.clone();this.controls.dispose(),this.controls=new r.OrbitControls(this.camera,t),this.setupControls(),this.controls.target.copy(s),this.controls.enabled=o;}enter(){this.controls.enabled=!0,this.animateToTopView();}leave(){this.controls.enabled=!1,this.isAnimating=!1;}update(t){this.isAnimating||this.controls.update(t);}dispose(){this.controls.dispose();}animateToTopView(){this.isAnimating=!0;var t=this.camera.position.clone(),o=new i.Vector3;this.camera.getWorldDirection(o).normalize();var s=t.clone().add(o),n=new i.Vector3(o.x,0,o.z),e=new i.Vector3(0,20,0),r=performance.now();this.controls.minPolarAngle=0,this.controls.maxPolarAngle=Math.PI;var a=()=>{if(this.controls.enabled){var o=Math.min((performance.now()-r)/1e3,1),i=3*Math.pow(o,2)-2*Math.pow(o,3);this.camera.position.lerpVectors(t,e,i),this.controls.target.lerpVectors(s,n,i),this.camera.lookAt(this.controls.target),o<1?requestAnimationFrame(a):(this.isAnimating=!1,this.controls.minPolarAngle=0,this.controls.maxPolarAngle=.1);}};a();}constructor(t,o){e._(this,"camera",void 0),e._(this,"controls",void 0),e._(this,"isAnimating",!1),this.camera=t,this.controls=new r.OrbitControls(t,o),this.setupControls();}}},"f194c96a":function e(e,a,t,o){e._m(a),t("2d08c2e5"),t("a3876e70");var n=t("9aaf3498"),r=t("9aaf3498"),i=t("1f6a8afd"),d={key:0,class:"loading-overlay"},l={class:"loading-content"};a.default=n.defineComponent({__name:"LoadingOverlay",props:{isLoading:{type:Boolean},progress:{}},setup:e=>(a,t)=>(r.openBlock(),r.createBlock(r.Transition,{name:"fade"},{default:r.withCtx(()=>[e.isLoading?(r.openBlock(),r.createElementBlock("div",d,[r.createElementVNode("div",l,[r.createVNode(r.unref(i.NSpin),{size:"large"}),r.createVNode(r.unref(i.NText),{class:"loading-text"},{default:r.withCtx(()=>[...t[0]||(t[0]=[r.createTextVNode("模型加载中...",-1)])]),_:1}),r.createVNode(r.unref(i.NProgress),{type:"line",percentage:e.progress,"show-indicator":!0,height:8,"border-radius":4,"indicator-placement":"outside",style:{width:"280px","margin-top":"16px"}},null,8,["percentage"])])])):r.createCommentVNode("",!0)]),_:1}))});},"f4cd7510":function e(e,t,o,s){e._m(t),e.o(t,"InfiniteGrid",()=>r);var a=e.w(o("3b16918b")),i=o("16fd0772");class r extends a.Mesh{constructor(){var e=new a.PlaneGeometry(1,1),t=new a.MeshStandardNodeMaterial({side:a.DoubleSide}),o=i.Fn(()=>{var e=i.positionWorld.xz,t=i.positionWorld.distance(i.cameraPosition),o=i.smoothstep(1e3,200,t),s=i.float(10),a=i.float(100),r=e.div(s).fract().sub(.5).abs().mul(2),m=i.smoothstep(.95,1,r.x).max(i.smoothstep(.95,1,r.y)),l=e.div(a).fract().sub(.5).abs().mul(2),n=i.smoothstep(.98,1,l.x).max(i.smoothstep(.98,1,l.y)),d=i.vec3(.6),u=i.vec3(.2),c=i.mix(m.mul(.2),n.mul(.5),n);return i.mix(u,d,c.mul(o));});t.colorNode=o(),super(e,t),this.scale.set(4e3,4e3,1),this.rotation.x=-Math.PI/2,this.frustumCulled=!1,this.receiveShadow=!0;}}},"f7acc5ff":function f(f,d,a,b){f._m(d);var e=f.i(a("61fbd776")),i=a("61fbd776");f._e(d,i),d.default=f.f(e);},});
//# sourceMappingURL=index_bfac.73eb09ce.js.map