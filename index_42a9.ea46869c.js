(function(_){var filename = ((function(){var _documentCurrentScript = typeof document !== "undefined" ? document.currentScript : null;return typeof document === "undefined" ? require("url").pathToFileURL(__filename).href : _documentCurrentScript && _documentCurrentScript.src || new URL("index_42a9.js", document.baseURI).href})());for(var r in _){_[r].__farm_resource_pot__=filename;window['f1d71b9dd14324d7340d3311efaf8136'].__farm_module_system__.register(r,_[r])}})({"23b6b720":function t(t,i,e,s){t._m(i),t.o(i,"ThirdPersonCamera",()=>o);var h=e("09efd1d2"),a=t.w(e("3b16918b"));class o{setTarget(t){this.target=t,this.syncWithCamera();}setCollider(t){this.collider=t;}syncWithCamera(){if(this.target){var t=new a.Vector3().subVectors(this.camera.position,this.target.position);this.radius=t.length(),this.currentRadius=this.radius,this.theta=Math.atan2(t.x,t.z),this.phi=Math.acos(a.MathUtils.clamp(t.y/this.radius,-1,1)),this.targetTheta=this.theta,this.targetPhi=this.phi;}}onMouseMove(t){this.isLocked&&(this.targetTheta-=t.movementX*this.sensitivity,this.targetPhi-=t.movementY*this.sensitivity,this.targetPhi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.targetPhi)));}onMouseWheel(t){this.isLocked&&(this.radius+=.005*t.deltaY,this.radius=Math.max(2,Math.min(20,this.radius)));}update(t){if(this.target){var i=1-Math.exp(-25*t),e=this.targetTheta-this.theta;this.theta+=e*i,this.phi+=(this.targetPhi-this.phi)*i;var s=this.target.position.clone().add(this.targetOffset),h=this.radius;if(this.collider){var o=new a.Vector3(0);o.setFromSphericalCoords(1,this.phi,this.theta).normalize();var r=new a.Raycaster(s,o);r.far=this.radius,r.firstHitOnly=!0;var n=r.intersectObject(this.collider,!0);n.length>0&&(h=Math.max(.2,n[0].distance-.2));}var d=-150*(this.currentRadius-h)-20*this.radiusVelocity;this.radiusVelocity+=d*t,this.currentRadius+=this.radiusVelocity*t,this.camera.position.setFromSphericalCoords(this.currentRadius,this.phi,this.theta).add(s),this.camera.lookAt(s);}}setLocked(t){this.isLocked=t;}onPointerLockChange(){this.isLocked=document.pointerLockElement===this.domElement;}dispose(){document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("pointerlockchange",this.onPointerLockChange),document.removeEventListener("wheel",this.onMouseWheel);}constructor(t,i){h._(this,"camera",void 0),h._(this,"domElement",void 0),h._(this,"target",null),h._(this,"theta",0),h._(this,"phi",Math.PI/2),h._(this,"radius",3),h._(this,"currentRadius",3),h._(this,"radiusVelocity",0),h._(this,"collider",null),h._(this,"targetTheta",0),h._(this,"targetPhi",Math.PI/2),h._(this,"minPolarAngle",.1),h._(this,"maxPolarAngle",Math.PI-.1),h._(this,"targetOffset",new a.Vector3(0,1.5,0)),h._(this,"isLocked",!1),h._(this,"sensitivity",.002),this.camera=t,this.domElement=i,this.onMouseMove=this.onMouseMove.bind(this),this.onPointerLockChange=this.onPointerLockChange.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("pointerlockchange",this.onPointerLockChange),document.addEventListener("wheel",this.onMouseWheel);}}},"26d7988f":function e(e,t,r,n){e._m(t),e.o(t,"Viewer",()=>p);var i=r("09efd1d2");r("b25dd2f8"),r("7bccf4aa"),r("2d08c2e5"),r("a3876e70"),r("c550eeaa");var s=e.w(r("3b16918b")),o=r("7f2264c7"),a=e.i(r("1498cb29")),h=r("03f4e36a"),d=r("47a20e72"),l=r("69939ce5"),c=r("e9ef43b1"),m=r("3eec3e47"),u=r("7475699d");class p{addMixer(e){this.mixers.push(e);}setCharacter(e){this.character=e,e.mesh&&(this.scene.add(e.mesh),this.controllers.thirdPerson.setCharacter(e));}removeMixer(e){var t=this.mixers.indexOf(e);-1!==t&&this.mixers.splice(t,1);}async init(){await this.renderer.init();var e=new s.PMREMGenerator(this.renderer);this.environmentTexture=e.fromScene(new o.RoomEnvironment,.04).texture,this.scene.environment=this.environmentTexture,this.gtaoPostProcessing=new u.PostProcessing(this.renderer,this.scene,this.camera),this.currentController.enter();}updateGTAO(e){this.gtaoEnabled=e.enabled,this.gtaoPostProcessing&&this.gtaoPostProcessing.update(e);}lockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!0):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!0);}unlockPointer(){"fly"===this.movementMode?this.currentController.setLocked(!1):"thirdPerson"===this.movementMode&&this.currentController.setLocked(!1);}setMovementMode(e){this.movementMode!==e&&(this.currentController.leave(),this.movementMode=e,this.currentController=this.controllers[e],this.currentController.enter());}setCameraPosition(e){this.camera.position.copy(e);}setCameraDirection(e){if("orbit"!==this.movementMode&&0!==e.lengthSq()){var t=e.clone().normalize();this.tempTarget.copy(this.camera.position).add(t),this.camera.lookAt(this.tempTarget);}}getCameraDirection(){return this.camera.getWorldDirection(this.worldDirection),this.worldDirection.clone();}onUpdate(e){return this.updateListeners.add(e),()=>this.updateListeners.delete(e);}dispose(){this.renderer.setAnimationLoop(null),Object.values(this.controllers).forEach(e=>e.dispose()),this.renderer.dispose(),this.renderer.domElement.parentElement&&this.renderer.domElement.parentElement.removeChild(this.renderer.domElement),this.stats.dom.parentElement&&this.stats.dom.parentElement.removeChild(this.stats.dom);}setEnvironmentEnabled(e){this.scene.environment=e?this.environmentTexture:null;}setEnvironmentIntensity(e){this.scene.environmentIntensity=e;}setEnvironmentCollider(e){this.controllers.thirdPerson.setCollider(e);}setSkybox(e){this.skyboxTexture=e,this.scene.background=e;}setSkyboxEnabled(e){this.scene.background=e?this.skyboxTexture:null;}constructor(){i._(this,"scene",void 0),i._(this,"camera",void 0),i._(this,"stats",void 0),i._(this,"renderer",void 0),i._(this,"gtaoPostProcessing",null),i._(this,"gtaoEnabled",!0),i._(this,"controllers",void 0),i._(this,"currentController",void 0),i._(this,"movementMode","fly"),i._(this,"clock",new s.Clock),i._(this,"environmentTexture",null),i._(this,"mixers",[]),i._(this,"worldDirection",new s.Vector3),i._(this,"tempTarget",new s.Vector3),i._(this,"skyboxTexture",null),i._(this,"character",null),i._(this,"lightManager",null),i._(this,"updateListeners",new Set),i._(this,"animate",()=>{var e=this.clock.getDelta(),t=!0,r=!1,n=void 0;try{for(var i,s=this.mixers[Symbol.iterator]();!(t=(i=s.next()).done);t=!0)i.value.update(e);}catch(e){r=!0,n=e;}finally{try{t||null==s.return||s.return();}finally{if(r)throw n;}}this.character&&this.character.update(e),this.currentController.update(e),this.updateListeners.forEach(t=>t(e)),this.stats.update(),this.gtaoPostProcessing&&this.gtaoEnabled?this.gtaoPostProcessing.render():this.renderer.render(this.scene,this.camera),m.InputManager.getInstance().update();}),this.scene=new s.Scene;var t=window.innerWidth,r=window.innerHeight;this.camera=new s.PerspectiveCamera(45,t/r,.1,3e3),this.camera.position.set(1,1,1),this.renderer=new s.WebGPURenderer({antialias:!0}),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=s.PCFSoftShadowMap,this.renderer.outputColorSpace=s.SRGBColorSpace,this.renderer.toneMapping=s.ACESFilmicToneMapping,this.renderer.toneMappingExposure=1,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(t,r),document.body.appendChild(this.renderer.domElement),this.stats=new(e.f(a)),document.body.appendChild(this.stats.dom),this.controllers={fly:new h.FlyController(this.camera,this.renderer.domElement),orbit:new d.OrbitController(this.camera,this.renderer.domElement),thirdPerson:new l.ThirdPersonController(this.camera,this.renderer.domElement,new s.Vector3),topView:new c.TopViewController(this.camera,this.renderer.domElement)},this.currentController=this.controllers.fly,this.renderer.setAnimationLoop(this.animate),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix();});}}var v=new p;t.default=v;},"4735cb57":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var u=a("9aaf3498"),n=a("9aaf3498"),r=a("1f6a8afd"),f=a("0e70da6a"),d=a("f247f526");t.default=u.defineComponent({__name:"PostProcessPanel",setup(e){var t=d.useSceneStore(),a=f.storeToRefs(t),l=a.gtaoEnabled,u=a.gtaoSamples,o=a.gtaoDistanceExponent,i=a.gtaoDistanceFallOff,s=a.gtaoRadius,N=a.gtaoScale,c=a.gtaoThickness,x=a.gtaoAoOnly;return(e,t)=>(n.openBlock(),n.createBlock(n.unref(r.NSpace),{vertical:"",size:"large"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"2",style:{"font-size":"12px","text-transform":"uppercase"}},{default:n.withCtx(()=>[...t[8]||(t[8]=[n.createTextVNode("GTAO",-1)])]),_:1}),n.createVNode(n.unref(r.NSpace),{align:"center"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSwitch),{value:n.unref(l),"onUpdate:value":t[0]||(t[0]=e=>n.isRef(l)?l.value=e:null)},null,8,["value"]),n.createVNode(n.unref(r.NText),null,{default:n.withCtx(()=>[...t[9]||(t[9]=[n.createTextVNode("å¯ç”¨ GTAO",-1)])]),_:1})]),_:1}),n.createVNode(n.unref(r.NSpace),{align:"center"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSwitch),{value:n.unref(x),"onUpdate:value":t[1]||(t[1]=e=>n.isRef(x)?x.value=e:null),disabled:!n.unref(l)},null,8,["value","disabled"]),n.createVNode(n.unref(r.NText),null,{default:n.withCtx(()=>[...t[10]||(t[10]=[n.createTextVNode("ä»…æ˜¾ç¤º AO",-1)])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGrid),{cols:2,"x-gap":8,"y-gap":8},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[11]||(t[11]=[n.createTextVNode("Samples",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(u),"onUpdate:value":t[2]||(t[2]=e=>n.isRef(u)?u.value=e:null),size:"small",min:4,max:32,step:1,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[12]||(t[12]=[n.createTextVNode("Radius",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(s),"onUpdate:value":t[3]||(t[3]=e=>n.isRef(s)?s.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[13]||(t[13]=[n.createTextVNode("Distance Exp",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(o),"onUpdate:value":t[4]||(t[4]=e=>n.isRef(o)?o.value=e:null),size:"small",min:1,max:4,step:.1,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[14]||(t[14]=[n.createTextVNode("Distance Falloff",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(i),"onUpdate:value":t[5]||(t[5]=e=>n.isRef(i)?i.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[15]||(t[15]=[n.createTextVNode("Scale",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(N),"onUpdate:value":t[6]||(t[6]=e=>n.isRef(N)?N.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1}),n.createVNode(n.unref(r.NGi),null,{default:n.withCtx(()=>[n.createVNode(n.unref(r.NSpace),{vertical:"",size:"small"},{default:n.withCtx(()=>[n.createVNode(n.unref(r.NText),{depth:"3",style:{"font-size":"11px"}},{default:n.withCtx(()=>[...t[16]||(t[16]=[n.createTextVNode("Thickness",-1)])]),_:1}),n.createVNode(n.unref(r.NInputNumber),{value:n.unref(c),"onUpdate:value":t[7]||(t[7]=e=>n.isRef(c)?c.value=e:null),size:"small",min:.01,max:2,step:.01,"show-button":!1},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}));}});},"61fbd776":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70"),a("db38ec0f");var u=a("9aaf3498"),r=a("9aaf3498"),n=a("1f6a8afd"),i=a("0e70da6a"),d=a("f247f526");t.default=u.defineComponent({__name:"LightingPanel",setup(e){var t=d.useSceneStore(),a=i.storeToRefs(t),l=a.skyboxEnabled,u=a.sunEnabled,f=a.sunColor,o=a.sunIntensity,N=a.sunPosition,c=a.ambientEnabled,s=a.ambientColor,x=a.ambientIntensity,p=a.environmentEnabled,v=a.environmentIntensity,h=a.spotEnabled,V=a.spotColor,w=a.spotIntensity,C=a.spotAngle,_=a.spotPenumbra,S=a.spotDecay,m=a.spotDistance;return(e,t)=>(r.openBlock(),r.createBlock(r.unref(n.NSpace),{vertical:"",size:"large"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(l),"onUpdate:value":t[0]||(t[0]=e=>r.isRef(l)?l.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...t[19]||(t[19]=[r.createTextVNode("å¤©ç©ºç›’",-1)])]),_:1})]),_:1})]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(u),"onUpdate:value":t[1]||(t[1]=e=>r.isRef(u)?u.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...t[20]||(t[20]=[r.createTextVNode("å¤ªé˜³å…‰",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[21]||(t[21]=[r.createTextVNode("é¢œè‰²",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(f),"onUpdate:value":t[2]||(t[2]=e=>r.isRef(f)?f.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("äº®åº¦ "+r.toDisplayString(r.unref(o).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(o),"onUpdate:value":t[3]||(t[3]=e=>r.isRef(o)?o.value=e:null),min:0,max:10,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(u)]]),r.withDirectives(r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[22]||(t[22]=[r.createTextVNode("å…‰æºä½ç½®",-1)])]),_:1}),r.createVNode(r.unref(n.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("X "+r.toDisplayString(r.unref(N).x),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(N).x,"onUpdate:value":t[4]||(t[4]=e=>r.unref(N).x=e),min:-100,max:100,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("Y "+r.toDisplayString(r.unref(N).y),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(N).y,"onUpdate:value":t[5]||(t[5]=e=>r.unref(N).y=e),min:0,max:100,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("Z "+r.toDisplayString(r.unref(N).z),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(N).z,"onUpdate:value":t[6]||(t[6]=e=>r.unref(N).z=e),min:-100,max:100,step:1},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(u)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(c),"onUpdate:value":t[7]||(t[7]=e=>r.isRef(c)?c.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...t[23]||(t[23]=[r.createTextVNode("å…¨å±€çŽ¯å¢ƒå…‰",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[24]||(t[24]=[r.createTextVNode("é¢œè‰²",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(s),"onUpdate:value":t[8]||(t[8]=e=>r.isRef(s)?s.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("äº®åº¦ "+r.toDisplayString(r.unref(x).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(x),"onUpdate:value":t[9]||(t[9]=e=>r.isRef(x)?x.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(c)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(p),"onUpdate:value":t[10]||(t[10]=e=>r.isRef(p)?p.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...t[25]||(t[25]=[r.createTextVNode("çŽ¯å¢ƒå…‰ç…§ (RoomEnvironment)",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("å¼ºåº¦ "+r.toDisplayString(r.unref(v).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(v),"onUpdate:value":t[11]||(t[11]=e=>r.isRef(v)?v.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1},512),[[r.vShow,r.unref(p)]])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{align:"center"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSwitch),{value:r.unref(h),"onUpdate:value":t[12]||(t[12]=e=>r.isRef(h)?h.value=e:null)},null,8,["value"]),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[...t[26]||(t[26]=[r.createTextVNode("æ‘„åƒæœºèšå…‰ç¯",-1)])]),_:1})]),_:1}),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[27]||(t[27]=[r.createTextVNode("é¢œè‰²",-1)])]),_:1}),r.createVNode(r.unref(n.NColorPicker),{value:r.unref(V),"onUpdate:value":t[13]||(t[13]=e=>r.isRef(V)?V.value=e:null),"show-alpha":!1,size:"small"},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("äº®åº¦ "+r.toDisplayString(r.unref(w).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(w),"onUpdate:value":t[14]||(t[14]=e=>r.isRef(w)?w.value=e:null),min:0,max:100,step:.1},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(h)]]),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("é”¥å½¢è§’åº¦ "+r.toDisplayString(r.unref(C))+"Â°",1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(C),"onUpdate:value":t[15]||(t[15]=e=>r.isRef(C)?C.value=e:null),min:5,max:90,step:1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("åŠå½± "+r.toDisplayString(r.unref(_).toFixed(2)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(_),"onUpdate:value":t[16]||(t[16]=e=>r.isRef(_)?_.value=e:null),min:0,max:1,step:.01},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(h)]]),r.withDirectives(r.createVNode(r.unref(n.NGrid),{cols:2,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("è¡°å‡ "+r.toDisplayString(r.unref(S).toFixed(1)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(S),"onUpdate:value":t[17]||(t[17]=e=>r.isRef(S)?S.value=e:null),min:0,max:5,step:.1},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[r.createTextVNode("è·ç¦» "+r.toDisplayString(r.unref(m)),1)]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(m),"onUpdate:value":t[18]||(t[18]=e=>r.isRef(m)?m.value=e:null),min:0,max:5e3,step:10},null,8,["value"])]),_:1})]),_:1})]),_:1},512),[[r.vShow,r.unref(h)]])]),_:1})]),_:1}));}});},"69939ce5":function e(e,t,i,r){e._m(t),e.o(t,"ThirdPersonController",()=>p);var s=i("09efd1d2"),o=e.w(i("3b16918b")),a=i("23b6b720"),l=i("f247f526"),n=i("0e70da6a"),h=i("9aaf3498"),c=i("96554b2f"),d=i("3eec3e47");class p{setCharacter(e){e.mesh&&this.setPlayerMesh(e.mesh),this.playerVelocity=e.velocity;}setPlayerMesh(e){this.playerMesh=e,this.thirdPersonCamera.setTarget(e);}setCollider(e){this.collider=e,this.thirdPersonCamera.setCollider(e);}enter(){this.domElement.addEventListener("click",this.onClick),this.playerMesh&&this.thirdPersonCamera.syncWithCamera();var e=n.storeToRefs(l.useSceneStore()),t=e.moveSpeed,i=e.collisionEnabled;this.moveSpeed=t,this.collisionEnabled=i;}leave(){this.domElement.removeEventListener("click",this.onClick),this.thirdPersonCamera.setLocked(!1),document.pointerLockElement===this.domElement&&document.exitPointerLock();}update(e){this.handleInput(e),this.updatePlayer(e),this.thirdPersonCamera.update(e),this.playerMesh&&c.doorManager.update(this.playerMesh.position);}dispose(){this.thirdPersonCamera.dispose();}onClick(){document.pointerLockElement||(this.domElement.requestPointerLock(),this.thirdPersonCamera.setLocked(!0));}handleInput(e){if(this.playerMesh){var t=d.InputManager.getInstance(),i=t.getMovementInput();if(t.isKeyDown("KeyF")&&c.doorManager.interact(),this.camera.getWorldDirection(this.tempForward),this.tempForward.y=0,this.tempForward.normalize(),this.tempRight.crossVectors(this.tempForward,this.camera.up).normalize(),this.playerDirection.set(0,0,0),this.playerDirection.addScaledVector(this.tempForward,i.z),this.playerDirection.addScaledVector(this.tempRight,i.x),this.playerDirection.lengthSq()>0){this.playerDirection.normalize(),this.playerVelocity.add(this.playerDirection.multiplyScalar(this.moveSpeed.value*e));var r=Math.atan2(this.playerDirection.x,this.playerDirection.z),s=new o.Quaternion;s.setFromAxisAngle(new o.Vector3(0,1,0),r),this.playerMesh.quaternion.slerp(s,.2);}}}updatePlayer(e){if(this.playerMesh){var t=Math.exp(-4*e)-1;this.playerVelocity.addScaledVector(this.playerVelocity,t);var i=this.playerVelocity.clone().multiplyScalar(e);this.collider&&this.collisionEnabled.value&&(this.resolveCollisions(i),c.doorManager.checkCollision(this.playerMesh.position,.15,i)),this.playerMesh.position.add(i);}}resolveCollisions(e){if(this.playerMesh&&this.collider){var t=new o.Vector3(0,.2,0),i=this.playerMesh.position.clone().add(t).add(e),r=this.collider.geometry.boundsTree;if(r){for(var s=new o.Vector3,a=0;a<5;a++)r.shapecast({intersectsBounds:e=>.15>e.distanceToPoint(i),intersectsTriangle:e=>{var t=e.closestPointToPoint(i,s).distanceTo(i);if(t<.15){var r=.15-t,o=i.clone().sub(s).normalize();o.y=0,i.addScaledVector(o,r);}}});var l=i.clone().sub(t);e.copy(l).sub(this.playerMesh.position);}}}setLocked(e){this.thirdPersonCamera.setLocked(e),e?this.domElement.requestPointerLock():document.pointerLockElement===this.domElement&&document.exitPointerLock();}constructor(e,t,i){s._(this,"camera",void 0),s._(this,"domElement",void 0),s._(this,"thirdPersonCamera",void 0),s._(this,"playerMesh",null),s._(this,"playerVelocity",void 0),s._(this,"playerDirection",new o.Vector3),s._(this,"tempForward",new o.Vector3),s._(this,"tempRight",new o.Vector3),s._(this,"collider",null),s._(this,"moveSpeed",h.ref(0)),s._(this,"collisionEnabled",h.ref(!0)),this.camera=e,this.domElement=t,this.playerVelocity=i,this.thirdPersonCamera=new a.ThirdPersonCamera(e,t),this.onClick=this.onClick.bind(this);}}},"71200ed9":function e(e,a,t,n){e._m(a),e.o(a,"useViewerSync",()=>f);var i=t("15edfc35"),o=t("9aaf3498"),l=t("0e70da6a"),s=t("f247f526"),u=e.i(t("26d7988f")),v=e.w(t("3b16918b")),c=t("c2079dd8");function f(){var a=s.useSceneStore(),t=l.storeToRefs(a),n=t.cameraPosition,f=t.cameraDirection,r=t.isEditingPosition,d=t.isEditingDirection,h=t.movementMode,m=t.skyboxEnabled,E=t.showCollisionBoxes,g=t.playerPosition,p=t.isEditingPlayerPosition,b=t.environmentEnabled,y=t.environmentIntensity,w=t.gtaoEnabled,P=t.gtaoSamples,C=t.gtaoDistanceExponent,D=t.gtaoDistanceFallOff,S=t.gtaoRadius,x=t.gtaoScale,M=t.gtaoThickness,I=t.gtaoAoOnly,O=t.sunEnabled,k=t.sunColor,A=t.sunIntensity,V=t.sunPosition,z=t.ambientEnabled,L=t.ambientColor,T=t.ambientIntensity,F=t.spotEnabled,R=t.spotColor,U=t.spotIntensity,_=t.spotAngle,q=t.spotPenumbra,B=t.spotDecay,G=t.spotDistance;o.watchEffect(()=>{if(r.value){var a=n.value,t=a.x,i=a.y,o=a.z;e.f(u).setCameraPosition(new v.Vector3(t,i,o));}}),o.watchEffect(()=>{if(d.value){var a=f.value,t=a.x,n=a.y,i=a.z,o=new v.Vector3(t,n,i);o.lengthSq()>0&&e.f(u).setCameraDirection(o);}}),o.watchEffect(()=>{var a;if(null===(a=e.f(u).character)||void 0===a?void 0:a.mesh){var t=g.value,n=t.x,i=t.y,o=t.z;e.f(u).character.mesh.position.set(n,i,o);}}),o.watchEffect(()=>{e.f(u).setMovementMode(h.value);}),o.watchEffect(()=>{e.f(u).setSkyboxEnabled(m.value);}),o.watchEffect(()=>{c.colliderManager.setVisibility(E.value);}),o.watchEffect(()=>{e.f(u).setEnvironmentEnabled(b.value);}),o.watchEffect(()=>{e.f(u).setEnvironmentIntensity(y.value);}),o.watchEffect(()=>{e.f(u).updateGTAO({enabled:w.value,samples:P.value,distanceExponent:C.value,distanceFallOff:D.value,radius:S.value,scale:x.value,thickness:M.value,aoOnly:I.value});}),o.watchEffect(()=>{var a;null===(a=e.f(u).lightManager)||void 0===a||a.updateSunLight(O.value,k.value,A.value,i._({},V.value));}),o.watchEffect(()=>{var a;null===(a=e.f(u).lightManager)||void 0===a||a.updateAmbientLight(z.value,L.value,T.value);}),o.watchEffect(()=>{var a;null===(a=e.f(u).lightManager)||void 0===a||a.updateSpotLight(F.value,R.value,U.value,_.value,q.value,B.value,G.value);});var j=e.f(u).onUpdate(()=>{var t;r.value||a.updateCameraPosition(e.f(u).camera.position),d.value||a.updateCameraDirection(e.f(u).getCameraDirection()),"thirdPerson"===h.value&&!p.value&&(null===(t=e.f(u).character)||void 0===t?void 0:t.mesh)&&a.updatePlayerPosition(e.f(u).character.mesh.position);});o.onUnmounted(()=>{j();});}},"7c3ee4ab":function e(e,t,a,l){e._m(t);var n=a("b5537c77");a("c550eeaa"),a("2d08c2e5"),a("a3876e70"),a("2554870f"),a("c98af605");var r=a("9aaf3498"),c=a("9aaf3498"),o=a("9aaf3498"),i=a("1f6a8afd"),u=a("0e70da6a"),d=a("f247f526"),v={class:"scene-tree-container"};t.default=r.defineComponent({__name:"SceneTreePanel",setup(e){var t=d.useSceneStore(),a=u.storeToRefs(t),l=a.modelRoot,r=a.movementMode,f=o.ref([]),h=o.ref([]),s=o.ref(4),p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,l=t?"".concat(t,"-").concat(e.id):"".concat(e.id),n={key:l,label:e.name||"".concat(e.type," #").concat(e.id),object3D:e};return e.children.length>0&&a<s.value&&(n.children=e.children.map(e=>p(e,l,a+1))),n;},y=e=>{var t=[],a=e=>{var l=!0,n=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(l=(c=o.next()).done);l=!0){var i=c.value;t.push(i.key),i.children&&a(i.children);}}catch(e){n=!0,r=e;}finally{try{l||null==o.return||o.return();}finally{if(n)throw r;}}};return a(e),t;},m=()=>{if(l.value){var e=p(l.value);f.value=[e],h.value=y(f.value);}},x=(e,t,a)=>{var l=a.node;l&&(l.object3D.visible="check"===a.action),h.value=e;};return o.watch(l,e=>{e&&m();},{immediate:!0}),o.watch(s,()=>{m();}),o.watch(r,e=>{var t="topView"===e,a=function(e){var t=f.value,a=!0,l=!1,r=void 0;try{for(var c,o=e[Symbol.iterator]();!(a=(c=o.next()).done);a=!0){var i=function(){var a=c.value,l=t.find(e=>e.object3D.name===a);return l?a===e[e.length-1]?{v:l}:void(t=l.children||[]):{v:null};}();if("object"===n._(i))return i.v;}}catch(e){l=!0,r=e;}finally{try{a||null==o.return||o.return();}finally{if(l)throw r;}}return null;}(["Scene","Scene_Collection","Ceiling"]);a&&(a.object3D.visible=!t,t?h.value=h.value.filter(e=>e!==a.key):h.value.includes(a.key)||h.value.push(a.key));}),(e,t)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createVNode(c.unref(i.NText),{depth:"3"},{default:c.withCtx(()=>[...t[1]||(t[1]=[c.createTextVNode("å‹¾é€‰/å–æ¶ˆå‹¾é€‰ä»¥æ˜¾ç¤º/éšè—æ¨¡åž‹å±‚çº§ä¸­çš„å¯¹è±¡ã€‚",-1)])]),_:1}),c.createVNode(c.unref(i.NSpace),{vertical:"",size:"small",style:{"margin-top":"12px","margin-bottom":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NSpace),{justify:"space-between",style:{width:"100%"}},{default:c.withCtx(()=>[c.createVNode(c.unref(i.NText),{depth:"2",style:{"font-size":"12px"}},{default:c.withCtx(()=>[...t[2]||(t[2]=[c.createTextVNode("æ˜¾ç¤ºæ·±åº¦",-1)])]),_:1}),c.createVNode(c.unref(i.NText),null,{default:c.withCtx(()=>[c.createTextVNode(c.toDisplayString(s.value)+" å±‚",1)]),_:1})]),_:1}),c.createVNode(c.unref(i.NSlider),{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),min:1,max:10,step:1},null,8,["value"])]),_:1}),c.createElementVNode("div",v,[c.createVNode(c.unref(i.NTree),{data:f.value,"checked-keys":h.value,"onUpdate:checkedKeys":x,checkable:"",selectable:"","block-line":"","expand-on-click":"","default-expand-all":"",style:{"font-size":"12px"}},null,8,["data","checked-keys"])])],64));}});},"96554b2f":function t(t,i,o,n){t._m(i),t.o(i,"Door",()=>s),t.o(i,"DoorManager",()=>c),t.o(i,"doorManager",()=>h);var e=o("09efd1d2");o("c550eeaa"),o("2d08c2e5"),o("a3876e70");var a=t.w(o("3b16918b")),r=o("f247f526");class s{get isAnimating(){return!!this.action&&this.action.isRunning();}interact(){this.action&&(this.isOpen=!this.isOpen,this.action.paused=!1,this.isOpen?this.action.timeScale=1:this.action.timeScale=-1,this.action.play());}getDistance(t){return this.object.getWorldPosition(this.worldPosition),this.worldPosition.distanceTo(t);}constructor(t,i,o){e._(this,"object",void 0),e._(this,"isOpen",!1),e._(this,"mixer",void 0),e._(this,"action",null),e._(this,"box",void 0),e._(this,"worldPosition",new a.Vector3),this.object=t,this.box=new a.Box3().setFromObject(t),this.mixer=o;var n=t.name+"Open",r=i.find(t=>t.name===n);r?(this.action=this.mixer.clipAction(r),this.action.loop=a.LoopOnce,this.action.clampWhenFinished=!0):console.warn("Animation ".concat(n," not found for door ").concat(t.name));}}class c{addDoor(t,i,o){if(!this.doors.find(i=>i.object===t)){var n=new s(t,i,o);this.doors.push(n);}}update(t){var i=null,o=1/0,n=!0,e=!1,a=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value,l=h.getDistance(t);l<this.interactionDistance&&l<o&&(o=l,i=h);}}catch(t){e=!0,a=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw a;}}var x=r.useSceneStore();i?(this.activeDoor=i,x.showInteractionPrompt=!0,x.interactionText=i.isOpen?"æŒ‰ F å…³é—¨":"æŒ‰ F å¼€é—¨"):(this.activeDoor=null,x.showInteractionPrompt=!1);}interact(){this.activeDoor&&this.activeDoor.interact();}checkCollision(t,i,o){var n=!0,e=!1,r=void 0;try{for(var s,c=this.doors[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var h=s.value;if(!h.isOpen&&!h.isAnimating){h.box.setFromObject(h.object);var l=new a.Box3,x=t.clone().add(o);if(l.min.set(x.x-i,x.y,x.z-i),l.max.set(x.x+i,x.y+2,x.z+i),h.box.intersectsBox(l)){var d=h.box.clone().intersect(l),m=d.max.x-d.min.x,v=d.max.z-d.min.z;m<v?x.x<h.box.min.x+(h.box.max.x-h.box.min.x)/2?o.x-=m:o.x+=m:x.z<h.box.min.z+(h.box.max.z-h.box.min.z)/2?o.z-=v:o.z+=v;}}}}catch(t){e=!0,r=t;}finally{try{n||null==c.return||c.return();}finally{if(e)throw r;}}}constructor(){e._(this,"doors",[]),e._(this,"interactionDistance",2),e._(this,"activeDoor",null);}}var h=new c;},"b1f59e44":function e(e,a,t,r){e._m(a),t("2d08c2e5"),t("a3876e70");var d=t("9aaf3498"),n=t("9aaf3498"),f=t("1f6a8afd"),c=t("0e70da6a"),i=t("f247f526"),o=e.i(t("ae1ac647")),u=e.i(t("5c886761")),l=e.i(t("f7acc5ff")),N=e.i(t("76d74377")),s=e.i(t("8fd7a7b3"));a.default=d.defineComponent({__name:"ControlPanel",setup(a){var t=i.useSceneStore(),r=c.storeToRefs(t).isDarkMode;return(a,t)=>(n.openBlock(),n.createBlock(n.unref(f.NCard),{class:"param-panel",bordered:!1,size:"small"},{header:n.withCtx(()=>[n.createVNode(n.unref(f.NSpace),{align:"center",justify:"space-between",style:{margin:"0",width:"100%"}},{default:n.withCtx(()=>[n.createVNode(n.unref(f.NText),{strong:""},{default:n.withCtx(()=>[...t[1]||(t[1]=[n.createTextVNode("æŽ§åˆ¶é¢æ¿",-1)])]),_:1}),n.createVNode(n.unref(f.NSwitch),{value:n.unref(r),"onUpdate:value":t[0]||(t[0]=e=>n.isRef(r)?r.value=e:null),size:"small"},{checked:n.withCtx(()=>[...t[2]||(t[2]=[n.createTextVNode("ðŸŒ™",-1)])]),unchecked:n.withCtx(()=>[...t[3]||(t[3]=[n.createTextVNode("â˜€ï¸",-1)])]),_:1},8,["value"])]),_:1})]),default:n.withCtx(()=>[n.createVNode(n.unref(f.NTabs),{type:"line",animated:""},{default:n.withCtx(()=>[n.createVNode(n.unref(f.NTabPane),{name:"movement",tab:"æ¼«æ¸¸"},{default:n.withCtx(()=>[n.createVNode(e.f(u))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"lighting",tab:"å…‰ç…§"},{default:n.withCtx(()=>[n.createVNode(e.f(l))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"postprocess",tab:"åŽæœŸ"},{default:n.withCtx(()=>[n.createVNode(e.f(N))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"debug",tab:"è°ƒè¯•"},{default:n.withCtx(()=>[n.createVNode(e.f(s))]),_:1}),n.createVNode(n.unref(f.NTabPane),{name:"hierarchy",tab:"å±‚çº§","display-directive":"show"},{default:n.withCtx(()=>[n.createVNode(e.f(o))]),_:1})]),_:1})]),_:1}));}});},"d6303f37":function e(e,a,o,r){e._m(a),e.o(a,"initViewerScene",()=>m),o("b25dd2f8"),o("40616381");var n=o("f247f526"),t=e.i(o("26d7988f")),d=e.w(o("3b16918b")),s=o("e00be090"),c=o("f4cd7510"),i=o("6519cad4"),l=o("8f363abd"),f=o("e0c628a7"),h=o("c2079dd8"),u=o("96554b2f"),g=o("99602713");async function m(){var a=n.useSceneStore();await e.f(t).init();var o=new d.CubeTextureLoader;o.setPath("cubeMap/");var r=o.load(g.ASSETS.textures.skybox);e.f(t).setSkybox(r);var i=new c.InfiniteGrid;e.f(t).scene.add(i),e.f(t).scene.add(e.f(t).camera),e.f(t).lightManager=new l.LightManager(e.f(t).scene,e.f(t).camera);var m=new s.ModelLoader(e.f(t).renderer);async function S(){var o=new f.Character;try{await o.load(m,g.ASSETS.models.characterIdle,g.ASSETS.models.characterWalk,e=>{e.lengthComputable&&(a.loadingProgress=50+Math.round(e.loaded/e.total*50));}),e.f(t).setCharacter(o),a.movementMode="thirdPerson",a.isLoading=!1;}catch(e){console.error("Character loading failed:",e),a.isLoading=!1;}}m.loadGLTF(g.ASSETS.models.home,e=>{e.lengthComputable&&(a.loadingProgress=Math.round(e.loaded/e.total*50));}).then(o=>{o.scene.position.set(0,.1,0),e.f(t).scene.add(o.scene),a.setModelRoot(o.scene),o.scene.updateMatrixWorld(!0);var r=new d.AnimationMixer(o.scene);e.f(t).addMixer(r),o.scene.traverse(e=>{e.isMesh&&(e.receiveShadow=!0,e.castShadow=!0,e.name.endsWith("Glass")&&(e.castShadow=!1));});var n=o.scene.getObjectByName("Door");n&&n.children.forEach(e=>{console.log(e.name),u.doorManager.addDoor(e,o.animations,r);}),h.colliderManager.generateCollider(o.scene),h.colliderManager.setVisibility(a.showCollisionBoxes),S();}).catch(e=>{console.error("æ¨¡åž‹åŠ è½½å¤±è´¥:",e),a.isLoading=!1;});}d.BufferGeometry.prototype.computeBoundsTree=i.computeBoundsTree,d.BufferGeometry.prototype.disposeBoundsTree=i.disposeBoundsTree,d.Mesh.prototype.raycast=i.acceleratedRaycast;},"e0c628a7":function t(t,i,e,s){t._m(i),t.o(i,"Character",()=>o);var a=e("09efd1d2");e("b25dd2f8");var n=t.w(e("3b16918b"));class o{setupMeshProperties(t){t.traverse(t=>{if(t.isMesh){t.castShadow=!0,t.receiveShadow=!0;var i=t.material;t.material=new n.MeshStandardMaterial({color:i.color,map:i.map,roughness:.8,metalness:.1});}});}async load(t,i,e,s){var a=(t,i)=>{s&&i.lengthComputable&&i.total>0&&s(new ProgressEvent("progress",{lengthComputable:!0,loaded:100*(.5*t+.5*(i.loaded/i.total)),total:100}));},o=await t.loadFBX(i,t=>a(0,t));this.mesh=o,o.scale.set(.01,.01,.01),o.position.set(0,.1,0),this.setupMeshProperties(o),this.mixer=new n.AnimationMixer(o),this.idleAction=this.mixer.clipAction(o.animations[0]),this.idleAction.play(),this.currentAction=this.idleAction;var r=await t.loadFBX(e,t=>a(1,t));this.setupMeshProperties(r),this.walkAction=this.mixer.clipAction(r.animations[0]);}update(t){this.mixer&&this.mixer.update(t),this.updateAnimation();}updateAnimation(){if(this.idleAction&&this.walkAction){var t=this.velocity.length()>1?this.walkAction:this.idleAction;this.currentAction!==t&&(this.currentAction&&this.currentAction.fadeOut(.2),t.reset().fadeIn(.2).play(),this.currentAction=t);}}constructor(){a._(this,"mesh",null),a._(this,"velocity",new n.Vector3),a._(this,"mixer",null),a._(this,"idleAction",null),a._(this,"walkAction",null),a._(this,"currentAction",null);}}},"f247f526":function e(e,r,f,a){e._m(r),e.o(r,"useSceneStore",()=>i),f("bf3a4d74"),f("db38ec0f");var t=f("0e70da6a"),o=f("9aaf3498"),F=(e,r)=>{r.x=parseFloat(e.x.toFixed(2)),r.y=parseFloat(e.y.toFixed(2)),r.z=parseFloat(e.z.toFixed(2));},i=t.defineStore("scene",()=>{var e=o.ref(!0),r=o.ref(0),f=o.ref(!0),a=o.ref(null),t=o.ref("fly"),i=o.ref(20),n=o.reactive({x:1,y:1,z:1}),c=o.reactive({x:0,y:0,z:-1}),u=o.ref(!1),d=o.ref(!1),l=o.reactive({x:0,y:.1,z:0}),s=o.ref(!1),x=o.ref(!1),y=o.ref(!0),p=o.ref(!1),v=o.ref(""),z=o.ref(!0),m=o.ref(!0),D=o.ref("#FFFFFF"),P=o.ref(5),S=o.reactive({x:10,y:20,z:-20}),b=o.ref(!1),C=o.ref("#FFFFFF"),R=o.ref(1),k=o.ref(!0),w=o.ref(1),M=o.ref(!1),_=o.ref(16),g=o.ref(2),h=o.ref(1),j=o.ref(.25),q=o.ref(1),A=o.ref(1),B=o.ref(!1),E=o.ref(!1),G=o.ref("#FFFFFF"),H=o.ref(1),I=o.ref(30),J=o.ref(.3);return{isLoading:e,loadingProgress:r,isDarkMode:f,modelRoot:a,movementMode:t,moveSpeed:i,cameraPosition:n,cameraDirection:c,isEditingPosition:u,isEditingDirection:d,playerPosition:l,isEditingPlayerPosition:s,showCollisionBoxes:x,collisionEnabled:y,showInteractionPrompt:p,interactionText:v,skyboxEnabled:z,sunEnabled:m,sunColor:D,sunIntensity:P,sunPosition:S,ambientEnabled:b,ambientColor:C,ambientIntensity:R,environmentEnabled:k,environmentIntensity:w,gtaoEnabled:M,gtaoSamples:_,gtaoDistanceExponent:g,gtaoDistanceFallOff:h,gtaoRadius:j,gtaoScale:q,gtaoThickness:A,gtaoAoOnly:B,spotEnabled:E,spotColor:G,spotIntensity:H,spotAngle:I,spotPenumbra:J,spotDecay:o.ref(1),spotDistance:o.ref(1e3),setModelRoot:function(e){a.value=e?o.markRaw(e):null;},updateCameraPosition:function(e){F(e,n);},updateCameraDirection:function(e){F(e,c);},updatePlayerPosition:function(e){F(e,l);}};});},"f49f4847":function e(e,t,a,l){e._m(t),a("2d08c2e5"),a("a3876e70");var u=a("9aaf3498"),r=a("9aaf3498"),n=a("1f6a8afd"),o=a("0e70da6a"),d=a("f247f526");t.default=u.defineComponent({__name:"MovementPanel",setup(e){var t=d.useSceneStore(),a=o.storeToRefs(t),l=a.movementMode,u=a.moveSpeed,f=a.cameraPosition,i=a.cameraDirection,N=a.isEditingPosition,c=a.isEditingDirection,s=a.playerPosition,x=a.isEditingPlayerPosition,p=[{label:"é£žè¡Œ",value:"fly"},{label:"è½¨é“",value:"orbit"},{label:"ç¬¬ä¸‰äººç§°",value:"thirdPerson"},{label:"ä¿¯è§†",value:"topView"}];return(e,t)=>(r.openBlock(),r.createBlock(r.unref(n.NSpace),{vertical:"",size:"large"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"2",style:{"font-size":"12px","text-transform":"uppercase"}},{default:r.withCtx(()=>[...t[29]||(t[29]=[r.createTextVNode("ç§»åŠ¨æ–¹å¼",-1)])]),_:1}),r.createVNode(r.unref(n.NSelect),{value:r.unref(l),"onUpdate:value":t[0]||(t[0]=e=>r.isRef(l)?l.value=e:null),options:p},null,8,["value"])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{justify:"space-between",style:{width:"100%"}},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"2",style:{"font-size":"12px","text-transform":"uppercase"}},{default:r.withCtx(()=>[...t[30]||(t[30]=[r.createTextVNode("ç§»åŠ¨é€Ÿåº¦",-1)])]),_:1}),r.createVNode(r.unref(n.NText),null,{default:r.withCtx(()=>[r.createTextVNode(r.toDisplayString(Math.round(r.unref(u)))+" u/s",1)]),_:1})]),_:1}),r.createVNode(r.unref(n.NSlider),{value:r.unref(u),"onUpdate:value":t[1]||(t[1]=e=>r.isRef(u)?u.value=e:null),min:1,max:50,step:1},null,8,["value"])]),_:1}),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"2",style:{"font-weight":"600"}},{default:r.withCtx(()=>[...t[31]||(t[31]=[r.createTextVNode("æ‘„åƒæœºä½ç½®",-1)])]),_:1}),r.createVNode(r.unref(n.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[32]||(t[32]=[r.createTextVNode("X",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(f).x,"onUpdate:value":t[2]||(t[2]=e=>r.unref(f).x=e),size:"small","show-button":!1,onFocus:t[3]||(t[3]=e=>N.value=!0),onBlur:t[4]||(t[4]=e=>N.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[33]||(t[33]=[r.createTextVNode("Y",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(f).y,"onUpdate:value":t[5]||(t[5]=e=>r.unref(f).y=e),size:"small","show-button":!1,onFocus:t[6]||(t[6]=e=>N.value=!0),onBlur:t[7]||(t[7]=e=>N.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[34]||(t[34]=[r.createTextVNode("Z",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(f).z,"onUpdate:value":t[8]||(t[8]=e=>r.unref(f).z=e),size:"small","show-button":!1,onFocus:t[9]||(t[9]=e=>N.value=!0),onBlur:t[10]||(t[10]=e=>N.value=!1)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),"thirdPerson"===r.unref(l)?(r.openBlock(),r.createBlock(r.unref(n.NSpace),{key:0,vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"2",style:{"font-weight":"600"}},{default:r.withCtx(()=>[...t[35]||(t[35]=[r.createTextVNode("çŽ©å®¶ä½ç½®",-1)])]),_:1}),r.createVNode(r.unref(n.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[36]||(t[36]=[r.createTextVNode("X",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(s).x,"onUpdate:value":t[11]||(t[11]=e=>r.unref(s).x=e),size:"small","show-button":!1,onFocus:t[12]||(t[12]=e=>x.value=!0),onBlur:t[13]||(t[13]=e=>x.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[37]||(t[37]=[r.createTextVNode("Y",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(s).y,"onUpdate:value":t[14]||(t[14]=e=>r.unref(s).y=e),size:"small","show-button":!1,onFocus:t[15]||(t[15]=e=>x.value=!0),onBlur:t[16]||(t[16]=e=>x.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[38]||(t[38]=[r.createTextVNode("Z",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(s).z,"onUpdate:value":t[17]||(t[17]=e=>r.unref(s).z=e),size:"small","show-button":!1,onFocus:t[18]||(t[18]=e=>x.value=!0),onBlur:t[19]||(t[19]=e=>x.value=!1)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})):r.createCommentVNode("",!0),r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"2",style:{"font-weight":"600"}},{default:r.withCtx(()=>[...t[39]||(t[39]=[r.createTextVNode("æ‘„åƒæœºæ–¹å‘",-1)])]),_:1}),r.createVNode(r.unref(n.NGrid),{cols:3,"x-gap":8},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[40]||(t[40]=[r.createTextVNode("X",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(i).x,"onUpdate:value":t[20]||(t[20]=e=>r.unref(i).x=e),size:"small","show-button":!1,onFocus:t[21]||(t[21]=e=>c.value=!0),onBlur:t[22]||(t[22]=e=>c.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[41]||(t[41]=[r.createTextVNode("Y",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(i).y,"onUpdate:value":t[23]||(t[23]=e=>r.unref(i).y=e),size:"small","show-button":!1,onFocus:t[24]||(t[24]=e=>c.value=!0),onBlur:t[25]||(t[25]=e=>c.value=!1)},null,8,["value"])]),_:1})]),_:1}),r.createVNode(r.unref(n.NGi),null,{default:r.withCtx(()=>[r.createVNode(r.unref(n.NSpace),{vertical:"",size:"small"},{default:r.withCtx(()=>[r.createVNode(r.unref(n.NText),{depth:"3",style:{"font-size":"11px"}},{default:r.withCtx(()=>[...t[42]||(t[42]=[r.createTextVNode("Z",-1)])]),_:1}),r.createVNode(r.unref(n.NInputNumber),{value:r.unref(i).z,"onUpdate:value":t[26]||(t[26]=e=>r.unref(i).z=e),size:"small","show-button":!1,onFocus:t[27]||(t[27]=e=>c.value=!0),onBlur:t[28]||(t[28]=e=>c.value=!1)},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}));}});},"ff9d919c":function e(e,t,o,r){e._m(t),o("2d08c2e5"),o("a3876e70");var a=o("9aaf3498"),c=o("9aaf3498"),d=o("1f6a8afd"),n=o("9aaf3498");t.default=a.defineComponent({__name:"PointerLockPrompt",props:{visible:{type:Boolean},mode:{}},emits:["enterPointerLock"],setup(e,t){var o=t.emit,r=n.computed(()=>"fly"===e.mode?"è‡ªç”±é£žè¡Œè§†è§’":"ç¬¬ä¸‰äººç§°è§†è§’");return(t,a)=>c.withDirectives((c.openBlock(),c.createBlock(c.unref(d.NCard),{class:"controls-overlay",bordered:!1,size:"small",title:r.value},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NText),{depth:"3"},{default:c.withCtx(()=>["fly"===e.mode?(c.openBlock(),c.createElementBlock(c.Fragment,{key:0},[a[4]||(a[4]=c.createTextVNode(" ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥é”å®šé¼ æ ‡ï¼Œä½¿ç”¨ ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[1]||(a[1]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[5]||(a[5]=c.createTextVNode(" ç§»åŠ¨ï¼Œ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[2]||(a[2]=[c.createTextVNode("ç©ºæ ¼",-1)])]),_:1}),a[6]||(a[6]=c.createTextVNode(" ä¸Šå‡ï¼Œ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[3]||(a[3]=[c.createTextVNode("Shift",-1)])]),_:1}),a[7]||(a[7]=c.createTextVNode(" ä¸‹é™ï¼Œé¼ æ ‡æ—‹è½¬æ–¹å‘ã€‚ ",-1))],64)):(c.openBlock(),c.createElementBlock(c.Fragment,{key:1},[a[9]||(a[9]=c.createTextVNode(" ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä»¥é”å®šé¼ æ ‡ï¼Œä½¿ç”¨ ",-1)),c.createVNode(c.unref(d.NText),{strong:""},{default:c.withCtx(()=>[...a[8]||(a[8]=[c.createTextVNode("W A S D",-1)])]),_:1}),a[10]||(a[10]=c.createTextVNode(" ç§»åŠ¨ï¼Œé¼ æ ‡æ—‹è½¬è§†è§’ã€‚ ",-1))],64))]),_:1}),c.createVNode(c.unref(d.NSpace),{vertical:"",style:{"margin-top":"12px"}},{default:c.withCtx(()=>[c.createVNode(c.unref(d.NButton),{type:"primary",onClick:a[0]||(a[0]=e=>o("enterPointerLock")),block:""},{default:c.withCtx(()=>[...a[11]||(a[11]=[c.createTextVNode("å¼€å§‹ä½“éªŒ",-1)])]),_:1}),c.createVNode(c.unref(d.NText),{depth:"3",style:{"font-size":"12px"}},{default:c.withCtx(()=>[a[13]||(a[13]=c.createTextVNode("æŒ‰ ",-1)),c.createVNode(c.unref(d.NText),{code:""},{default:c.withCtx(()=>[...a[12]||(a[12]=[c.createTextVNode("Esc",-1)])]),_:1}),a[14]||(a[14]=c.createTextVNode(" å¯é€€å‡ºé”å®š",-1))]),_:1})]),_:1})]),_:1},8,["title"])),[[c.vShow,e.visible]]);}});},});
//# sourceMappingURL=index_42a9.ea46869c.js.map